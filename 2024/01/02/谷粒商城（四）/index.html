<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>商品服务（四） | 光明</title><meta name="author" content="ADAN"><meta name="copyright" content="ADAN"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="商品服务1、商品服务-三级分类三级分类介绍 1、查询三级分类，递归树形结构实现查询出所有分类和子分类，并且把它们以父子的结构组装起  1.0、回顾stream流参考文章： java SE基础+进阶_vincewm的博客-CSDN博客 Java 8 Stream | 菜鸟教程 1.生成流：list.stream(); **2.中间流：filter()**、map()、sorted（） filter">
<meta property="og:type" content="article">
<meta property="og:title" content="商品服务（四）">
<meta property="og:url" content="https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/index.html">
<meta property="og:site_name" content="光明">
<meta property="og:description" content="商品服务1、商品服务-三级分类三级分类介绍 1、查询三级分类，递归树形结构实现查询出所有分类和子分类，并且把它们以父子的结构组装起  1.0、回顾stream流参考文章： java SE基础+进阶_vincewm的博客-CSDN博客 Java 8 Stream | 菜鸟教程 1.生成流：list.stream(); **2.中间流：filter()**、map()、sorted（） filter">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://adanpro.gitee.io/adanblog/img/5.jpg">
<meta property="article:published_time" content="2024-01-02T08:42:41.356Z">
<meta property="article:modified_time" content="2024-01-02T08:43:45.018Z">
<meta property="article:author" content="ADAN">
<meta property="article:tag" content="vue java 项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://adanpro.gitee.io/adanblog/img/5.jpg"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '商品服务（四）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-02 16:43:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/js/custom.js"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/king.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于</span></a></li><li><a class="site-page child" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/5.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="光明"><span class="site-name">光明</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于</span></a></li><li><a class="site-page child" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">商品服务（四）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-02T08:42:41.356Z" title="发表于 2024-01-02 16:42:41">2024-01-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-02T08:43:45.018Z" title="更新于 2024-01-02 16:43:45">2024-01-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/">谷粒商城</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="商品服务（四）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="商品服务"><a href="#商品服务" class="headerlink" title="商品服务"></a>商品服务</h1><h1 id="1、商品服务-三级分类"><a href="#1、商品服务-三级分类" class="headerlink" title="1、商品服务-三级分类"></a>1、商品服务-三级分类</h1><h2 id="三级分类介绍"><a href="#三级分类介绍" class="headerlink" title="三级分类介绍"></a>三级分类介绍</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508083245020.png" alt="image-20230508083245020"></p>
<h2 id="1、查询三级分类，递归树形结构"><a href="#1、查询三级分类，递归树形结构" class="headerlink" title="1、查询三级分类，递归树形结构"></a>1、查询三级分类，递归<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84&spm=1001.2101.3001.7020">树形结构</a></h2><p><strong>实现查询出所有分类和子分类，并且把它们以父子的结构组装起</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508083343636.png" alt="image-20230508083343636"></p>
<h3 id="1-0、回顾stream流"><a href="#1-0、回顾stream流" class="headerlink" title="1.0、回顾stream流"></a>1.0、回顾<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=stream%E6%B5%81&spm=1001.2101.3001.7020">stream流</a></h3><p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40991313/article/details/124082505">java SE基础+进阶_vincewm的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-streams.html">Java 8 Stream | 菜鸟教程</a></p>
<p><strong>1.生成流：</strong>list.stream();</p>
<p>**2.中间流：filter()**、map()、sorted（）</p>
<p><strong>filter</strong></p>
<p>filter 方法用于通过设置的条件过滤出元素。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.stream().filter(Lambda参数是list的每个元素，返回值是Boolean，为<span class="literal">true</span>时留下)</span><br></pre></td></tr></table></figure>

<p>以下代码片段<strong>使用 filter 方法过滤掉空字符串</strong>，打印非空字符串。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt;list = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line"><span class="comment">//forEach终结后，原list不变，处理后的list遍历输出</span></span><br><span class="line">list.stream().filter(item -&gt; !item.isEmpty()).forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p><strong>map（）</strong> </p>
<p>中间操作**map()**用法和filter类似。需要return返回</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.stream().map(参数是Lambda，Lambda参数是list的每个元素，返回值是加工后的list元素)</span><br></pre></td></tr></table></figure>

<p>下面是小写转大写： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt;list = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line"><span class="comment">//collect收集后原list不变，处理后的list收集成返回值</span></span><br><span class="line">list=list.stream().map(item-&gt;item.toUpperCase()).collect(Collectors.toList());</span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508083728034.png" alt="image-20230508083728034"></p>
<p><strong>sorted()</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.stream().sorted(参数是Lambda，Lambda参数是list的两个元素，返回值&gt;<span class="number">0</span>是升序，返回值&lt;<span class="number">0</span>是降序)</span><br></pre></td></tr></table></figure>

<p>先按字母序再按长度排序：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line">    <span class="comment">//forEach终结后，原list不变，处理后的list遍历输出</span></span><br><span class="line">    list=list.stream().sorted((item1,item2)-&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(item1.compareTo(item2)!=<span class="number">0</span>) <span class="keyword">return</span> item1.compareTo(item2);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> item1.length()-item2.length();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：[, , abc, abcd, bc, efg, jkl]</p>
<p><strong>3.终结流用于遍历：l</strong>ist.stream().filter().<strong>forEach</strong>(System.out::println)</p>
<p><strong>4.收集流用于赋值给原list：</strong>list.stream().filter().<strong>collect</strong>(Collectors.otList())</p>
<h3 id="1-1、数据库导入表pms-category，需求"><a href="#1-1、数据库导入表pms-category，需求" class="headerlink" title="1.1、数据库导入表pms_category，需求"></a>1.1、数据库<strong>导入表</strong><code>pms_category</code><strong>，需求</strong></h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508084132566.png" alt="image-20230508084132566"></p>
<p>先把数据导入表<code>pms_category</code>，数据库文件D:\download\尚硅谷谷粒商城电商项目等1个文件\尚硅谷谷粒商城电商项目\资料源码\docs\代码\sql\pms_catelog.sql</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508084201082.png" alt="image-20230508084201082"></p>
<p><strong>需求：</strong></p>
<p><strong>&#x2F;list&#x2F;tree路径，get请求，R封装三级分类的响应数据，子分类名children，根据sort字段值排序。</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508084227810.png" alt="image-20230508084227810"></p>
<h3 id="1-2、修改CategoryController的list方法，树形结构查所有分类"><a href="#1-2、修改CategoryController的list方法，树形结构查所有分类" class="headerlink" title="1.2、修改CategoryController的list方法，树形结构查所有分类"></a>1.2、修改CategoryController的list方法，树形结构查所有分类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查出所有分类以及子分类，以树形结构组装起来</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list/tree&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; entities = categoryService.listWithTree();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, entities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3、CategoryEntity新增子分类属性"><a href="#1-3、CategoryEntity新增子分类属性" class="headerlink" title="1.3、CategoryEntity新增子分类属性"></a>1.3、<code>CategoryEntity</code>新增子分类属性</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span> <span class="comment">//表示数据库表中不存在</span></span><br><span class="line"><span class="keyword">private</span> List&lt;CategoryEntity&gt; children;</span><br></pre></td></tr></table></figure>

<h3 id="1-4、编写树形结构查分类的service方法listWithTree"><a href="#1-4、编写树形结构查分类的service方法listWithTree" class="headerlink" title="1.4、编写树形结构查分类的service方法listWithTree()"></a>1.4、编写树形结构查分类的service方法<code>listWithTree()</code></h3><p><code>categoryService</code>接口新增方法<code>listWithTree()</code>,编写实现类： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">listWithTree</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//1、查出所有分类。baseMapper来自于继承的ServiceImpl&lt;&gt;类，跟CategoryDao一样用法</span></span><br><span class="line">       List&lt;CategoryEntity&gt; entities = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">       <span class="comment">//2、递归组装多级分类的树形结构。先过滤(筛选出一级菜单，也就是ParentCid=0)得到一级分类，再加工递归设置一级分类的子孙分类，再排序，再收集</span></span><br><span class="line">       List&lt;CategoryEntity&gt; level1Menus = entities.stream()</span><br><span class="line">               .filter(categoryEntity -&gt; categoryEntity.getParentCid() == <span class="number">0</span>)</span><br><span class="line">               .map((menu) -&gt; &#123;</span><br><span class="line">                   <span class="comment">// 设置一级分类的子分类</span></span><br><span class="line">                   menu.setChildren(getChildren(menu, entities));</span><br><span class="line">                   <span class="keyword">return</span> menu;</span><br><span class="line">               &#125;)</span><br><span class="line">               .sorted(</span><br><span class="line">                       <span class="comment">//排序，sort是实体类的排序属性，值越小优先级越高，要判断非空防止空指针异常</span></span><br><span class="line">                       <span class="comment">// 方法一：</span></span><br><span class="line">                       <span class="comment">// return (menu1.getSort() == null ? 0 : menu1.getSort()) - (menu2.getSort() == null ? 0 : menu2.getSort());</span></span><br><span class="line">                       <span class="comment">// 方法二：</span></span><br><span class="line">                       Comparator.comparingInt(menu -&gt; (menu.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : menu.getSort()))</span><br><span class="line">                       <span class="comment">// 方法三： 整体升序，price为null的排在最前</span></span><br><span class="line">                       <span class="comment">// Comparator.comparing(CategoryEntity::getSort, Comparator.nullsFirst(Comparator.naturalOrder()))</span></span><br><span class="line">               ).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> level1Menus;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//递归查找所有菜单的子菜单</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;CategoryEntity&gt; <span class="title function_">getChildren</span><span class="params">(CategoryEntity root, List&lt;CategoryEntity&gt; all)</span>&#123;</span><br><span class="line">       <span class="comment">// 筛选出子菜单，当子菜单的ParentCid等于父id</span></span><br><span class="line">       <span class="keyword">return</span> all.stream().filter(item -&gt; item.getParentCid().equals(root.getCatId()))</span><br><span class="line">               .map(item -&gt; &#123;</span><br><span class="line">                   item.setChildren(getChildren(item, all));</span><br><span class="line">                   <span class="keyword">return</span> item;</span><br><span class="line">               &#125;).sorted(Comparator.comparingInt(item -&gt; item.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : item.getSort()))</span><br><span class="line">               .collect(Collectors.toList());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5、启动测试"><a href="#1-5、启动测试" class="headerlink" title="1.5、启动测试"></a>1.5、启动测试</h3><p>发送请求<a target="_blank" rel="noopener" href="http://localhost:10000/glmproduct/category/list/tree%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE">http://localhost:10000/glmproduct/category/list/tree，查看数据</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508113143212.png" alt="image-20230508113143212"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508113208664.png" alt="image-20230508113208664"></p>
<h2 id="2、人人后台页面管理三级分类"><a href="#2、人人后台页面管理三级分类" class="headerlink" title="2、人人后台页面管理三级分类"></a>2、人人后台页面管理三级分类</h2><h3 id="1、启动模块"><a href="#1、启动模块" class="headerlink" title="1、启动模块"></a>1、启动模块</h3><ul>
<li>idea启动renren-fast、gateway、product，</li>
<li>vscode启动renren-fast-vue模块，运行前端项目</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>访问地址</p>
<p>可以看到验证码就是后端启动成功。默认密码admin，admin </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508153538514.png" alt="image-20230508153538514"></p>
<h3 id="2、renren-fast新增商品目录和分类维护菜单"><a href="#2、renren-fast新增商品目录和分类维护菜单" class="headerlink" title="2、renren-fast新增商品目录和分类维护菜单"></a>2、renren-fast新增商品目录和分类维护菜单</h3><p>新增一级菜单</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508153659168.png" alt="image-20230508153659168"></p>
<p>新增商品管理目录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508154902059.png" alt="image-20230508154902059"></p>
<p>新增菜单<code>分类维护</code>，在<code>商品系统</code>下，路由为：product&#x2F;category</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508155117559.png" alt="image-20230508155117559"></p>
<p>新增后刷新页面：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508155242501.png" alt="image-20230508155242501"></p>
<p>新增之后的菜单在都保存在数据库之中，查看<code>gulimall_admin</code>中的<code>sys_menu</code>表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508155347532.png" alt="image-20230508155347532"></p>
<h3 id="3、前端展示三级分类树形控件"><a href="#3、前端展示三级分类树形控件" class="headerlink" title="3、前端展示三级分类树形控件"></a>3、前端展示三级分类树形控件</h3><p><strong>需求：</strong>在左侧点击【商品系统-分类维护】，希望在此展示3级分类。可以看到</p>
<ul>
<li>url是<code>http://localhost:8001/#/product-category</code></li>
<li>填写的菜单路由是<code>product/category</code></li>
<li>对应的视图是<code>src/view/modules/product/category.vue</code></li>
</ul>
<p><strong>自定义<code>product/category</code>视图</strong> </p>
<p>所以如果我们要<strong>自定义<code>product/category</code>视图</strong>的话，就要**创建src&#x2F;views&#x2F;mudules&#x2F;product&#x2F;category.vue</p>
<p>创建vue模板，然后去elementui看如何使用多级目录</p>
<p>输入vue加回车，可快速生成模板。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508155958660.png" alt="image-20230508155958660"></p>
<p><strong>引入elementUI树形控件：</strong></p>
<p><a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/tree">Element - The world’s most popular Vue UI framework</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508160129988.png" alt="image-20230508160129988"></p>
<p>设置data数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//这里存放数据</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">menus</span>: [],</span><br><span class="line">      <span class="attr">defaultProps</span>: &#123;</span><br><span class="line">        <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>,</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;label&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>在methods方法中创建方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//方法集合</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">handleNodeClick</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getMenus</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/list/tree&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取到数据&quot;</span>, data);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">menus</span> = data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>vue实例创建完成调用查询方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//生命周期 - 创建完成（可以访问当前this实例）</span></span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>保存刷新页面，观察请求地址发送情况</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508162215787.png" alt="image-20230508162215787"></p>
<p><strong>发现请求端口问题：</strong> </p>
<p>发现，他是给8080端口发的请求，而我们的商品服务在10000端口。我们以后还会同时发向更多的端口，所以<strong>需要配置网关，前端只向网关发送请求</strong>，然后由网关自己路由到相应端口。</p>
<h3 id="4、前端的请求基本路径设为网关路径"><a href="#4、前端的请求基本路径设为网关路径" class="headerlink" title="4、前端的请求基本路径设为网关路径"></a>4、前端的请求基本路径设为网关路径</h3><p><strong>修改前端文件：static&#x2F;config&#x2F;index.js</strong>  ；请求网关接口</p>
<p>替换前：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">window.SITE_CONFIG[&#x27;baseUrl&#x27;] = &#x27;http://localhost:8080/renren-fast&#x27;;</span><br></pre></td></tr></table></figure>

<p>替换后：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">window.SITE_CONFIG[&#x27;baseUrl&#x27;] = &#x27;http://localhost:88/api&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>刷新，发现验证码出不来。</strong></p>
<p><strong>验证码请求路径问题：</strong></p>
<p>分析原因：前端给网关发验证码请求，但是验证码请求在renren-fast服务里，所以要想使验证码好使，<strong>需要把renren-fast服务注册到服务中心，并且由网关进行路由</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508162723191.png" alt="image-20230508162723191"></p>
<h3 id="5、renren-fast注册到nacos，前端路由网关"><a href="#5、renren-fast注册到nacos，前端路由网关" class="headerlink" title="5、renren-fast注册到nacos，前端路由网关"></a>5、renren-fast注册到nacos，前端路由网关</h3><p>renren-fast引入common模块的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.adan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>glm-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里common模块引入了nacos注册配置依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>新建配置文件</strong></p>
<p>bootstrap.yml配置nacos服务</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">renren-fast</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">7037a071-581e-4c47-9319-9daccf89571d</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">39af97ea-4e15-495b-bff4-512fb1ee8aa1</span></span><br><span class="line">        <span class="attr">refresh-enabled:</span> <span class="literal">true</span> <span class="comment">#动态刷新配置文件</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span>   <span class="comment">#指定当前开发环境环境名</span></span><br></pre></td></tr></table></figure>

<p><strong>引导类开启服务注册功能</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@EnableDiscoveryClient</span><br></pre></td></tr></table></figure>

<p><strong>重启renren-fast、注册成功</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508164751026.png" alt="image-20230508164751026"></p>
<p><strong>坑点：</strong>如果springboot和SpringCloud和SpringCloudAlibaba<strong>版本不兼容</strong>，就会报错</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2021</span>-<span class="number">03</span>-<span class="number">11</span> <span class="number">12</span>:<span class="number">38</span>:<span class="number">15.512</span> ERROR <span class="number">16912</span> --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"> </span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name <span class="string">&#x27;configurationPropertiesBeans&#x27;</span> defined in <span class="keyword">class</span> <span class="title class_">path</span> resource [org/springframework/cloud/autoconfigure/ConfigurationPropertiesRebinderAutoConfiguration.class]: Post-processing of merged bean definition failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [org.springframework.cloud.context.properties.ConfigurationPropertiesBeans] from ClassLoader [sun.misc.Launcher$AppClassLoader@18b4aac2]</span><br></pre></td></tr></table></figure>

<p>最新版本兼容问题请看官网，22年9月时的兼容信息：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508165029182.png" alt="image-20230508165029182"></p>
<p><strong>配置网关yml,新增路由</strong></p>
<p>需求： <a target="_blank" rel="noopener" href="http://localhost:88/api/xxx">http://localhost:88/api/xxx</a> 转发–&gt; <a target="_blank" rel="noopener" href="http://renren-fast:8080/renren-fast/xxx">http://renren-fast:8080/renren-fast/xxx</a></p>
<p>例如：<a target="_blank" rel="noopener" href="http://localhost:88/api/captcha.jpg">http://localhost:88/api/captcha.jpg</a>   转发–&gt;  <a target="_blank" rel="noopener" href="http://renren-fast:8080/renren-fast/captcha.jpg">http://renren-fast:8080/renren-fast/captcha.jpg</a> </p>
<p><strong>application.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">88</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">baidu-route</span>              <span class="comment"># 每一个路由的名字，唯一即可</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span>   <span class="comment"># 匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,baidu</span>         <span class="comment">#如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq_route</span>                  <span class="comment"># 每一个路由的名字，唯一即可</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.qq.com</span>   <span class="comment"># 匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 断言规则</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,qq</span>         <span class="comment">#如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span>    <span class="comment"># uri路由的目标地址。lb就是负载均衡，后面跟服务名称。</span></span><br><span class="line">          <span class="comment">#断言工厂的Path，请求路径必须符合指定规则</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span>    <span class="comment"># 把所有api开头的请求都转发给renren-fast</span></span><br><span class="line">          <span class="attr">filters:</span>  <span class="comment">#局部过滤器。回顾默认过滤器default-filters是与routes同级</span></span><br><span class="line">            <span class="comment">#路径重写。逗号左边是原路径，右边是重写后的路径</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),</span> <span class="string">/renren-fast/$\&#123;segment&#125;</span></span><br><span class="line">          <span class="comment"># 默认规则， 请求过来：http://localhost:88/api/captcha.jpg   转发--&gt;  http://renren-fast:8080/renren-fast/captcha.jpg</span></span><br></pre></td></tr></table></figure>

<p>重启renren-fast模块</p>
<p>此时出现错误</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508171708121.png" alt="image-20230508171708121"></p>
<p>状态码500，很有可能后端服务器出现问题，查看后端代码控制台出现报错</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Servlet.service() for servlet [dispatcherServlet] in context with path [/renren-fast] threw exception [Filter execution threw an exception] with root cause</span><br><span class="line"></span><br><span class="line">java.lang.ClassNotFoundException: io.renren.common.xss.XssHttpServletRequestWrapper</span><br></pre></td></tr></table></figure>

<p>出现这个错误，很大可能是idea本身的缓存造成的，选择maven  –&gt; clean , 重新运行编译</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508172059361.png" alt="image-20230508172059361"></p>
<p>刷新页面，成功显示验证码信息</p>
<p><strong>测试访问，出现跨域问题。</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508172345445.png" alt="image-20230508172345445"></p>
<h2 id="3、解决跨域问题"><a href="#3、解决跨域问题" class="headerlink" title="3、解决跨域问题"></a>3、解决跨域问题</h2><h3 id="1、跨域和同源策略"><a href="#1、跨域和同源策略" class="headerlink" title="1、跨域和同源策略"></a><strong>1、跨域和同源策略</strong></h3><p><strong>点击登录后报错：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508172508653.png" alt="image-20230508172508653"></p>
<p><strong>跨域：</strong>指的是<strong>浏览器****不能执行其他网站的脚本</strong>，它是由浏览器的<strong>同源策略</strong>造成的，是浏览器对javascript施加的安全限制。</p>
<p><strong><code>同源策略</code>：</strong>是指<strong>协议，域名，端口都要相同</strong>，其中有一个不同都会产生跨域问题</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>说明</th>
<th>是否允许通信</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com/a.js">http://www.a.com/a.js</a> <a target="_blank" rel="noopener" href="http://www.a.com/b.js">http://www.a.com/b.js</a></td>
<td>同一域名下</td>
<td>允许</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com/lab/a.js">http://www.a.com/lab/a.js</a> <a target="_blank" rel="noopener" href="http://www.a.com/script/b.js">http://www.a.com/script/b.js</a></td>
<td>同一域名下不同文件夹</td>
<td>允许</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com:8000/a.js">http://www.a.com:8000/a.js</a> <a target="_blank" rel="noopener" href="http://www.a.com/b.js">http://www.a.com/b.js</a></td>
<td>同一域名，不同端口</td>
<td>不允许</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com/a.js">http://www.a.com/a.js</a> <a target="_blank" rel="noopener" href="https://www.a.com/b.js">https://www.a.com/b.js</a></td>
<td>同一域名，不同协议</td>
<td>不允许</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com/a.js">http://www.a.com/a.js</a> <a target="_blank" rel="noopener" href="http://70.32.92.74/b.js">http://70.32.92.74/b.js</a></td>
<td>域名和域名对应ip</td>
<td>不允许</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com/a.js">http://www.a.com/a.js</a> <a target="_blank" rel="noopener" href="http://script.a.com/b.js">http://script.a.com/b.js</a></td>
<td>主域相同，子域不同</td>
<td>不允许</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.a.com/a.js">http://www.a.com/a.js</a> <a target="_blank" rel="noopener" href="http://a.com/b.js">http://a.com/b.js</a></td>
<td>同一域名，不同二级域名（同上）</td>
<td>不允许（cookie这种情况下也不允许访问</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.cnblogs.com/a.js">http://www.cnblogs.com/a.js</a> <a target="_blank" rel="noopener" href="http://www.a.com/b.js">http://www.a.com/b.js</a></td>
<td>不同域名</td>
<td>不允许</td>
</tr>
</tbody></table>
<h3 id="2、跨域的流程"><a href="#2、跨域的流程" class="headerlink" title="2、跨域的流程"></a>2、跨域的流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508172704908.png" alt="image-20230508172704908"></p>
<h3 id="3、解决办法1：使用nginx反向代理为同一域"><a href="#3、解决办法1：使用nginx反向代理为同一域" class="headerlink" title="3、解决办法1：使用nginx反向代理为同一域"></a>3、解决办法1：使用nginx反向代理为同一域</h3><p>使用Nginx反向代理，不同地址、端口都被同一个域名反向代理了，这就是统一域了。这种方法在开发时没法用，所以不采用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508172832833.png" alt="image-20230508172832833"></p>
<h3 id="4、解决方法2（采用）-配置当前请求允许跨域"><a href="#4、解决方法2（采用）-配置当前请求允许跨域" class="headerlink" title="4、解决方法2（采用）: 配置当前请求允许跨域"></a>4、解决方法2（采用）: 配置当前请求允许跨域</h3><p>CORS：CORS 是一个 W3C 标准，全称是“跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨域的服务器，发出XMLHttpRequest请求，从而克服了 AJAX 只能同源使用的限制。 </p>
<ul>
<li>Access-Control-Allow-Origin ： 支持哪些来源的请求跨域</li>
<li>Access-Control-Allow-Method ： 支持那些方法跨域</li>
<li>Access-Control-Allow-Credentials ：跨域请求默认不包含cookie，设置为true可以包含cookie</li>
<li>Access-Control-Expose-Headers ： 跨域请求暴露的字段</li>
<li>CORS请求时，XMLHttpRequest对象的getResponseHeader()方法只能拿到6个基本字段：<br>Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma<br>如果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。</li>
<li>Access-Control-Max-Age ：表明该响应的有效时间为多少秒。在有效时间内，浏览器无须为同一请求再次发起预检请求。请注意，浏览器自身维护了一个最大有效时间，如果该首部字段的值超过了最大有效时间，将失效。</li>
</ul>
<h3 id="5、用方法2新建配置类，解决跨域问题"><a href="#5、用方法2新建配置类，解决跨域问题" class="headerlink" title="5、用方法2新建配置类，解决跨域问题"></a>5、用方法2新建配置类，解决跨域问题</h3><p><strong>配置filter，每个请求来了以后，返回给浏览器之前都添加上那些字段</strong></p>
<p>在gulimall-gateway的gulimall.gateway.config包下中<strong>新建配置类</strong>，该类用来做过滤，允许所有的请求跨域</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.adan.glmgateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.CorsWebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: adan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-05-08 17:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlmCorsConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line"></span><br><span class="line">        CorsConfiguration corsConfiguration= <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        <span class="comment">//1、配置跨域</span></span><br><span class="line">        <span class="comment">// 允许跨域的请求头</span></span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 允许跨域的请求方式</span></span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 允许跨域的请求来源</span></span><br><span class="line">        corsConfiguration.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 是否允许携带cookie跨域</span></span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 任意url都要进行跨域配置，两个*号就是可以匹配包含0到多个/的路径</span></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,corsConfiguration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>坑点：</strong>包别导错：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508183242653.png" alt="image-20230508183242653"></p>
<p><strong>注释掉renren-fast中的跨域，不然会有一些重复的规则导致跨域失败：</strong></p>
<p>io.renren&#x2F;config&#x2F;CorsConfig </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508183321328.png" alt="image-20230508183321328">		</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508183623888.png" alt="image-20230508183623888"></p>
<p><strong>坑点：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">报错：When allowCredentials is true, allowedOrigins cannot contain the special value &quot;*&quot; since that cannot be set on the &quot;Access-Control-Allow-Origin&quot; response header. To allow credentials to a set of origins, list them explicitly or consider using &quot;allowedOriginPatterns&quot; instead.</span><br></pre></td></tr></table></figure>

<p>分析：当allowCredentials为真时，allowedorigin不能包含特殊值”*”，因为不能在”访问-控制-起源“响应头中设置该值。<br>解决：</p>
<p><strong>修改</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">corsConfiguration.addAllowedOrigin(&quot;*&quot;);</span><br></pre></td></tr></table></figure>

<p>允许跨域的请求来源为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">corsConfiguration.addAllowedOrigin(&quot;http://localhost:8001&quot;);</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">corsConfiguration.addAllowedOriginPattern(&quot;*&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="4、前端树形展示三级分类数据"><a href="#4、前端树形展示三级分类数据" class="headerlink" title="4、前端树形展示三级分类数据"></a>4、前端树形展示三级分类数据</h2><h3 id="1、在网关中配置product路由"><a href="#1、在网关中配置product路由" class="headerlink" title="1、在网关中配置product路由"></a>1、在网关中配置product路由</h3><p>查询不到数据，需要在网关配置product路径的请求路由：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508193312529.png" alt="image-20230508193312529"></p>
<p>这是因为网关上所做的路径映射不正确，映射后的路径为<a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/product/category/list/tree">http://localhost:8001/renren-fast/product/category/list/tree</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508193418492.png" alt="image-20230508193418492"></p>
<p>但是只有通过<a target="_blank" rel="noopener" href="http://localhost:10000/glmproduct/category/list/tree%E8%B7%AF%E5%BE%84%E6%89%8D%E8%83%BD%E5%A4%9F%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%9A%E6%8A%A5404%E5%BC%82%E5%B8%B8%E3%80%82">http://localhost:10000/glmproduct/category/list/tree路径才能够正常访问，所以会报404异常。</a></p>
<p><strong>解决方法</strong>就是定义一个product路由规则，进行路径重写：</p>
<p><strong>配置路由</strong></p>
<h3 id="关于请求路径重写："><a href="#关于请求路径重写：" class="headerlink" title="关于请求路径重写："></a>关于请求路径重写：</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">gateway</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">routes</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">-</span> <span class="string">id: rewritepath_route</span></span><br><span class="line">        <span class="attr">uri</span>: <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">-</span> <span class="string">Path=/foo/**</span></span><br><span class="line">        <span class="attr">filters</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">-</span> <span class="string">RewritePath=/red(?&lt;segment&gt;/?.*), $\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<p>在路由配置文件application.yml配置路由</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 精确的路由要放在/api的admin_route上面</span></span><br><span class="line">     <span class="attr">-</span> <span class="string">id: product-route</span></span><br><span class="line">       <span class="attr">uri</span>: <span class="string">ib://glm-product</span></span><br><span class="line">       <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">         <span class="attr">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">       <span class="attr">filters</span>:  <span class="string">#局部过滤器</span></span><br><span class="line">         <span class="attr">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;  #重写路径，/api/xx过滤成/xx</span></span><br></pre></td></tr></table></figure>

<p><strong>坑点：</strong></p>
<ul>
<li>精确的路由要放到上面，高优先级</li>
<li>服务名不能有下划线，否则会报错：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508194702914.png" alt="image-20230508194702914"></p>
<p><strong>目前gateway的yml：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 88</span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">        - <span class="built_in">id</span>: baidu-route              <span class="comment"># 每一个路由的名字，唯一即可</span></span><br><span class="line">          uri: https://www.baidu.com   <span class="comment"># 匹配后提供服务的路由地址</span></span><br><span class="line">          predicates:</span><br><span class="line">            - Query=url,baidu         <span class="comment">#如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line"></span><br><span class="line">        - <span class="built_in">id</span>: qq_route                  <span class="comment"># 每一个路由的名字，唯一即可</span></span><br><span class="line">          uri: https://www.qq.com   <span class="comment"># 匹配后提供服务的路由地址</span></span><br><span class="line">          predicates: <span class="comment"># 断言规则</span></span><br><span class="line">            - Query=url,qq         <span class="comment">#如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 精确的路由要放在/api的admin_route上面</span></span><br><span class="line">        - <span class="built_in">id</span>: product-route</span><br><span class="line">          uri: ib://glm-product</span><br><span class="line">          predicates:</span><br><span class="line">            - Path=/api/glmproduct/**</span><br><span class="line">          filters:  <span class="comment">#局部过滤器</span></span><br><span class="line">            - RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;  <span class="comment">#重写路径，/api/xx过滤成/xx</span></span><br><span class="line">        </span><br><span class="line">        - <span class="built_in">id</span>: admin-route</span><br><span class="line">          uri: lb://renren-fast    <span class="comment"># uri路由的目标地址。lb就是负载均衡，后面跟服务名称。</span></span><br><span class="line">          <span class="comment">#断言工厂的Path，请求路径必须符合指定规则</span></span><br><span class="line">          predicates:</span><br><span class="line">            - Path=/api/**    <span class="comment"># 把所有api开头的请求都转发给renren-fast</span></span><br><span class="line">          filters:  <span class="comment">#局部过滤器。回顾默认过滤器default-filters是与routes同级</span></span><br><span class="line">            - RewritePath=/api/(?&lt;segment&gt;/?.*), /renren-fast/$\&#123;segment&#125;</span><br><span class="line">            <span class="comment">#路径重写。逗号左边是原路径，右边是重写后的路径</span></span><br><span class="line">          <span class="comment"># 默认规则， 请求过来：http://localhost:88/api/captcha.jpg   转发--&gt;  http://renren-fast:8080/renren-fast/captcha.jpg</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在路由规则的顺序上，将精确的路由规则放置到模糊的路由规则的前面，否则的话，精确的路由规则将不会被匹配到，类似于异常体系中try catch子句中异常的处理顺序。</p>
<p>重启路由，观察测试结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508195310303.png" alt="image-20230508195310303"></p>
<h3 id="2、使用nacos抽取gateway模块配置"><a href="#2、使用nacos抽取gateway模块配置" class="headerlink" title="2、使用nacos抽取gateway模块配置"></a>2、使用nacos抽取gateway模块配置</h3><ol>
<li><p>配置nacos发现注册服务</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">application</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">glm-gateway</span></span><br><span class="line">  <span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">nacos</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">server-addr</span>: <span class="string">127.0.0.1:8848</span></span><br><span class="line">      <span class="attr">discovery</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">namespace</span>: <span class="string">7037a071-581e-4c47-9319-9daccf89571d</span></span><br><span class="line">        <span class="attr">group</span>: <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">      <span class="attr">config</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">namespace</span>: <span class="string">d4c9417f-a388-4703-83f0-089b6f75006d</span></span><br><span class="line">        <span class="attr">group</span>: <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">        <span class="attr">file-extension</span>: <span class="string">yaml</span></span><br><span class="line">        <span class="attr">refresh-enabled</span>: <span class="string">true</span></span><br><span class="line">  <span class="attr">profiles</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">active</span>: <span class="string">dev   #指定当前开发环境环境名</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>配置gateway配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">port</span>: <span class="string">88</span></span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">gateway</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">routes</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: baidu-route              # 每一个路由的名字，唯一即可</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">https://www.baidu.com   # 匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Query=url,baidu         #如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: qq_route                  # 每一个路由的名字，唯一即可</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">https://www.qq.com   # 匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates</span>: <span class="string"># 断言规则</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Query=url,qq         #如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        # 精确的路由要放在/api的admin_route上面</span></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: product-route</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">lb://glm-product</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Path=/api/glmproduct/**</span></span><br><span class="line">          <span class="attr">filters</span>:  <span class="string">#局部过滤器</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;  #重写路径，/api/xx过滤成/xx</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: admin-route</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">lb://renren-fast    # uri路由的目标地址。lb就是负载均衡，后面跟服务名称。</span></span><br><span class="line"><span class="comment">          #断言工厂的Path，请求路径必须符合指定规则</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Path=/api/**    # 把所有api开头的请求都转发给renren-fast</span></span><br><span class="line">          <span class="attr">filters</span>:  <span class="string">#局部过滤器。回顾默认过滤器default-filters是与routes同级</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*), /renren-fast/$\&#123;segment&#125;</span></span><br><span class="line"><span class="comment">            #路径重写。逗号左边是原路径，右边是重写后的路径</span></span><br><span class="line"><span class="comment">          # 默认规则， 请求过来：http://localhost:88/api/captcha.jpg   转发--&gt;  http://renren-fast:8080/renren-fast/captcha.jpg</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3、修改前端分类组件，category-vue"><a href="#3、修改前端分类组件，category-vue" class="headerlink" title="3、修改前端分类组件，category.vue"></a>3、修改前端分类组件，category.vue</h3><p>发现返回的是一个对象，对象.data.data才是我们要的数据。  </p>
<p>src&#x2F;views&#x2F;mudules&#x2F;product&#x2F;category.vue</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508212509773.png" alt="image-20230508212509773"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508212452621.png" alt="image-20230508212452621"></p>
<h3 id="4、启动product测试"><a href="#4、启动product测试" class="headerlink" title="4、启动product测试"></a>4、启动product测试</h3><p>启动product模块，访问<a target="_blank" rel="noopener" href="http://localhost:10000/glmproduct/category/list/tree">http://localhost:10000/glmproduct/category/list/tree</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508212736609.png" alt="image-20230508212736609"></p>
<p>启动renren-fast后台管理模块，访问<a target="_blank" rel="noopener" href="http://localhost:8001/#/product-category">http://localhost:8001/#/product-category</a> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508212802988.png" alt="image-20230508212802988"></p>
<h2 id="5、逻辑删除三级分类"><a href="#5、逻辑删除三级分类" class="headerlink" title="5、逻辑删除三级分类"></a>5、逻辑删除三级分类</h2><h3 id="1、前端，仅无子分类可删除，仅一二级分类可新增"><a href="#1、前端，仅无子分类可删除，仅一二级分类可新增" class="headerlink" title="1、前端，仅无子分类可删除，仅一二级分类可新增"></a>1、前端，仅无子分类可删除，仅一二级分类可新增</h3><p><strong>准备：</strong> </p>
<ul>
<li><p>elementUI选择tree树形控件的自定义节点内容，复制粘贴两个按钮到自己category.vue的<el-tree>标签下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508213427217.png" alt="image-20230508213427217"></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- node代表当前结点（是否展开等信息，element-ui自带属性），data是结点数据，是自己的数据。 --&gt;</span><br><span class="line">    &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">        &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;() =&gt; append(data)&quot;&gt;</span><br><span class="line">          Append</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;() =&gt; remove(node, data)&quot;&gt;</span><br><span class="line">          Delete</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p><strong>分析步骤：</strong></p>
<ul>
<li><p>在每一个菜单后面添加<code>append, delete</code></p>
</li>
<li><p>点击按钮时，不进行菜单的打开合并，<strong>仅点击箭头时展示子分类</strong><code>:**expand-on-click-node=&quot;false&quot;**</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508213709630.png" alt="image-20230508213709630"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">:expand-on-click-node=<span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>当没有子菜单时，才可以显示delete按钮。当为一级、二级菜单时，才显示append按钮。使用v-if</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">v-<span class="keyword">if</span>=<span class="string">&quot;node.level &lt;= 2&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">v-<span class="keyword">if</span>=<span class="string">&quot;node.childNodes.length == 0&quot;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p><el-tree>添加<strong>多选框</strong><code>show-checkbox</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508213002805.png" alt="image-20230508213002805"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508213013496.png" alt="image-20230508213013496"></p>
</li>
<li><p>设置<code>node-key=&quot;&quot;</code>标识每一个节点的不同</p>
</li>
</ul>
<h3 id="2、前端，删除逻辑实现，抽取请求到代码片段"><a href="#2、前端，删除逻辑实现，抽取请求到代码片段" class="headerlink" title="2、前端，删除逻辑实现，抽取请求到代码片段"></a>2、前端，删除逻辑实现，抽取请求到代码片段</h3><p><strong>抽取请求代码块到代码片段：</strong></p>
<p>新增两个代码块，发送get请求和post请求。 <code>文件-&gt;首选项-&gt;用户片段-&gt;新建全局代码片段，文件名vue.code-snippets（snippets译为代码片段，片段）</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;Print to console&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;prefix&quot;</span>: <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">		<span class="string">&quot;body&quot;</span>: [</span><br><span class="line">			<span class="string">&quot;&lt;!-- $1 --&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;template&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;div class=&#x27;$2&#x27;&gt;$5&lt;/div&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;/template&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;script&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;export default &#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//import引入的组件需要注入到对象中才能使用&quot;</span>,</span><br><span class="line">			<span class="string">&quot;components: &#123;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;data() &#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//这里存放数据&quot;</span>,</span><br><span class="line">			<span class="string">&quot;return &#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//监听属性 类似于data概念&quot;</span>,</span><br><span class="line">			<span class="string">&quot;computed: &#123;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//监控data中的数据变化&quot;</span>,</span><br><span class="line">			<span class="string">&quot;watch: &#123;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//方法集合&quot;</span>,</span><br><span class="line">			<span class="string">&quot;methods: &#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//生命周期 - 创建完成（可以访问当前this实例）&quot;</span>,</span><br><span class="line">			<span class="string">&quot;created() &#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;//生命周期 - 挂载完成（可以访问DOM元素）&quot;</span>,</span><br><span class="line">			<span class="string">&quot;mounted() &#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;beforeCreate() &#123;&#125;, //生命周期 - 创建之前&quot;</span>,</span><br><span class="line">			<span class="string">&quot;beforeMount() &#123;&#125;, //生命周期 - 挂载之前&quot;</span>,</span><br><span class="line">			<span class="string">&quot;beforeUpdate() &#123;&#125;, //生命周期 - 更新之前&quot;</span>,</span><br><span class="line">			<span class="string">&quot;updated() &#123;&#125;, //生命周期 - 更新之后&quot;</span>,</span><br><span class="line">			<span class="string">&quot;beforeDestroy() &#123;&#125;, //生命周期 - 销毁之前&quot;</span>,</span><br><span class="line">			<span class="string">&quot;destroyed() &#123;&#125;, //生命周期 - 销毁完成&quot;</span>,</span><br><span class="line">			<span class="string">&quot;activated() &#123;&#125;, //如果页面有keep-alive缓存功能，这个函数会触发&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;/script&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;style scoped&gt;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;$4&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&lt;/style&gt;&quot;</span></span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;description&quot;</span>: <span class="string">&quot;生成vue模板&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;http-get请求&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;prefix&quot;</span>: <span class="string">&quot;httpget&quot;</span>,</span><br><span class="line">		<span class="string">&quot;body&quot;</span>: [</span><br><span class="line">			<span class="string">&quot;this.\\$http(&#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;url: this.\\$http.adornUrl(&#x27;&#x27;),&quot;</span>,</span><br><span class="line">			<span class="string">&quot;method:&#x27;get&#x27;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;params:this.\\$http.adornParams(&#123;&#125;)&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;).then((&#123;data&#125;)=&gt;&#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;)&quot;</span></span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;description&quot;</span>: <span class="string">&quot;httpGET请求&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;http-post请求&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;prefix&quot;</span>: <span class="string">&quot;httppost&quot;</span>,</span><br><span class="line">		<span class="string">&quot;body&quot;</span>: [</span><br><span class="line">			<span class="string">&quot;this.\\$http(&#123;&quot;</span>,</span><br><span class="line">			<span class="string">&quot;url:this.\\$http.adornUrl(&#x27;&#x27;),&quot;</span>,</span><br><span class="line">			<span class="string">&quot;method:&#x27;post&#x27;,&quot;</span>,</span><br><span class="line">			<span class="string">&quot;data: this.\\$http.adornData(data, false)&quot;</span>,</span><br><span class="line">			<span class="string">&quot;&#125;).then((&#123;data&#125;)=&gt;&#123; &#125;)&quot;</span></span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;description&quot;</span>: <span class="string">&quot;httpPOST请求&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用代码片段：</strong></p>
<p>在category.vue的remove方法里输入httppost回车即可：</p>
<p>然后根据下面的删除逻辑进行操作：</p>
<p><strong>删除逻辑：</strong></p>
<ul>
<li>编写前端remove方法，实现向后端发送请求</li>
<li>点击delete弹出提示框，是否删除这个节点： elementui中MessageBox 弹框中的确认消息添加到删除之前</li>
<li>删除成功后有消息提示： elementui中Message 消息提示</li>
<li>删除后刷新页面后，分类应该保持之前展开状态: el-tree组件的default-expanded-keys属性,默认展开。 每次删除之后，把删除菜单的父菜单的id值赋给默认展开值即可。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在&lt;el-tree&gt;中设置默认展开属性，绑定给expandedKey</span></span><br><span class="line">:<span class="keyword">default</span>-expanded-keys=<span class="string">&quot;expandedKey&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//data中添加属性，删除后给它赋值父节点id，令树形控件刷新后展开</span></span><br><span class="line"><span class="attr">expandedKey</span>: [],</span><br><span class="line"> </span><br><span class="line"><span class="comment">//完整的remove方法</span></span><br><span class="line">    <span class="title function_">remove</span>(<span class="params">node, data</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ids = [data.<span class="property">catId</span>];</span><br><span class="line">      <span class="variable language_">this</span>.$confirm(<span class="string">`是否删除【<span class="subst">$&#123;data.name&#125;</span>】菜单？`</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/delete&quot;</span>),</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(ids, <span class="literal">false</span>),</span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&quot;菜单删除成功&quot;</span>,</span><br><span class="line">              <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//刷新出新的菜单</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">            <span class="comment">//设置需要默认展开的菜单。删除后给它赋值父节点id，令树形控件刷新后展开</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [node.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span>]</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="3、后端，逻辑删除-TableLogic"><a href="#3、后端，逻辑删除-TableLogic" class="headerlink" title="3、后端，逻辑删除**@TableLogic**"></a><strong>3、后端，逻辑删除</strong><code>**@TableLogic**</code></h3><ul>
<li>查看controller，发现参数<code>@RequestBody</code>注解，请求体里面的数据，只有post请求才有请求体。</li>
</ul>
<p><strong>mybatisplus逻辑删除步骤：</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.baomidou.com/pages/6b03c5/">逻辑删除 | MyBatis-Plus</a></p>
<ul>
<li><strong>方法一（mp3.3.0版本后，不推荐怕忘）：配置yml，全局</strong></li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">global-config</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">db-config</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">logic-delete-field</span>: <span class="string">isDelete # 全局逻辑删除的实体字段名(since 3.3.0,配置本项后可以忽略不配置实体类注解@TableLogic)</span></span><br><span class="line">      <span class="attr">logic-delete-value</span>: <span class="string">1 # 逻辑已删除值(默认为 1)。</span></span><br><span class="line">      <span class="attr">logic-not-delete-value</span>: <span class="string">0 # 逻辑未删除值(默认为 0)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>方法二（mp所有版本，推荐）：</strong><ul>
<li><strong>实体类成员变量加上</strong><code>**@TableLogic**(value = &quot;0&quot;, delval = &quot;1&quot;)</code>注解</li>
</ul>
</li>
</ul>
<p><strong>注意：本项目</strong>使用的是category表的<strong>show_status字段</strong>，<strong>逻辑删除值正好相反</strong>，状态为1表示未删除，状态为0表示删除。</p>
<p><strong>CategoryEntity注解逻辑删除：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否显示[0-不显示，1显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableLogic(value = &quot;1&quot;,delval = &quot;0&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></table></figure>

<p><strong>service和controller不用改，使用mybatisplus生成的即可。</strong></p>
<ul>
<li><strong>重启项目，发送http请求：</strong></li>
</ul>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">### 测试删除分类数据</span><br><span class="line">POST &#123;&#123;gateway_host&#125;&#125;/api/glmproduct/category/delete</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">[500]</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230508225706075.png" alt="image-20230508225706075"></p>
<p>测试逻辑删除成功</p>
<h2 id="6、新增三级分类（仅前端）"><a href="#6、新增三级分类（仅前端）" class="headerlink" title="6、新增三级分类（仅前端）"></a>6、新增三级分类（仅前端）</h2><p> <strong>后端已完成，用mybatisplus自动生成的新增即可。</strong></p>
<p><strong>实现步骤：</strong></p>
<p><strong>1、elementui中<code>Dialog 对话框</code></strong></p>
<ul>
<li>一个会话的属性为:<code>visible.sync=“dialogVisible”</code></li>
<li>导出的data中”dialogVisible &#x3D; false”</li>
<li>点击确认或者取消后的逻辑都是@click&#x3D;“dialogVisible &#x3D; false” 关闭会话</li>
</ul>
<p><strong>对话框组件el-dialog：</strong></p>
<p>对话框标签el-dialog放在el-tree标签上下都是可以的，主要是visible.sync属性控制对话框的显示和隐藏。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--对话框组件--&gt;</span><br><span class="line">	&lt;el-dialog title=&quot;提示&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;30%&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;categroy&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addCategory&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p><strong>js代码：</strong> </p>
<blockquote>
<p><strong>注意：category属性</strong>用来接收输入框的参数，<strong>需要赋值默认属性</strong>，包括父id，层级（这两项el-tree增函数实参data里就有）、展示状态为1，排序值是0</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1data中新增数据</span></span><br><span class="line"><span class="comment">//按照数据库格式声明的数据。注意category属性用来接收输入框的参数，需要赋值默认属性，包括父id，层级、展示状态为1，排序值是0</span></span><br><span class="line">      <span class="attr">categroy</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;&quot;</span>, <span class="attr">parentCid</span>: <span class="number">0</span>, <span class="attr">catLevel</span>: <span class="number">0</span>, <span class="attr">showStatus</span>: <span class="number">1</span>, <span class="attr">sort</span>: <span class="number">0</span> &#125;,</span><br><span class="line"><span class="comment">//判断是否显示对话框</span></span><br><span class="line">      <span class="attr">dialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line"> </span><br><span class="line">          </span><br><span class="line"><span class="comment">//修改append方法，新增addCategory方法</span></span><br><span class="line"><span class="comment">//点击append后，计算category属性，显示对话框</span></span><br><span class="line">    <span class="title function_">append</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;append&quot;</span>, data);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">parentCid</span> = data.<span class="property">catId</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">catLevel</span> = data.<span class="property">catLevel</span> * <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line"><span class="comment">//点击确定后，发送post请求</span></span><br><span class="line"><span class="comment">//成功后显示添加成功，展开刚才的菜单</span></span><br><span class="line">    <span class="title function_">addCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;提交的数据&quot;</span>, <span class="variable language_">this</span>.<span class="property">categroy</span>);</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/save&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(<span class="variable language_">this</span>.<span class="property">categroy</span>, <span class="literal">false</span>),</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&quot;添加成功&quot;</span>,</span><br><span class="line">              <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//刷新出新的菜单</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">            <span class="comment">//设置需要默认展开的菜单</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [<span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">parentCid</span>];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="7、修改分类内容"><a href="#7、修改分类内容" class="headerlink" title="7、修改分类内容"></a>7、修改分类内容</h2><h3 id="1、后端，修改“回显方法”结果对象的键为”data”"><a href="#1、后端，修改“回显方法”结果对象的键为”data”" class="headerlink" title="1、后端，修改“回显方法”结果对象的键为”data”"></a>1、后端，修改“回显方法”结果对象的键为”data”</h3><p>product模块的<strong>CategoryController</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509084149615.png" alt="image-20230509084149615"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/info/&#123;catId&#125;&quot;)</span></span><br><span class="line">   <span class="comment">//@RequiresPermissions(&quot;glmproduct:category:info&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;catId&quot;)</span> Long catId)</span>&#123;</span><br><span class="line">	<span class="type">CategoryEntity</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(catId);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, category);</span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509084334718.png" alt="image-20230509084334718"></p>
<h3 id="2、前端，修改和新增共享表单窗口el-dialog、表单回显"><a href="#2、前端，修改和新增共享表单窗口el-dialog、表单回显" class="headerlink" title="2、前端，修改和新增共享表单窗口el-dialog、表单回显"></a>2、前端，修改和新增共享表单窗口el-dialog、表单回显</h3><p>实现修改名称，图标，计量单位。</p>
<p>1、新增Edit按钮：复制之前的append，再新增button下面添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; edit(data)&quot;</span><br><span class="line">          v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          编辑</span><br><span class="line">        &lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>2、查看controller，发现updata方法是由id进行更新的，所以data中的category中新增catId</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509174811893.png" alt="image-20230509174811893"></p>
<p>3、增加、修改的时候也修改图标和计量单位，所以data的category新增inco，productUnit</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509174828167.png" alt="image-20230509174828167"></p>
<p>4、新建edit方法，用来绑定Edit按钮。新建editCategory方法，用来绑定对话框的确定按钮。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//绑定Edit按钮</span></span><br><span class="line">   <span class="title function_">edit</span>(<span class="params">data</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;edit=&gt;&quot;</span>, data);</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="comment">//编辑方法</span></span><br><span class="line">   <span class="title function_">editCategory</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>5、复用对话框：</p>
<ul>
<li><p><strong>data数据中新增属性<code>dialogType</code><strong>，</strong>用来区分提交时是新增还是编辑</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509175044999.png" alt="image-20230509175044999"></p>
</li>
<li><p>新建方法<code>submitData</code>，与对话框的确定按钮进行绑定，在方法中判断，如果<code>dialogType==add</code>调用addCategory()，如果<code>dialogType==edit</code>调用editCategory()</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//绑定对话框的确定按钮，根据dialogType判断调用哪个函数</span></span><br><span class="line">    <span class="title function_">submitData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dialogType</span> == <span class="string">&quot;add&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addCategory</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dialogType</span> == <span class="string">&quot;edit&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">editCategory</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>


</li>
<li><p>data数据中新增<code>title</code>,绑定对话框的title，用来做提示信息。判断<code>dialogType</code>的值，来选择提示信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509175539390.png" alt="image-20230509175539390"></p>
</li>
</ul>
<p>​	6、<strong>修改回显必须发请求，而非直接从实参中获取。</strong>防止多个人同时操作，对话框中的回显的信息应该是由数据库中读出来的：点击Edit按钮，发送httpget请求。（看好返回的数据）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//绑定Edit按钮,设置dialogType、title，从后台读取数据，展示到对话框内</span></span><br><span class="line">   <span class="title function_">edit</span>(<span class="params">data</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;edit=&gt;&quot;</span>, data);</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">dialogType</span> = <span class="string">&quot;eidt&quot;</span>;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;编辑菜单&quot;</span>;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">     <span class="comment">//后台读取数据回显</span></span><br><span class="line">     <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">       <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/info/$&#123;data.catId&#125;&quot;</span>),</span><br><span class="line">       <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">     &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;编辑回显：&quot;</span>, data);</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">catId</span> = data.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">name</span> = data.<span class="property">data</span>.<span class="property">name</span>;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">inco</span> = data.<span class="property">data</span>.<span class="property">inco</span>;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">productUnit</span> = data.<span class="property">data</span>.<span class="property">productUnit</span>;</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>7、编辑<code>editCategory</code>方法：</p>
<ul>
<li><p>controller之中的更新是动态更新，根据id，发回去什么值修改什么值，所以把要修改的数据发回后端就好。</p>
</li>
<li><p>成功之后发送提示消息，展开刚才的菜单。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//绑定对话框的确定按钮，向后台发送更新请求，传过去想要修改的字段</span></span><br><span class="line">    <span class="title function_">editCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> &#123; catId, name, icon, productUnit &#125; = <span class="variable language_">this</span>.<span class="property">categroy</span>;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/update&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(&#123; catId, name, icon, productUnit &#125;, <span class="literal">false</span>),</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;修改成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//刷新出新的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">        <span class="comment">//设置需要默认展开的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [<span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">parentCid</span>];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
<p>8、编辑之后，再点击添加，发现会回显刚才编辑的信息。所以在<code>append</code>方法中重置回显的信息。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//修改append方法，新增addCategory方法</span></span><br><span class="line">    <span class="comment">//点击append后，计算category属性，,显示对话框</span></span><br><span class="line">    <span class="title function_">append</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;append&quot;</span>, data);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;添加菜单&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogType</span> = <span class="string">&quot;add&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="comment">//清空编辑之后的回显数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">parentCid</span> = data.<span class="property">catId</span>;</span><br><span class="line">      <span class="comment">//这里获取的catLevel是字符串需要*1加1</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">catLevel</span> = data.<span class="property">catLevel</span> * <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">icon</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">productUnit</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p><strong>坑点：</strong></p>
<ul>
<li><p><strong>修改回显必须发请求，而非直接从实参中获取</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509181139448.png" alt="image-20230509181139448"></p>
</li>
<li><p><strong>因为新增修改共享表单对话框，所以还要修改添加方法，第一步初始化数据</strong>，这样data里定义category时也不用初始化了<strong>：</strong></p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509181331129.png" alt="image-20230509181331129"></p>
<ul>
<li><strong>提交修改表单时，不能</strong>像新增一样<strong>把携带初始化值的category直接提交上去。</strong></li>
</ul>
<p><strong>方法一：局部更新，</strong>只解构出表单里的属性封装成对象，再提交。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509181421088.png" alt="image-20230509181421088"></p>
<p> <strong>方法二：全量更新，</strong>回显时，把其他数据库字段也赋值：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509181954096.png" alt="image-20230509181954096"></p>
<p><strong>代码+注释:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--编辑按钮--&gt;</span><br><span class="line">		  &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;() =&gt; edit(data)&quot;&gt;</span><br><span class="line">            Edit</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!--可复用的对话框--&gt;</span><br><span class="line">	&lt;el-dialog :title=&quot;title&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;30%&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;categroy&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.inco&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;categroy.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//data， 新增了title、dialogType。 categroy中新增了inco、productUnit、catId</span></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">dialogType</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">categroy</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">parentCid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">catLevel</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">showStatus</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">sort</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">inco</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">productUnit</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">catId</span>: <span class="literal">null</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">dialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">menus</span>: [],</span><br><span class="line">      <span class="attr">expandedKey</span>: [],</span><br><span class="line">      <span class="attr">defaultProps</span>: &#123;</span><br><span class="line">        <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>, <span class="comment">//子节点</span></span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;name&quot;</span>, <span class="comment">//name属性作为标签的值，展示出来</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line"> </span><br><span class="line"><span class="comment">//方法</span></span><br><span class="line">     <span class="comment">//绑定对话框的确定按钮，根据dialogType判断调用哪个函数</span></span><br><span class="line">    <span class="title function_">submitData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dialogType</span> == <span class="string">&quot;add&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addCategory</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dialogType</span> == <span class="string">&quot;edit&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">editCategory</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//绑定Edit按钮，设置dialogType、title，从后台读取数据，展示到对话框内</span></span><br><span class="line">    <span class="title function_">edit</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogType</span> = <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;修改菜单&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">`/glmproduct/category/info/<span class="subst">$&#123;data.catId&#125;</span>`</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">catId</span> = data.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">name</span> = data.<span class="property">data</span>.<span class="property">name</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">inco</span> = data.<span class="property">data</span>.<span class="property">inco</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">productUnit</span> = data.<span class="property">data</span>.<span class="property">productUnit</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//绑定对话框的确定按钮，向后台发送更新请求，传过去想要修改的字段</span></span><br><span class="line">    <span class="title function_">editCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> &#123; catId, name, inco, productUnit &#125; = <span class="variable language_">this</span>.<span class="property">categroy</span>;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/update&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(&#123; catId, name, inco, productUnit &#125;, <span class="literal">false</span>),</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;修改成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//刷新出新的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">        <span class="comment">//设置需要默认展开的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [<span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">parentCid</span>];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;，</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//点击append按钮，清空编辑之后的回显数据</span></span><br><span class="line">    <span class="title function_">append</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogType</span> = <span class="string">&quot;add&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;添加菜单&quot;</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;append&quot;</span>, data);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">parentCid</span> = data.<span class="property">catId</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">catLevel</span> = data.<span class="property">catLevel</span> * <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">name</span> = <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">inco</span> = <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categroy</span>.<span class="property">productUnit</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="8、修改分类层级关系，拖拽"><a href="#8、修改分类层级关系，拖拽" class="headerlink" title="8、修改分类层级关系，拖拽"></a>8、修改分类层级关系，拖拽</h2><h3 id="1、前端，拖拽功能"><a href="#1、前端，拖拽功能" class="headerlink" title="1、前端，拖拽功能"></a>1、前端，拖拽功能</h3><p><a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/tree">Element - The world’s most popular Vue UI framework</a></p>
<ul>
<li>在**<code>&lt;el-tree&gt;</code>中加入属性<code>draggable</code>表示节点可拖拽**。</li>
<li>在<code>&lt;el-tree&gt;</code>中加入<strong>属性<code>:allow-drop=&quot;allowDrop&quot;</code><strong>，</strong>拖拽时判定目标节点能否被放置。</strong></li>
<li><strong><code>allowDrop</code>有三个参数</strong><code>draggingNode</code>表示拖拽的节点，**<code>dropNode</code>表示拖拽到哪个节点，<code>type</code>表示拖拽的类型’prev’、‘inner’ 和 ‘next’，表示拖拽到目标节点之前、里面、之后。**</li>
</ul>
<p><strong>注意：</strong>函数实现判断，拖拽后必须保持数型的三层结构。</p>
<ul>
<li>节点的深度 &#x3D; 最深深度 - 当前深度 + 1</li>
<li>当拖拽节点拖拽到目标节点的内部，要满足： <strong>拖拽节点的深度 + 目标节点的深度 &lt;&#x3D; 3</strong></li>
<li>当拖拽节点拖拽的目标节点的两侧，要满足： 拖拽节点的深度 + 目标节点的父节点的深度 &lt;&#x3D; 3</li>
</ul>
<p><strong>代码 + 注释：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--el-tree中添加属性--&gt;</span><br><span class="line">	   draggable</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// data中新增属性，用来记录当前节点的最大深度</span></span><br><span class="line"><span class="attr">maxLevel</span>: <span class="number">1</span>,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//新增方法</span></span><br><span class="line">    <span class="title function_">allowDrop</span>(<span class="params">draggingNode, dropNode, type</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;allowDrag:&quot;</span>, draggingNode, dropNode, type);</span><br><span class="line">      <span class="comment">//节点的最大深度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">countNodeLevel</span>(draggingNode.<span class="property">data</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;level:&quot;</span>, <span class="variable language_">this</span>.<span class="property">maxLevel</span>);</span><br><span class="line">      <span class="comment">//当前节点的深度</span></span><br><span class="line">      <span class="keyword">let</span> deep = (<span class="variable language_">this</span>.<span class="property">maxLevel</span> - draggingNode.<span class="property">data</span>.<span class="property">catLevel</span>) + <span class="number">1</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(deep)</span><br><span class="line">      <span class="keyword">if</span> (type == <span class="string">&quot;inner&quot;</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> (deep + dropNode.<span class="property">level</span>) &lt;= <span class="number">3</span>;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> (deep + dropNode.<span class="property">parent</span>.<span class="property">level</span>) &lt;= <span class="number">3</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//计算当前节点的最大深度</span></span><br><span class="line">    <span class="title function_">countNodeLevel</span>(<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="comment">//找到所有的子节点，求出最大深度</span></span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">children</span> != <span class="literal">null</span> &amp;&amp; node.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">children</span>.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (node.<span class="property">children</span>[i].<span class="property">catLevel</span> &gt; <span class="variable language_">this</span>.<span class="property">maxLevel</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">maxLevel</span> = node.<span class="property">children</span>[i].<span class="property">catLevel</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">countNodeLevel</span>(node.<span class="property">children</span>[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="2、前端，拖拽后的数据收集"><a href="#2、前端，拖拽后的数据收集" class="headerlink" title="2、前端，拖拽后的数据收集"></a>2、前端，拖拽后的数据收集</h3><ul>
<li>在<el-tree>中加入属性@node-drop&#x3D;”handleDrop”,表示拖拽事件结束后触发事件handleDrop,handleDrop共四个参数，draggingNode：被拖拽节点对应的 Node; dropNode:结束拖拽时最后进入的节点; dropType:被拖拽节点的放置位置（before、after、inner）;ev:event</li>
<li><strong>拖拽可能影响的节点的数据：parentCid、catLevel、sort</strong><ul>
<li>data中新增<code>updateNodes</code>，把所有要修改的节点都传进来。</li>
<li>要修改的数据：拖拽节点的parentCid、catLevel、sort</li>
<li>要修改的数据：新的兄弟节点的sort （把新的节点收集起来，然后重新排序）</li>
<li>要修改的数据：子节点的catLevel</li>
</ul>
</li>
</ul>
<p>代码 + 注释：</p>
<ol>
<li><p>el-tree中新增属性，绑定handleDrop，表示拖拽完触发</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@node-drop=&quot;handleDrop&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>data 中新增数据，用来记录需要更新的节点（拖拽的节点（parentCid、catLevel、sort），拖拽后的兄弟节点（sort），拖拽节点的子节点（catLevel））</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">updateNodes: [],</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>新增方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">handleDrop</span>(<span class="params">draggingNode, dropNode, dropType, ev</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleDrop: &quot;</span>, draggingNode, dropNode, dropType);</span><br><span class="line">      <span class="comment">//1、当前节点最新父节点的id</span></span><br><span class="line">      <span class="keyword">let</span> pCid = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//拖拽后的兄弟节点，分两种情况，一种是拖拽到两侧，一种是拖拽到内部</span></span><br><span class="line">      <span class="keyword">let</span> sibings = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (dropType == <span class="string">&quot;before&quot;</span> || dropType == <span class="string">&quot;after&quot;</span>) &#123;</span><br><span class="line">        pCid =</span><br><span class="line">          dropNode.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span> == <span class="literal">undefined</span></span><br><span class="line">            ? <span class="number">0</span></span><br><span class="line">            : dropNode.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">        sibings = dropNode.<span class="property">parent</span>.<span class="property">childNodes</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pCid = dropNode.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">        sibings = dropNode.<span class="property">childNodes</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//2、当前拖拽节点的最新顺序</span></span><br><span class="line">      <span class="comment">//遍历所有的兄弟节点，如果是拖拽节点，传入（catId，sort，parentCid，catLevel），如果是兄弟节点传入（catId，sort）</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sibings.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//如果遍历的是当前正在拖拽的节点</span></span><br><span class="line">        <span class="keyword">if</span> (sibings[i].<span class="property">data</span>.<span class="property">catId</span> == draggingNode.<span class="property">data</span>.<span class="property">catId</span>) &#123;</span><br><span class="line">          <span class="comment">//需要额外修改当前节点的父id，层级，</span></span><br><span class="line">          <span class="keyword">let</span> catLevel = draggingNode.<span class="property">level</span>;</span><br><span class="line">          <span class="keyword">if</span> (sibings[i].<span class="property">level</span> != draggingNode.<span class="property">level</span>) &#123;</span><br><span class="line">            <span class="comment">//当前节点的层级发生变化</span></span><br><span class="line">            catLevel = sibings[i].<span class="property">level</span>;</span><br><span class="line">            <span class="comment">//修改他子节点的层级</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateChildNodeLevel</span>(sibings[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">updateNodes</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">catId</span>: sibings[i].<span class="property">data</span>.<span class="property">catId</span>,</span><br><span class="line">            <span class="attr">sort</span>: i,</span><br><span class="line">            <span class="attr">parentCid</span>: pCid,</span><br><span class="line">            <span class="attr">catLevel</span>: catLevel,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">updateNodes</span>.<span class="title function_">push</span>(&#123; <span class="attr">catId</span>: sibings[i].<span class="property">data</span>.<span class="property">catId</span>, <span class="attr">sort</span>: i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;updateNodes&quot;</span>, <span class="variable language_">this</span>.<span class="property">updateNodes</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pCid</span>.<span class="title function_">push</span>(pCid);</span><br><span class="line">      <span class="comment">//拖拽之后重新置0</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">maxLevel</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>修改拖拽节点的子节点的层级</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改拖拽节点的子节点的层级</span></span><br><span class="line">    <span class="title function_">updateChildNodeLevel</span>(<span class="params">node</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">childNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">childNodes</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="comment">//遍历子节点，传入（catId，catLevel）</span></span><br><span class="line">          <span class="keyword">var</span> cNode = node.<span class="property">childNodes</span>[i].<span class="property">data</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">updateNodes</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">catId</span>: cNode.<span class="property">catId</span>,</span><br><span class="line">            <span class="attr">catLevel</span>: node.<span class="property">childNodes</span>[i].<span class="property">level</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">//处理子节点的子节点</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">updateChildNodeLevel</span>(node.<span class="property">childNodes</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="3、前端，批量拖拽功能"><a href="#3、前端，批量拖拽功能" class="headerlink" title="3、前端，批量拖拽功能"></a>3、前端，批量拖拽功能</h3><ul>
<li>添加开关，控制拖拽功能是否开启</li>
<li>每次拖拽都要和数据库交互，不合理。批量拖拽过后，一次性保存。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--添加拖拽开关和批量保存按钮--&gt;</span><br><span class="line">	&lt;el-switch</span><br><span class="line">      v-model=&quot;draggable&quot;</span><br><span class="line">      active-text=&quot;开启拖拽&quot;</span><br><span class="line">      inactive-text=&quot;关闭拖拽&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-switch&gt;</span><br><span class="line">    &lt;el-button v-if=&quot;draggable&quot; size=&quot;small&quot; round @click=&quot;batchSave&quot;</span><br><span class="line">      &gt;批量保存&lt;/el-button</span><br><span class="line">    &gt;</span><br></pre></td></tr></table></figure>

<p>data中新增数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">pCid</span>:[], <span class="comment">//批量保存过后要展开的菜单id</span></span><br><span class="line"> <span class="attr">draggable</span>: <span class="literal">false</span>, <span class="comment">//绑定拖拽开关是否打开</span></span><br></pre></td></tr></table></figure>

<p>修改了一些方法，修复bug，修改过的方法都贴在下面了</p>
<p><strong>allowDrop:</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">allowDrop</span>(<span class="params">draggingNode, dropNode, type</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;allowDrag:&quot;</span>, draggingNode, dropNode, type);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">maxLevel</span> = draggingNode.<span class="property">level</span>;</span><br><span class="line">      <span class="comment">//节点的最大深度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">countNodeLevel</span>(draggingNode);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前节点的最大深度：&quot;</span>, <span class="variable language_">this</span>.<span class="property">maxLevel</span>);</span><br><span class="line">      <span class="comment">//当前节点的深度</span></span><br><span class="line">      <span class="keyword">let</span> deep = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">maxLevel</span> - draggingNode.<span class="property">level</span>) + <span class="number">1</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前节点的深度&quot;</span>, deep);</span><br><span class="line">      <span class="keyword">if</span> (type == <span class="string">&quot;inner&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> deep + dropNode.<span class="property">level</span> &lt;= <span class="number">3</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deep + dropNode.<span class="property">parent</span>.<span class="property">level</span> &lt;= <span class="number">3</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>计算深度时，用当前数据，而不是数据库中的数据。因为可能还没来得及保存到数据库</p>
<p><strong>countNodeLevel:</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//计算当前节点的最大深度</span></span><br><span class="line">   <span class="title function_">countNodeLevel</span>(<span class="params">node</span>) &#123;</span><br><span class="line">     <span class="comment">//找到所有的子节点，求出最大深度</span></span><br><span class="line">     <span class="keyword">if</span> (node.<span class="property">childNodes</span> != <span class="literal">null</span> &amp;&amp; node.<span class="property">childNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">childNodes</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">if</span> (node.<span class="property">childNodes</span>[i].<span class="property">catLevel</span> &gt; <span class="variable language_">this</span>.<span class="property">maxLevel</span>) &#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">maxLevel</span> = node.<span class="property">childNodes</span>[i].<span class="property">level</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="title function_">countNodeLevel</span>(node.<span class="property">childNodes</span>[i]);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>点击批量保存按钮，发送请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">batchSave</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/update/sort&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(<span class="variable language_">this</span>.<span class="property">updateNodes</span>, <span class="literal">false</span>),</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;菜单顺序修改成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//刷新出新的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">        <span class="comment">//设置需要默认展开的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">expandedKey</span> = <span class="variable language_">this</span>.<span class="property">pCid</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">updateNodes</span> = [];</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p><strong>完整代码：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--添加拖拽开关和批量保存按钮--&gt;</span><br><span class="line">    &lt;el-switch</span><br><span class="line">      v-model=&quot;draggable&quot;</span><br><span class="line">      active-text=&quot;开启拖拽&quot;</span><br><span class="line">      inactive-text=&quot;关闭拖拽&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-switch&gt;</span><br><span class="line">    &lt;el-button v-if=&quot;draggable&quot; size=&quot;small&quot; round @click=&quot;batchSave&quot;</span><br><span class="line">      &gt;批量保存&lt;/el-button</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      @node-click=&quot;handleNodeClick&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      draggable</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- node代表当前结点（是否展开等信息，element-ui自带属性），data是结点数据，是自己的数据。 --&gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            新增</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; edit(data)&quot;</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            编辑</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            删除</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-tree&gt;</span><br><span class="line">    &lt;!--对话框组件--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;提示&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;30%&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;categroy&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.inco&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;categroy.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）</span><br><span class="line">//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  //import引入的组件需要注入到对象中才能使用</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      draggable: false,</span><br><span class="line">      pCid: [],</span><br><span class="line">      menus: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;, //子节点</span><br><span class="line">        label: &quot;name&quot;, //name属性作为标签的值，展示出来</span><br><span class="line">      &#125;,</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      //按照数据库格式声明的数据。注意category属性用来接收输入框的参数，需要赋值默认属性，包括父id，层级、展示状态为1，排序值是0</span><br><span class="line">      categroy: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        catId: null,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        productUnit: &quot;&quot;, //计量单位</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false, //判断是否显示对话框</span><br><span class="line">      dialogType: &quot;&quot;,</span><br><span class="line">      title: &quot;&quot;,</span><br><span class="line">      maxLevel: 0,</span><br><span class="line">      updateNodes: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleNodeClick(data) &#123;</span><br><span class="line">      //   console.log(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    batchSave() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/update/sort&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.updateNodes, false),</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单顺序修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = this.pCid;</span><br><span class="line">      &#125;);</span><br><span class="line">      this.updateNodes = [];</span><br><span class="line">    &#125;,</span><br><span class="line">    allowDrop(draggingNode, dropNode, type) &#123;</span><br><span class="line">      console.log(&quot;allowDrag:&quot;, draggingNode, dropNode, type);</span><br><span class="line">      this.maxLevel = draggingNode.level;</span><br><span class="line">      //节点的最大深度</span><br><span class="line">      this.countNodeLevel(draggingNode);</span><br><span class="line">      console.log(&quot;当前节点的最大深度：&quot;, this.maxLevel);</span><br><span class="line">      //当前节点的深度</span><br><span class="line">      let deep = Math.abs(this.maxLevel - draggingNode.level) + 1;</span><br><span class="line">      console.log(&quot;当前节点的深度&quot;, deep);</span><br><span class="line">      if (type == &quot;inner&quot;) &#123;</span><br><span class="line">        return deep + dropNode.level &lt;= 3;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return deep + dropNode.parent.level &lt;= 3;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    //计算当前节点的最大深度</span><br><span class="line">    countNodeLevel(node) &#123;</span><br><span class="line">      //找到所有的子节点，求出最大深度</span><br><span class="line">      if (node.childNodes != null &amp;&amp; node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          if (node.childNodes[i].catLevel &gt; this.maxLevel) &#123;</span><br><span class="line">            this.maxLevel = node.childNodes[i].level;</span><br><span class="line">          &#125;</span><br><span class="line">          this.countNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDrop(draggingNode, dropNode, dropType, ev) &#123;</span><br><span class="line">      console.log(&quot;handleDrop: &quot;, draggingNode, dropNode, dropType);</span><br><span class="line">      //1、当前节点最新父节点的id</span><br><span class="line">      let pCid = 0;</span><br><span class="line">      //拖拽后的兄弟节点，分两种情况，一种是拖拽到两侧，一种是拖拽到内部</span><br><span class="line">      let sibings = null;</span><br><span class="line">      if (dropType == &quot;before&quot; || dropType == &quot;after&quot;) &#123;</span><br><span class="line">        pCid =</span><br><span class="line">          dropNode.parent.data.catId == undefined</span><br><span class="line">            ? 0</span><br><span class="line">            : dropNode.parent.data.catId;</span><br><span class="line">        sibings = dropNode.parent.childNodes;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        pCid = dropNode.data.catId;</span><br><span class="line">        sibings = dropNode.childNodes;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      //2、当前拖拽节点的最新顺序</span><br><span class="line">      //遍历所有的兄弟节点，如果是拖拽节点，传入（catId，sort，parentCid，catLevel），如果是兄弟节点传入（catId，sort）</span><br><span class="line">      for (let i = 0; i &lt; sibings.length; i++) &#123;</span><br><span class="line">        //如果遍历的是当前正在拖拽的节点</span><br><span class="line">        if (sibings[i].data.catId == draggingNode.data.catId) &#123;</span><br><span class="line">          //需要额外修改当前节点的父id，层级，</span><br><span class="line">          let catLevel = draggingNode.level;</span><br><span class="line">          if (sibings[i].level != draggingNode.level) &#123;</span><br><span class="line">            //当前节点的层级发生变化</span><br><span class="line">            catLevel = sibings[i].level;</span><br><span class="line">            //修改他子节点的层级</span><br><span class="line">            this.updateChildNodeLevel(sibings[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: sibings[i].data.catId,</span><br><span class="line">            sort: i,</span><br><span class="line">            parentCid: pCid,</span><br><span class="line">            catLevel: catLevel,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.updateNodes.push(&#123; catId: sibings[i].data.catId, sort: i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      console.log(&quot;updateNodes&quot;, this.updateNodes);</span><br><span class="line">      this.pCid.push(pCid);</span><br><span class="line">      //拖拽之后重新置0</span><br><span class="line">      this.maxLevel = 0;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改拖拽节点的子节点的层级</span><br><span class="line">    updateChildNodeLevel(node) &#123;</span><br><span class="line">      if (node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          //遍历子节点，传入（catId，catLevel）</span><br><span class="line">          var cNode = node.childNodes[i].data;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: cNode.catId,</span><br><span class="line">            catLevel: node.childNodes[i].level,</span><br><span class="line">          &#125;);</span><br><span class="line">          //处理子节点的子节点</span><br><span class="line">          this.updateChildNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/list/tree&quot;),</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        // console.log(&quot;成功了获取到菜单数据....&quot;, data);</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //绑定对话框的确定按钮，根据dialogType判断调用哪个函数</span><br><span class="line">    submitData() &#123;</span><br><span class="line">      if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.dialogType == &quot;edit&quot;) &#123;</span><br><span class="line">        this.editCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    //绑定Edit按钮,设置dialogType、title，从后台读取数据，展示到对话框内</span><br><span class="line">    edit(data) &#123;</span><br><span class="line">      console.log(&quot;edit=&gt;&quot;, data);</span><br><span class="line">      this.dialogType = &quot;edit&quot;;</span><br><span class="line">      this.title = &quot;编辑菜单&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      //后台读取数据回显</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/glmproduct/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        console.log(&quot;编辑回显数据：&quot;, data);</span><br><span class="line">        this.categroy.catId = data.data.catId;</span><br><span class="line">        this.categroy.name = data.data.name;</span><br><span class="line">        this.categroy.inco = data.data.inco;</span><br><span class="line">        this.categroy.productUnit = data.data.productUnit;</span><br><span class="line">        this.categroy.parentCid = data.data.parentCid;</span><br><span class="line">        // this.categroy.catLevel = data.data.catLevel;</span><br><span class="line">        // this.categroy.sort = data.data.sort;</span><br><span class="line">        // this.categroy.showStatus = data.data.showStatus;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //绑定对话框的确定按钮，向后台发送更新请求，传过去想要修改的字段</span><br><span class="line">    editCategory() &#123;</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.categroy;</span><br><span class="line"></span><br><span class="line">      console.log(&quot;修改数据==&gt;&quot;, &#123; catId, name, icon, productUnit &#125;);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false),</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.categroy.parentCid];</span><br><span class="line">        console.log(&quot;parentCid&quot;, this.categroy.parentCid);</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //修改append方法，新增addCategory方法</span><br><span class="line">    //点击append后，计算category属性，,显示对话框</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.title = &quot;添加菜单&quot;;</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      //清空编辑之后的回显数据</span><br><span class="line">      this.categroy.parentCid = data.catId;</span><br><span class="line">      //这里获取的catLevel是字符串需要*1加1</span><br><span class="line">      this.categroy.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.categroy.name = &quot;&quot;;</span><br><span class="line">      this.categroy.icon = &quot;&quot;;</span><br><span class="line">      this.categroy.productUnit = &quot;&quot;;</span><br><span class="line">      this.categroy.sort = 0;</span><br><span class="line">      this.categroy.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //点击确定后，发送post请求</span><br><span class="line">    //成功后显示添加成功，展开刚才的菜单</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;新增分类数据&quot;, this.categroy);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.categroy, false),</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;添加成功&quot;,</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.categroy.parentCid];</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        this.categroy.name = &quot;&quot;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`此操作将永久删除【$&#123;data.name&#125;】, 是否继续?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/glmproduct/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false),</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单。删除后给它赋值父节点id，令树形控件刷新后展开</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  //监听属性 类似于data概念</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  //监控data中的数据变化</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  //生命周期 - 创建完成（可以访问当前this实例）</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">  //生命周期 - 挂载完成（可以访问DOM元素）</span><br><span class="line">  mounted() &#123;&#125;,</span><br><span class="line">  beforeCreate() &#123;&#125;, //生命周期 - 创建之前</span><br><span class="line">  beforeMount() &#123;&#125;, //生命周期 - 挂载之前</span><br><span class="line">  beforeUpdate() &#123;&#125;, //生命周期 - 更新之前</span><br><span class="line">  updated() &#123;&#125;, //生命周期 - 更新之后</span><br><span class="line">  beforeDestroy() &#123;&#125;, //生命周期 - 销毁之前</span><br><span class="line">  destroyed() &#123;&#125;, //生命周期 - 销毁完成</span><br><span class="line">  activated() &#123;&#125;, //如果页面有keep-alive缓存功能，这个函数会触发</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.custom-tree-node &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding-right: 8px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4、后端实现拖拽功能（批量修改）"><a href="#4、后端实现拖拽功能（批量修改）" class="headerlink" title="4、后端实现拖拽功能（批量修改）"></a>4、后端实现拖拽功能（批量修改）</h3><p><strong>思路：</strong></p>
<ul>
<li>在后端编写批量修改的方法<code>update/sort</code></li>
<li>前端发送post请求，把要修改的数据发送过来</li>
<li>提示信息，展开拖拽节点的父节点</li>
</ul>
<p><strong>CategoryController批量修改</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">//批量修改，参数要传数组，不能传list</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/glmupdate/sort&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">updateSort</span><span class="params">(<span class="meta">@RequestBody</span> CategoryEntity[] category)</span>&#123;</span><br><span class="line">       categoryService.updateBatchById(Arrays.asList(category));</span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>重启product模块</p>
<p><strong>测试批量修改：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">### 测试批量修改</span><br><span class="line">POST &#123;&#123;gateway_host&#125;&#125;/api/glmproduct/category/update/sort</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;catId&quot;: 1,</span><br><span class="line">    &quot;sort&quot; : 10</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;catId&quot;: 226,</span><br><span class="line">    &quot;catLevel&quot;: 2</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509235140546.png" alt="image-20230509235140546"></p>
<p>查询数据库观察测试结果</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pms_category <span class="keyword">where</span> cat_id <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">226</span>)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/image-20230509235216083.png" alt="image-20230509235216083"></p>
<h2 id="9、批量删除分类（仅前端）"><a href="#9、批量删除分类（仅前端）" class="headerlink" title="9、批量删除分类（仅前端）"></a>9、批量删除分类（仅前端）</h2><p><strong>批量删除 后端已完成，用mybatisplus自动生成的新增即可</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 删除</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class="line">   <span class="comment">//@RequiresPermissions(&quot;glmproduct:category:delete&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestBody</span> Long[] catIds)</span>&#123;</span><br><span class="line">	categoryService.removeByIds(Arrays.asList(catIds));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>新增删除按钮</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;danger&quot; size=&quot;small&quot; @click=&quot;batchDelete&quot; round&gt;批量删除&lt;/el-button&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!--eltree中新增属性，用作组件的唯一标示--&gt;</span><br><span class="line">ref=&quot;menuTree&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>批量删除方法</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 批量删除</span></span><br><span class="line">    <span class="title function_">batchDelete</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> catIds = [];</span><br><span class="line">      <span class="keyword">let</span> catNames = [];</span><br><span class="line">      <span class="keyword">let</span> checkedNodes = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">menuTree</span>.<span class="title function_">getCheckedNodes</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;idcheckedNodess&quot;</span>, checkedNodes);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; checkedNodes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        catIds.<span class="title function_">push</span>(checkedNodes[i].<span class="property">catId</span>);</span><br><span class="line">        catNames.<span class="title function_">push</span>(checkedNodes[i].<span class="property">name</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.$confirm(<span class="string">`是否批量删除【<span class="subst">$&#123;catNames&#125;</span>】菜单？`</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/glmproduct/category/delete&quot;</span>),</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(catIds, <span class="literal">false</span>),</span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&quot;菜单批量删除成功&quot;</span>,</span><br><span class="line">              <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="10、前端分类组件category-vue最终代码"><a href="#10、前端分类组件category-vue最终代码" class="headerlink" title="10、前端分类组件category.vue最终代码"></a>10、前端分类组件category.vue最终代码</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--添加拖拽开关和批量保存按钮--&gt;</span><br><span class="line">    &lt;el-switch</span><br><span class="line">      v-model=&quot;draggable&quot;</span><br><span class="line">      active-text=&quot;开启拖拽&quot;</span><br><span class="line">      inactive-text=&quot;关闭拖拽&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-switch&gt;</span><br><span class="line">    &lt;el-button v-if=&quot;draggable&quot; size=&quot;small&quot; round @click=&quot;batchSave&quot;</span><br><span class="line">      &gt;批量保存&lt;/el-button</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; @click=&quot;batchDelete&quot; round</span><br><span class="line">      &gt;批量删除&lt;/el-button</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      @node-click=&quot;handleNodeClick&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      ref=&quot;menuTree&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- node代表当前结点（是否展开等信息，element-ui自带属性），data是结点数据，是自己的数据。 --&gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            新增</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; edit(data)&quot;</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            编辑</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            删除</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-tree&gt;</span><br><span class="line">    &lt;!--对话框组件--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;提示&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;30%&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;categroy&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categroy.inco&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;categroy.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）</span><br><span class="line">//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  //import引入的组件需要注入到对象中才能使用</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      draggable: false,</span><br><span class="line">      pCid: [],</span><br><span class="line">      menus: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;, //子节点</span><br><span class="line">        label: &quot;name&quot;, //name属性作为标签的值，展示出来</span><br><span class="line">      &#125;,</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      //按照数据库格式声明的数据。注意category属性用来接收输入框的参数，需要赋值默认属性，包括父id，层级、展示状态为1，排序值是0</span><br><span class="line">      categroy: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        catId: null,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        productUnit: &quot;&quot;, //计量单位</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false, //判断是否显示对话框</span><br><span class="line">      dialogType: &quot;&quot;,</span><br><span class="line">      title: &quot;&quot;,</span><br><span class="line">      maxLevel: 0,</span><br><span class="line">      updateNodes: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleNodeClick(data) &#123;</span><br><span class="line">      //   console.log(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 批量删除</span><br><span class="line">    batchDelete() &#123;</span><br><span class="line">      let catIds = [];</span><br><span class="line">      let catNames = [];</span><br><span class="line">      let checkedNodes = this.$refs.menuTree.getCheckedNodes();</span><br><span class="line">      console.log(&quot;idcheckedNodess&quot;, checkedNodes);</span><br><span class="line">      for (let i = 0; i &lt; checkedNodes.length; i++) &#123;</span><br><span class="line">        catIds.push(checkedNodes[i].catId);</span><br><span class="line">        catNames.push(checkedNodes[i].name);</span><br><span class="line">      &#125;</span><br><span class="line">      this.$confirm(`是否批量删除【$&#123;catNames&#125;】菜单？`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/glmproduct/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(catIds, false),</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单批量删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">            this.getMenus();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //提交修改信息</span><br><span class="line">    batchSave() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/update/sort&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.updateNodes, false),</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单顺序修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = this.pCid;</span><br><span class="line">      &#125;);</span><br><span class="line">      this.updateNodes = [];</span><br><span class="line">    &#125;,</span><br><span class="line">    allowDrop(draggingNode, dropNode, type) &#123;</span><br><span class="line">      console.log(&quot;allowDrag:&quot;, draggingNode, dropNode, type);</span><br><span class="line">      this.maxLevel = draggingNode.level;</span><br><span class="line">      //节点的最大深度</span><br><span class="line">      this.countNodeLevel(draggingNode);</span><br><span class="line">      console.log(&quot;当前节点的最大深度：&quot;, this.maxLevel);</span><br><span class="line">      //当前节点的深度</span><br><span class="line">      let deep = Math.abs(this.maxLevel - draggingNode.level) + 1;</span><br><span class="line">      console.log(&quot;当前节点的深度&quot;, deep);</span><br><span class="line">      if (type == &quot;inner&quot;) &#123;</span><br><span class="line">        return deep + dropNode.level &lt;= 3;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return deep + dropNode.parent.level &lt;= 3;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    //计算当前节点的最大深度</span><br><span class="line">    countNodeLevel(node) &#123;</span><br><span class="line">      //找到所有的子节点，求出最大深度</span><br><span class="line">      if (node.childNodes != null &amp;&amp; node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          if (node.childNodes[i].catLevel &gt; this.maxLevel) &#123;</span><br><span class="line">            this.maxLevel = node.childNodes[i].level;</span><br><span class="line">          &#125;</span><br><span class="line">          this.countNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleDrop(draggingNode, dropNode, dropType, ev) &#123;</span><br><span class="line">      console.log(&quot;handleDrop: &quot;, draggingNode, dropNode, dropType);</span><br><span class="line">      //1、当前节点最新父节点的id</span><br><span class="line">      let pCid = 0;</span><br><span class="line">      //拖拽后的兄弟节点，分两种情况，一种是拖拽到两侧，一种是拖拽到内部</span><br><span class="line">      let sibings = null;</span><br><span class="line">      if (dropType == &quot;before&quot; || dropType == &quot;after&quot;) &#123;</span><br><span class="line">        pCid =</span><br><span class="line">          dropNode.parent.data.catId == undefined</span><br><span class="line">            ? 0</span><br><span class="line">            : dropNode.parent.data.catId;</span><br><span class="line">        sibings = dropNode.parent.childNodes;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        pCid = dropNode.data.catId;</span><br><span class="line">        sibings = dropNode.childNodes;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      //2、当前拖拽节点的最新顺序</span><br><span class="line">      //遍历所有的兄弟节点，如果是拖拽节点，传入（catId，sort，parentCid，catLevel），如果是兄弟节点传入（catId，sort）</span><br><span class="line">      for (let i = 0; i &lt; sibings.length; i++) &#123;</span><br><span class="line">        //如果遍历的是当前正在拖拽的节点</span><br><span class="line">        if (sibings[i].data.catId == draggingNode.data.catId) &#123;</span><br><span class="line">          //需要额外修改当前节点的父id，层级，</span><br><span class="line">          let catLevel = draggingNode.level;</span><br><span class="line">          if (sibings[i].level != draggingNode.level) &#123;</span><br><span class="line">            //当前节点的层级发生变化</span><br><span class="line">            catLevel = sibings[i].level;</span><br><span class="line">            //修改他子节点的层级</span><br><span class="line">            this.updateChildNodeLevel(sibings[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: sibings[i].data.catId,</span><br><span class="line">            sort: i,</span><br><span class="line">            parentCid: pCid,</span><br><span class="line">            catLevel: catLevel,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.updateNodes.push(&#123; catId: sibings[i].data.catId, sort: i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      console.log(&quot;updateNodes&quot;, this.updateNodes);</span><br><span class="line">      this.pCid.push(pCid);</span><br><span class="line">      //拖拽之后重新置0</span><br><span class="line">      this.maxLevel = 0;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改拖拽节点的子节点的层级</span><br><span class="line">    updateChildNodeLevel(node) &#123;</span><br><span class="line">      if (node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          //遍历子节点，传入（catId，catLevel）</span><br><span class="line">          var cNode = node.childNodes[i].data;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: cNode.catId,</span><br><span class="line">            catLevel: node.childNodes[i].level,</span><br><span class="line">          &#125;);</span><br><span class="line">          //处理子节点的子节点</span><br><span class="line">          this.updateChildNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/list/tree&quot;),</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        // console.log(&quot;成功了获取到菜单数据....&quot;, data);</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //绑定对话框的确定按钮，根据dialogType判断调用哪个函数</span><br><span class="line">    submitData() &#123;</span><br><span class="line">      if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.dialogType == &quot;edit&quot;) &#123;</span><br><span class="line">        this.editCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    //绑定Edit按钮,设置dialogType、title，从后台读取数据，展示到对话框内</span><br><span class="line">    edit(data) &#123;</span><br><span class="line">      console.log(&quot;edit=&gt;&quot;, data);</span><br><span class="line">      this.dialogType = &quot;edit&quot;;</span><br><span class="line">      this.title = &quot;编辑菜单&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      //后台读取数据回显</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/glmproduct/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        console.log(&quot;编辑回显数据：&quot;, data);</span><br><span class="line">        this.categroy.catId = data.data.catId;</span><br><span class="line">        this.categroy.name = data.data.name;</span><br><span class="line">        this.categroy.inco = data.data.inco;</span><br><span class="line">        this.categroy.productUnit = data.data.productUnit;</span><br><span class="line">        this.categroy.parentCid = data.data.parentCid;</span><br><span class="line">        // this.categroy.catLevel = data.data.catLevel;</span><br><span class="line">        // this.categroy.sort = data.data.sort;</span><br><span class="line">        // this.categroy.showStatus = data.data.showStatus;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //绑定对话框的确定按钮，向后台发送更新请求，传过去想要修改的字段</span><br><span class="line">    editCategory() &#123;</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.categroy;</span><br><span class="line"></span><br><span class="line">      console.log(&quot;修改数据==&gt;&quot;, &#123; catId, name, icon, productUnit &#125;);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false),</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.categroy.parentCid];</span><br><span class="line">        console.log(&quot;parentCid&quot;, this.categroy.parentCid);</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //修改append方法，新增addCategory方法</span><br><span class="line">    //点击append后，计算category属性，,显示对话框</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.title = &quot;添加菜单&quot;;</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      //清空编辑之后的回显数据</span><br><span class="line">      this.categroy.parentCid = data.catId;</span><br><span class="line">      //这里获取的catLevel是字符串需要*1加1</span><br><span class="line">      this.categroy.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.categroy.name = &quot;&quot;;</span><br><span class="line">      this.categroy.icon = &quot;&quot;;</span><br><span class="line">      this.categroy.productUnit = &quot;&quot;;</span><br><span class="line">      this.categroy.sort = 0;</span><br><span class="line">      this.categroy.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //点击确定后，发送post请求</span><br><span class="line">    //成功后显示添加成功，展开刚才的菜单</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;新增分类数据&quot;, this.categroy);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/glmproduct/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.categroy, false),</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;添加成功&quot;,</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.categroy.parentCid];</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        this.categroy.name = &quot;&quot;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`此操作将永久删除【$&#123;data.name&#125;】, 是否继续?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/glmproduct/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false),</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;,</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单。删除后给它赋值父节点id，令树形控件刷新后展开</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  //监听属性 类似于data概念</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  //监控data中的数据变化</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  //生命周期 - 创建完成（可以访问当前this实例）</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">  //生命周期 - 挂载完成（可以访问DOM元素）</span><br><span class="line">  mounted() &#123;&#125;,</span><br><span class="line">  beforeCreate() &#123;&#125;, //生命周期 - 创建之前</span><br><span class="line">  beforeMount() &#123;&#125;, //生命周期 - 挂载之前</span><br><span class="line">  beforeUpdate() &#123;&#125;, //生命周期 - 更新之前</span><br><span class="line">  updated() &#123;&#125;, //生命周期 - 更新之后</span><br><span class="line">  beforeDestroy() &#123;&#125;, //生命周期 - 销毁之前</span><br><span class="line">  destroyed() &#123;&#125;, //生命周期 - 销毁完成</span><br><span class="line">  activated() &#123;&#125;, //如果页面有keep-alive缓存功能，这个函数会触发</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.custom-tree-node &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  padding-right: 8px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://adanpro.gitee.io/adanblog">ADAN</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/">https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://www.adan.com" target="_blank">ADAN</a> 许可协议。转载请注明来自 <a href="https://adanpro.gitee.io/adanblog" target="_blank">光明</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue-java-%E9%A1%B9%E7%9B%AE/">vue java 项目</a></div><div class="post_share"><div class="social-share" data-image="/img/5.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/" title="谷粒商城（五）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">谷粒商城（五）</div></div></a></div><div class="next-post pull-right"><a href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%B8%89%EF%BC%89/" title="谷粒商城（三）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">谷粒商城（三）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/king.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ADAN</div><div class="author-info__description">如有一味绝境，非历十方生死</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://weixin.com/" target="_blank" title="weixin"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://qq.com/" target="_blank" title="2028038953"><i class="iconfont icon-QQ"></i></a><a class="social-icon" href="mailto:2028038953@qq.com" target="_blank" title="2028038953@qq.com"><i class="iconfont icon-youxiang"></i></a><a class="social-icon" href="https://gitee.com/" target="_blank" title="gitee"><i class="iconfont icon-gitee"></i></a><a class="social-icon" href="https://bilibili.com/" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">商品服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">1、商品服务-三级分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">三级分类介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E8%AF%A2%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%EF%BC%8C%E9%80%92%E5%BD%92%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">1、查询三级分类，递归树形结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-0%E3%80%81%E5%9B%9E%E9%A1%BEstream%E6%B5%81"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.0、回顾stream流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%BC%E5%85%A5%E8%A1%A8pms-category%EF%BC%8C%E9%9C%80%E6%B1%82"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.1、数据库导入表pms_category，需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E4%BF%AE%E6%94%B9CategoryController%E7%9A%84list%E6%96%B9%E6%B3%95%EF%BC%8C%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E6%9F%A5%E6%89%80%E6%9C%89%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.3.</span> <span class="toc-text">1.2、修改CategoryController的list方法，树形结构查所有分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81CategoryEntity%E6%96%B0%E5%A2%9E%E5%AD%90%E5%88%86%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.4.</span> <span class="toc-text">1.3、CategoryEntity新增子分类属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4%E3%80%81%E7%BC%96%E5%86%99%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E6%9F%A5%E5%88%86%E7%B1%BB%E7%9A%84service%E6%96%B9%E6%B3%95listWithTree"><span class="toc-number">2.2.5.</span> <span class="toc-text">1.4、编写树形结构查分类的service方法listWithTree()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">2.2.6.</span> <span class="toc-text">1.5、启动测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BA%BA%E4%BA%BA%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2%E7%AE%A1%E7%90%86%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.</span> <span class="toc-text">2、人人后台页面管理三级分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.1.</span> <span class="toc-text">1、启动模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81renren-fast%E6%96%B0%E5%A2%9E%E5%95%86%E5%93%81%E7%9B%AE%E5%BD%95%E5%92%8C%E5%88%86%E7%B1%BB%E7%BB%B4%E6%8A%A4%E8%8F%9C%E5%8D%95"><span class="toc-number">2.3.2.</span> <span class="toc-text">2、renren-fast新增商品目录和分类维护菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%89%8D%E7%AB%AF%E5%B1%95%E7%A4%BA%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E6%A0%91%E5%BD%A2%E6%8E%A7%E4%BB%B6"><span class="toc-number">2.3.3.</span> <span class="toc-text">3、前端展示三级分类树形控件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%B7%E6%B1%82%E5%9F%BA%E6%9C%AC%E8%B7%AF%E5%BE%84%E8%AE%BE%E4%B8%BA%E7%BD%91%E5%85%B3%E8%B7%AF%E5%BE%84"><span class="toc-number">2.3.4.</span> <span class="toc-text">4、前端的请求基本路径设为网关路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81renren-fast%E6%B3%A8%E5%86%8C%E5%88%B0nacos%EF%BC%8C%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3"><span class="toc-number">2.3.5.</span> <span class="toc-text">5、renren-fast注册到nacos，前端路由网关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.4.</span> <span class="toc-text">3、解决跨域问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%B7%A8%E5%9F%9F%E5%92%8C%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5"><span class="toc-number">2.4.1.</span> <span class="toc-text">1、跨域和同源策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%B7%A8%E5%9F%9F%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.2.</span> <span class="toc-text">2、跨域的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%951%EF%BC%9A%E4%BD%BF%E7%94%A8nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%BA%E5%90%8C%E4%B8%80%E5%9F%9F"><span class="toc-number">2.4.3.</span> <span class="toc-text">3、解决办法1：使用nginx反向代理为同一域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%952%EF%BC%88%E9%87%87%E7%94%A8%EF%BC%89-%E9%85%8D%E7%BD%AE%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E5%85%81%E8%AE%B8%E8%B7%A8%E5%9F%9F"><span class="toc-number">2.4.4.</span> <span class="toc-text">4、解决方法2（采用）: 配置当前请求允许跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E7%94%A8%E6%96%B9%E6%B3%952%E6%96%B0%E5%BB%BA%E9%85%8D%E7%BD%AE%E7%B1%BB%EF%BC%8C%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.4.5.</span> <span class="toc-text">5、用方法2新建配置类，解决跨域问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%89%8D%E7%AB%AF%E6%A0%91%E5%BD%A2%E5%B1%95%E7%A4%BA%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.</span> <span class="toc-text">4、前端树形展示三级分类数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9C%A8%E7%BD%91%E5%85%B3%E4%B8%AD%E9%85%8D%E7%BD%AEproduct%E8%B7%AF%E7%94%B1"><span class="toc-number">2.5.1.</span> <span class="toc-text">1、在网关中配置product路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84%E9%87%8D%E5%86%99%EF%BC%9A"><span class="toc-number">2.5.2.</span> <span class="toc-text">关于请求路径重写：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8nacos%E6%8A%BD%E5%8F%96gateway%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.3.</span> <span class="toc-text">2、使用nacos抽取gateway模块配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E5%88%86%E7%B1%BB%E7%BB%84%E4%BB%B6%EF%BC%8Ccategory-vue"><span class="toc-number">2.5.4.</span> <span class="toc-text">3、修改前端分类组件，category.vue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%90%AF%E5%8A%A8product%E6%B5%8B%E8%AF%95"><span class="toc-number">2.5.5.</span> <span class="toc-text">4、启动product测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="toc-number">2.6.</span> <span class="toc-text">5、逻辑删除三级分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E4%BB%85%E6%97%A0%E5%AD%90%E5%88%86%E7%B1%BB%E5%8F%AF%E5%88%A0%E9%99%A4%EF%BC%8C%E4%BB%85%E4%B8%80%E4%BA%8C%E7%BA%A7%E5%88%86%E7%B1%BB%E5%8F%AF%E6%96%B0%E5%A2%9E"><span class="toc-number">2.6.1.</span> <span class="toc-text">1、前端，仅无子分类可删除，仅一二级分类可新增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E5%88%A0%E9%99%A4%E9%80%BB%E8%BE%91%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%8A%BD%E5%8F%96%E8%AF%B7%E6%B1%82%E5%88%B0%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-number">2.6.2.</span> <span class="toc-text">2、前端，删除逻辑实现，抽取请求到代码片段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%90%8E%E7%AB%AF%EF%BC%8C%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4-TableLogic"><span class="toc-number">2.6.3.</span> <span class="toc-text">3、后端，逻辑删除**@TableLogic**</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%96%B0%E5%A2%9E%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%EF%BC%88%E4%BB%85%E5%89%8D%E7%AB%AF%EF%BC%89"><span class="toc-number">2.7.</span> <span class="toc-text">6、新增三级分类（仅前端）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB%E5%86%85%E5%AE%B9"><span class="toc-number">2.8.</span> <span class="toc-text">7、修改分类内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%90%8E%E7%AB%AF%EF%BC%8C%E4%BF%AE%E6%94%B9%E2%80%9C%E5%9B%9E%E6%98%BE%E6%96%B9%E6%B3%95%E2%80%9D%E7%BB%93%E6%9E%9C%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%AE%E4%B8%BA%E2%80%9Ddata%E2%80%9D"><span class="toc-number">2.8.1.</span> <span class="toc-text">1、后端，修改“回显方法”结果对象的键为”data”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%92%8C%E6%96%B0%E5%A2%9E%E5%85%B1%E4%BA%AB%E8%A1%A8%E5%8D%95%E7%AA%97%E5%8F%A3el-dialog%E3%80%81%E8%A1%A8%E5%8D%95%E5%9B%9E%E6%98%BE"><span class="toc-number">2.8.2.</span> <span class="toc-text">2、前端，修改和新增共享表单窗口el-dialog、表单回显</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BB%EF%BC%8C%E6%8B%96%E6%8B%BD"><span class="toc-number">2.9.</span> <span class="toc-text">8、修改分类层级关系，拖拽</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD"><span class="toc-number">2.9.1.</span> <span class="toc-text">1、前端，拖拽功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E6%8B%96%E6%8B%BD%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86"><span class="toc-number">2.9.2.</span> <span class="toc-text">2、前端，拖拽后的数据收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E6%89%B9%E9%87%8F%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD"><span class="toc-number">2.9.3.</span> <span class="toc-text">3、前端，批量拖拽功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD%EF%BC%88%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%EF%BC%89"><span class="toc-number">2.9.4.</span> <span class="toc-text">4、后端实现拖拽功能（批量修改）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB%EF%BC%88%E4%BB%85%E5%89%8D%E7%AB%AF%EF%BC%89"><span class="toc-number">2.10.</span> <span class="toc-text">9、批量删除分类（仅前端）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%89%8D%E7%AB%AF%E5%88%86%E7%B1%BB%E7%BB%84%E4%BB%B6category-vue%E6%9C%80%E7%BB%88%E4%BB%A3%E7%A0%81"><span class="toc-number">2.11.</span> <span class="toc-text">10、前端分类组件category.vue最终代码</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/" title="谷粒商城（五）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（五）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/" title="谷粒商城（五）">谷粒商城（五）</a><time datetime="2024-01-02T08:44:10.323Z" title="发表于 2024-01-02 16:44:10">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/" title="商品服务（四）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="商品服务（四）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/" title="商品服务（四）">商品服务（四）</a><time datetime="2024-01-02T08:42:41.356Z" title="发表于 2024-01-02 16:42:41">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%B8%89%EF%BC%89/" title="谷粒商城（三）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（三）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%B8%89%EF%BC%89/" title="谷粒商城（三）">谷粒商城（三）</a><time datetime="2024-01-02T08:41:46.521Z" title="发表于 2024-01-02 16:41:46">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%8C%EF%BC%89/" title="谷粒商城（二）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（二）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%8C%EF%BC%89/" title="谷粒商城（二）">谷粒商城（二）</a><time datetime="2024-01-02T08:40:37.031Z" title="发表于 2024-01-02 16:40:37">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" title="谷粒商城（一）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/10.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（一）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" title="谷粒商城（一）">谷粒商城（一）</a><time datetime="2024-01-02T08:39:21.869Z" title="发表于 2024-01-02 16:39:21">2024-01-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ADAN</div><div class="footer_custom_text">听天，不会由命</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>