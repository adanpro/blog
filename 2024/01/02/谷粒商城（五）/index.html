<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>谷粒商城（五） | 光明</title><meta name="author" content="ADAN"><meta name="copyright" content="ADAN"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="商品服务-品牌管理">
<meta property="og:type" content="article">
<meta property="og:title" content="谷粒商城（五）">
<meta property="og:url" content="https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/index.html">
<meta property="og:site_name" content="光明">
<meta property="og:description" content="商品服务-品牌管理">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://adanpro.gitee.io/adanblog/img/2.jpg">
<meta property="article:published_time" content="2024-01-02T08:44:10.323Z">
<meta property="article:modified_time" content="2024-01-02T08:44:30.886Z">
<meta property="article:author" content="ADAN">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://adanpro.gitee.io/adanblog/img/2.jpg"><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '谷粒商城（五）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-02 16:44:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/js/custom.js"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/king.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于</span></a></li><li><a class="site-page child" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="光明"><span class="site-name">光明</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于</span></a></li><li><a class="site-page child" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">谷粒商城（五）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-02T08:44:10.323Z" title="发表于 2024-01-02 16:44:10">2024-01-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-02T08:44:30.886Z" title="更新于 2024-01-02 16:44:30">2024-01-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/">谷粒商城（五）</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="谷粒商城（五）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="商品服务-品牌管理"><a href="#商品服务-品牌管理" class="headerlink" title="商品服务-品牌管理"></a>商品服务-品牌管理</h1><h2 id="1、添加“品牌管理”到人人后台管理系统"><a href="#1、添加“品牌管理”到人人后台管理系统" class="headerlink" title="1、添加“品牌管理”到人人后台管理系统"></a>1、添加“品牌管理”到人人<strong>后台管理系统</strong></h2><h3 id="1、在人人后台管理系统中新增“品牌管理”菜单"><a href="#1、在人人后台管理系统中新增“品牌管理”菜单" class="headerlink" title="1、在人人后台管理系统中新增“品牌管理”菜单"></a><strong>1、在人人后台管理系统中新增“品牌管理”菜单</strong></h3><p>菜单管理-&gt;新增菜单</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510115840409-1683691210758-1.png" alt="image-20230510115840409"></p>
<h3 id="2、人人生成的前端vue文件复制到前端工程"><a href="#2、人人生成的前端vue文件复制到前端工程" class="headerlink" title="2、人人生成的前端vue文件复制到前端工程"></a><strong>2、人人生成的前端vue文件复制到前端工程</strong></h3><p>前端代码路径<code>\product\main\resources\src\views\modules\product</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510120303909.png" alt="image-20230510120303909"></p>
<h3 id="3、修改权限"><a href="#3、修改权限" class="headerlink" title="3、修改权限"></a><strong>3、修改权限</strong></h3><p>没有新增删除按钮： 修改权限，Ctrl+Shift+F查找<code>isAuth后，</code></p>
<p>在src&#x2F;utils&#x2F;index.js修改<code>isAuth</code>，注释并全部返回为true</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510161211521.png" alt="image-20230510161211521"></p>
<h3 id="4、测试增删改查基础功能"><a href="#4、测试增删改查基础功能" class="headerlink" title="4、测试增删改查基础功能"></a><strong>4、测试增删改查基础功能</strong></h3><p>运行项目， 可以发现增删改查都是成功的. </p>
<blockquote>
<p><strong>注意：</strong>现在没有添加表单校验，新增时表单有非法输入会失败，例如状态设为汉字。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510163657547.png" alt="image-20230510163657547"></p>
<h2 id="2、新增时显示状态开关（仅前端）"><a href="#2、新增时显示状态开关（仅前端）" class="headerlink" title="2、新增时显示状态开关（仅前端）"></a>2、新增时显示状态开关（仅前端）</h2><p>1、在列表中添加自定义列：中间加<code>&lt;template&gt;&lt;/template&gt;</code>标签。可以通过 <code>Scoped slot</code> 可以获取到 row, column, $index 和 store（table 内部的状态管理）的数据</p>
<p>2、修改开关状态，发送修改请求</p>
<p>3、数据库中showStatus是01，开关默认值是true&#x2F;false。 所以在开关中设置<code>:active-value=&quot;1&quot; 、:inactive-value=&quot;0&quot;</code>属性，与数据库同步</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--brand.vue中显示状态那一列--&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;showStatus&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;显示状态&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-switch</span><br><span class="line">            v-model=&quot;scope.row.showStatus&quot;</span><br><span class="line">            active-color=&quot;#13ce66&quot;</span><br><span class="line">            inactive-color=&quot;#ff4949&quot;</span><br><span class="line">            :active-value=&quot;1&quot; </span><br><span class="line">            :inactive-value=&quot;0&quot;</span><br><span class="line">            @change=&quot;updateBrandStatus(scope.row)&quot; </span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-switch&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--brand-add-or-update.vue中显示状态那一列--&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;显示状态&quot; prop=&quot;showStatus&quot;&gt;</span><br><span class="line">        &lt;el-switch</span><br><span class="line">          v-model=&quot;dataForm.showStatus&quot;</span><br><span class="line">          active-color=&quot;#13ce66&quot;</span><br><span class="line">          inactive-color=&quot;#ff4949&quot;</span><br><span class="line">          :active-value=&quot;1&quot;</span><br><span class="line">          :inactive-value=&quot;0&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/el-switch&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//brand.vue中新增方法，用来修改状态</span></span><br><span class="line"><span class="title function_">updateBrandStatus</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123; brandId, showStatus &#125; = data;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/brand/update&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(&#123; brandId, showStatus &#125;, <span class="literal">false</span>),</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;状态修改成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="3、文件上传功能，阿里云云存储"><a href="#3、文件上传功能，阿里云云存储" class="headerlink" title="3、文件上传功能，阿里云云存储"></a>3、文件上传功能，阿里云云存储</h2><h3 id="1、分布式系统上传文件"><a href="#1、分布式系统上传文件" class="headerlink" title="1、分布式系统上传文件"></a>1、分布式系统上传文件</h3><p><strong>单体应用上传：</strong>上传文件到服务器，想获取文件时再向服务器发请求获取文件。</p>
<p><strong>分布式系统上传：</strong> 因为有多台服务器，为防止负载均衡导致获取文件时没找到对应的服务器，所以<strong>使用专门的存读文件服务器，或者云存储</strong>。</p>
<p>和传统的单体应用不同，这里我们选择<strong>将数据上传到分布式文件服务器上</strong>。</p>
<p>这里我们选择<strong>将图片放置到阿里云上，使用对象存储</strong>。</p>
<p><strong>帮助文档：</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/aliyun-spring-boot/blob/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample/README-zh.md">https://github.com/alibaba/aliyun-spring-boot/blob/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample/README-zh.md</a></li>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ">https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ</a></li>
</ul>
<p><strong>上传策略：服务端签名后直传</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510174549847.png" alt="image-20230510174549847"></p>
<h3 id="2、开通阿里云OSS对象存储服务，创建新的Bucket"><a href="#2、开通阿里云OSS对象存储服务，创建新的Bucket" class="headerlink" title="2、开通阿里云OSS对象存储服务，创建新的Bucket"></a>2、开通阿里云OSS对象存储服务，创建新的Bucket</h3><p><strong>尽管开通即可，oss是按量计费，开发阶段不会超过一块钱。</strong> </p>
<p>注册、登录、实名认证、开通oss对象存储:</p>
<p><a target="_blank" rel="noopener" href="https://www.aliyun.com/product/oss?spm=5176.21213303.5694434980.1.15cb53c97UXx4S&scm=20140722.S_card@@%E4%BA%A7%E5%93%81@@218843.S_card0.ID_card@@%E4%BA%A7%E5%93%81@@218843-RL_OSS-OR_ser-V_2-P0_0">对象存储OSS_云存储服务_企业数据管理_存储-阿里云</a></p>
<p>点击立即开通 </p>
<p>点击“管理控制台” ：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510174847632.png" alt="image-20230510174847632"></p>
<p>oss基本概念：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31827.htm?spm=a2c4g.11186623.0.0.13f52fcbtzlZmX#concept-izx-fmt-tdb">基本概念-Object-对象-存储-对象存储 OSS-阿里云</a></p>
<p><strong>存储空间（Bucket）</strong></p>
<p>存储空间是用户用于存储对象（Object）的容器，所有的对象都必须隶属于某个存储空间。存储空间具有各种配置属性，包括地域、访问权限、存储类型等。用户可以根据实际需求，创建不同类型的存储空间来存储不同的数据。</p>
<p>建议一个项目创建一个存储空间。 </p>
<p><strong>对象（Object）</strong></p>
<p>对象是OSS存储数据的基本单元，也被称为OSS的文件。和传统的文件系统不同，对象没有文件目录层级结构的关系。对象由元信息（Object Meta），用户数据（Data）和文件名（Key）组成，并且由存储空间内部唯一的Key来标识。对象元信息是一组键值对，表示了对象的一些属性，比如最后修改时间、大小等信息，同时用户也可以在元信息中存储一些自定义的信息。<br><strong>创建bucket：</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175037124.png" alt="image-20230510175037124"></p>
<p><strong>手动上传任意文件测试：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175133695.png" alt="image-20230510175133695"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175237066.png" alt="image-20230510175237066"></p>
<h3 id="3、子账户创建和授权"><a href="#3、子账户创建和授权" class="headerlink" title="3、子账户创建和授权"></a>3、子账户创建和授权</h3><p><strong>创建子账户</strong>，获取<code>Endpoint</code>、<code>AccessKey ID</code>、<code>AccessKey Secret</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175408378.png" alt="image-20230510175408378"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175440871.png" alt="image-20230510175440871"></p>
<p>点击创建用户</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175628817.png" alt="image-20230510175628817"></p>
<p><strong>新建成功后得到<code>AccessKey ID</code>、<code>AccessKey Secret</code></strong></p>
<p>对<strong>子账户分配权限</strong>，管理OSS对象存储服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175711885.png" alt="image-20230510175711885"></p>
<p>Endpoint。 （gulimall-xmh -&gt; 概览 -&gt; Endpoint（地域节点）)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510175946209.png" alt="image-20230510175946209"></p>
<h3 id="4、测试普通上传方式（不建议）"><a href="#4、测试普通上传方式（不建议）" class="headerlink" title="4、测试普通上传方式（不建议）"></a>4、测试普通上传方式（不建议）</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/994db1d6a81148f080a6dcb00af7b169.png" alt="img"></p>
<p>经过服务器不建议 </p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32009.html">安装-gt-lt-Java-对象存储 OSS-阿里云</a></p>
<h3 id="product模块导入依赖"><a href="#product模块导入依赖" class="headerlink" title="product模块导入依赖"></a>product模块导入依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.15.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果使用的是Java 9及以上的版本，则需要添加jaxb相关依赖。添加jaxb相关依赖示例代码如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alicloud-oss --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.adan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>glm-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>上传文件流</strong>，将下面代码中String都<code>改成自己的信息：</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOss</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">&quot;https://oss-cn-hangzhou.aliyuncs.com&quot;</span>;</span><br><span class="line">    <span class="comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">&quot;yourAccessKeyId&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">&quot;yourAccessKeySecret&quot;</span>;</span><br><span class="line">    <span class="comment">// 填写Bucket存储空间名称，例如gulimall-hello。</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;examplebucket&quot;</span>;</span><br><span class="line">    <span class="comment">// 填写存储对象Object完整路径，完整路径中不能包含Bucket名称，例如exampledir/exampleobject.txt。</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> <span class="string">&quot;exampledir/exampleobject.txt&quot;</span>;</span><br><span class="line">    <span class="comment">// 填写本地文件的完整路径，例如D:\\localpath\\examplefile.txt。</span></span><br><span class="line">    <span class="comment">// 如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。</span></span><br><span class="line">    String filePath= <span class="string">&quot;D:\\localpath\\examplefile.txt&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">    <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">        <span class="comment">// 创建PutObject请求。</span></span><br><span class="line">        ossClient.putObject(bucketName, objectName, inputStream);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (OSSException oe) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span></span><br><span class="line">                + <span class="string">&quot;but was rejected with an error response for some reason.&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Error Message:&quot;</span> + oe.getErrorMessage());</span><br><span class="line">        System.out.println(<span class="string">&quot;Error Code:&quot;</span> + oe.getErrorCode());</span><br><span class="line">        System.out.println(<span class="string">&quot;Request ID:&quot;</span> + oe.getRequestId());</span><br><span class="line">        System.out.println(<span class="string">&quot;Host ID:&quot;</span> + oe.getHostId());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClientException ce) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Caught an ClientException, which means the client encountered &quot;</span></span><br><span class="line">                + <span class="string">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span></span><br><span class="line">                + <span class="string">&quot;such as not being able to access the network.&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Error Message:&quot;</span> + ce.getMessage());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行，上传成功：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510182102187.png" alt="image-20230510182102187"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510182126757.png" alt="image-20230510182126757"></p>
<p>复制文件url在浏览器也是可以打开的。 </p>
<h3 id="5、建立第三方服务模块，实现服务端签名后直传"><a href="#5、建立第三方服务模块，实现服务端签名后直传" class="headerlink" title="5、建立第三方服务模块，实现服务端签名后直传"></a>5、建立第三方服务模块，实现服务端签名后直传</h3><p><strong>删除前面测试时引入的依赖和测试类，以后导入starter依赖。</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510182231428.png" alt="image-20230510182231428"></p>
<p>官方演示示例 ：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/aliyun-spring-boot/tree/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample">aliyun-spring-boot&#x2F;aliyun-spring-boot-samples&#x2F;aliyun-oss-spring-boot-sample at master · alibaba&#x2F;aliyun-spring-boot · GitHub</a></p>
<ul>
<li>新建springboot模块,<code>gulimall-third-party</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510182449440.png" alt="image-20230510182449440"></p>
<ul>
<li>第三方模块继承父工程、引入common依赖、oss依赖和alibaba管理依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.adan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>glm-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>glm-third-party<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>glm-third-party<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>glm-third-party<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alicloud-oss --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.adan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>glm-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>nacos新建命名空间<code>third-party</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510183232240.png" alt="image-20230510183232240"></p>
<ul>
<li>命名空间中新建配置文件<code>oss-server-dev.yaml</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510183523537.png" alt="image-20230510183523537"></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">alicloud</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">oss</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">endpoint</span>: <span class="string">xxx</span></span><br><span class="line">        <span class="attr">bucket</span>: <span class="string">xxx</span></span><br><span class="line">      <span class="attr">access-key</span>: <span class="string">xxx</span></span><br><span class="line">      <span class="attr">secret-key</span>: <span class="string">xxx</span></span><br></pre></td></tr></table></figure>

<ul>
<li>项目新建**<code>bootstrap.yml</code>**</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">glm-third-party</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">7037a071-581e-4c47-9319-9daccf89571d</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">918a840e-8322-43a4-9bff-36e3a5658498</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">refresh-enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">extension-configs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">data-id:</span> <span class="string">oss-server-$&#123;spring.profiles.active&#125;.yaml</span></span><br><span class="line">            <span class="attr">group:</span> <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">            <span class="attr">refresh:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510184205831.png" alt="image-20230510184205831"></p>
<p><strong>坑点：报错没有配置endpoint：</strong></p>
<p>在<code>SpringBoot 2.4.x</code>的版本之后，对于**<code>bootstrap.properties</code>&#x2F;<code>bootstrap.yaml</code>**配置文件(我们合起来成为<code>Bootstrap</code>配置文件)的支持，需要导入如下的依赖</p>
<p>这里在common中导入：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>项目新建**<code>application.yml</code>**（配置bootstrap.yml可以相同配置省略不写，端口必须写）</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-third-party</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">30000</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>主启动类注解@EnableDiscoveryClient开启nacos注册</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlmThirdPartyApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GlmThirdPartyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、测试上传文件功能"><a href="#6、测试上传文件功能" class="headerlink" title="6、测试上传文件功能"></a>6、测试上传文件功能</h3><p>在第三方模块的pom里排除mybatisplus依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.adan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>glm-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>编写测试类：</strong></p>
<p>注意修改bucket </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GulimallThirdPartyApplicationTest</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OSSClient ossClient;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//上传文件流。</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;E:\\SystemDefault\\桌面\\1.jpg&quot;</span>);</span><br><span class="line">        ossClient.putObject(<span class="string">&quot;改成自己bucketName例如gulimall-xmh&quot;</span>, <span class="string">&quot;hahaha1.jpg&quot;</span>, inputStream);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">&quot;上传成功.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510190226322.png" alt="image-20230510190226322"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510190144013.png" alt="image-20230510190144013"></p>
<h3 id="7、实现服务端签名后直传文件，新建OssController"><a href="#7、实现服务端签名后直传文件，新建OssController" class="headerlink" title="7、实现服务端签名后直传文件，新建OssController"></a>7、实现服务端签名后直传文件，新建OssController</h3><p>在第三方模块controller.OssController </p>
<p><strong>代码来源：</strong><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/84781.html">简单上传-上传-文件-OSS-对象存储 OSS-阿里云</a> </p>
<p>这里主要是从yml里注入oss需要的关键属性，删去了跨域相关的代码，因为跨域我们之前在网关模块的配置类里已经统一配置了跨域规则。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSS ossClient;  <span class="comment">//注意不是OssClient</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//从nacos配置的yml里注入阿里云云存储的关键属性</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.oss.endpoint&#125;&quot;)</span></span><br><span class="line">    String endpoint;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.oss.bucket&#125;&quot;)</span></span><br><span class="line">    String bucket;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.access-key&#125;&quot;)</span></span><br><span class="line">    String accessId;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.secret-key&#125;&quot;)</span></span><br><span class="line">    String accessKey;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oss/policy&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">policy</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;https://&quot;</span> + bucket + <span class="string">&quot;.&quot;</span> + endpoint; <span class="comment">// host的格式为 bucketname.endpoint</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 用户上传文件时指定的前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"> </span><br><span class="line">        Map&lt;String, String&gt; respMap=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">expireEndTime</span> <span class="operator">=</span> System.currentTimeMillis() + expireTime * <span class="number">1000</span>;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">expiration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(expireEndTime);</span><br><span class="line">            <span class="type">PolicyConditions</span> <span class="variable">policyConds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PolicyConditions</span>();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, <span class="number">0</span>, <span class="number">1048576000</span>);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line"> </span><br><span class="line">            <span class="type">String</span> <span class="variable">postPolicy</span> <span class="operator">=</span> ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            <span class="type">byte</span>[] binaryData = postPolicy.getBytes(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">encodedPolicy</span> <span class="operator">=</span> BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            <span class="type">String</span> <span class="variable">postSignature</span> <span class="operator">=</span> ossClient.calculatePostSignature(postPolicy);</span><br><span class="line"> </span><br><span class="line">            respMap= <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class="line">            respMap.put(<span class="string">&quot;accessid&quot;</span>, accessId);</span><br><span class="line">            respMap.put(<span class="string">&quot;policy&quot;</span>, encodedPolicy);</span><br><span class="line">            respMap.put(<span class="string">&quot;signature&quot;</span>, postSignature);</span><br><span class="line">            respMap.put(<span class="string">&quot;dir&quot;</span>, dir);</span><br><span class="line">            respMap.put(<span class="string">&quot;host&quot;</span>, host);</span><br><span class="line">            respMap.put(<span class="string">&quot;expire&quot;</span>, String.valueOf(expireEndTime / <span class="number">1000</span>));</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Assert.fail(e.getMessage());</span></span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,respMap);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>文件真正访问地址：</strong><a target="_blank" rel="noopener" href="https://bucket名.endpoint名/%E6%96%87%E4%BB%B6%E5%90%8D">https://bucket名.endpoint名/文件名</a></p>
<p>例如：<a target="_blank" rel="noopener" href="https://glm-file.oss-cn-guangzhou.aliyuncs.com/7.jpg">https://glm-file.oss-cn-guangzhou.aliyuncs.com/7.jpg</a></p>
<p>启动访问获取签名：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:30000/oss/policy">http://localhost:30000/oss/policy</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510224606362.png" alt="image-20230510224606362"></p>
<h3 id="8、配置网关路由"><a href="#8、配置网关路由" class="headerlink" title="8、配置网关路由"></a>8、配置网关路由</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">third_party_route</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">lb://glm-third-party</span></span><br><span class="line">      <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/api/thirdparty/**</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">      <span class="comment">#  http://localhost:88/api/thirdparty/oss/policy---&gt;http://localhost:30000/oss/policy</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RewritePath=/api/thirdparty/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：位置要放到&#x2F;api的上面</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510225552043.png" alt="image-20230510225552043"></p>
<h3 id="9、启动网关、测试获取oss签名请求"><a href="#9、启动网关、测试获取oss签名请求" class="headerlink" title="9、启动网关、测试获取oss签名请求"></a>9、启动网关、测试获取oss签名请求</h3><p>访问<a target="_blank" rel="noopener" href="http://localhost:88/api/thirdparty/oss/policy%E6%B5%8B%E8%AF%95">http://localhost:88/api/thirdparty/oss/policy测试</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510225632408.png" alt="image-20230510225632408"></p>
<h3 id="10、前端联调，实现文件上传功能"><a href="#10、前端联调，实现文件上传功能" class="headerlink" title="10、前端联调，实现文件上传功能"></a>10、前端联调，实现文件上传功能</h3><ul>
<li>将资料里的upload文件夹复制粘贴在&#x2F;renren-fast-vue&#x2F;src&#x2F;components中</li>
<li>修改<strong>multiUpload.vue</strong>和<strong>singeUplad.vue</strong>组件中**<code>el-upload</code>中的<code>action</code>属性<strong>，替换成自己的</strong>Bucket域名**</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510230501792.png" alt="image-20230510230501792"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510230530476.png" alt="image-20230510230530476"></p>
<ul>
<li><code>修改\src\views\modules\product\brand-add-or-update.vue，</code>把单个文件上传组件应用到<code>brand-add-or-update.vue</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在&lt;script&gt;标签中导入组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SingleUpload</span> <span class="keyword">from</span> <span class="string">&quot;../../../components/upload/singleUpload.vue&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//在export default中声明要用到的组件</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">SingleUpload</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">   &lt;!--用新的组件替换原来的输入框--&gt;</span><br><span class="line">&lt;el-form-item label=&quot;品牌logo地址&quot; prop=&quot;logo&quot;&gt;</span><br><span class="line">     &lt;single-upload v-model=&quot;dataForm.logo&quot;&gt;&lt;/single-upload&gt;</span><br><span class="line">   &lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<h3 id="11、在阿里云配置跨域规则"><a href="#11、在阿里云配置跨域规则" class="headerlink" title="11、在阿里云配置跨域规则"></a>11、在阿里云配置跨域规则</h3><p>因为是直接从前端8001端口转到阿里云的<strong>bucket域名</strong>，所以会有<strong>跨域问题：</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510233057977.png" alt="image-20230510233057977"></p>
<p><strong>跨域都是目标地址需要配置规则，所以在阿里云网页配置规则。</strong></p>
<p>进入oss：<a target="_blank" rel="noopener" href="https://oss.console.aliyun.com/bucket/oss-cn-beijing/gulimall-vincewm/overview">阿里云登录 - 欢迎登录阿里云，安全稳定的云计算服务平台</a> </p>
<p>点击概述，下拉基础设置，配置跨域访问：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510233138737.png" alt="image-20230510233138737"></p>
<p>创建新规则</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510233227051.png" alt="image-20230510233227051"></p>
<h3 id="12、启动测试"><a href="#12、启动测试" class="headerlink" title="12、启动测试"></a>12、启动测试</h3><p>启动人人后台管理模块、网关、product、第三方模块 </p>
<p><a target="_blank" rel="noopener" href="http://localhost:8001/#/product-brand">http://localhost:8001/#/product-brand</a></p>
<p>点击添加品牌-图片上传，进行测试。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510234453723.png" alt="image-20230510234453723"></p>
<p>测试成功！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510234551100.png" alt="image-20230510234551100"></p>
<h2 id="4、效果优化-显示图片（仅前端）"><a href="#4、效果优化-显示图片（仅前端）" class="headerlink" title="4、效果优化-显示图片（仅前端）"></a>4、效果优化-显示图片（仅前端）</h2><p>原效果：</p>
<p>新增品牌后，发现在品牌logo下面显示的是地址。应该显示图片。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230510234631875.png" alt="image-20230510234631875"></p>
<p><strong>需要组件：</strong>elementUI里的table-自定义模板（自定义显示某一列，用于获取url）和others-Image。</p>
<p>在品牌logo下添加图片标签</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">       &lt;img</span><br><span class="line">         :src=&quot;scope.row.logo&quot;</span><br><span class="line">         style=&quot;width: 100%; height: 100%; object-fit: scale-down&quot;</span><br><span class="line">       /&gt;</span><br><span class="line">     &lt;/template&gt;</span><br></pre></td></tr></table></figure>



<h2 id="如何让img里的图片自适应div，且不变形"><a href="#如何让img里的图片自适应div，且不变形" class="headerlink" title="如何让img里的图片自适应div，且不变形"></a>如何让img里的图片自适应div，且不变形</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>解决方案：使用<code>object-fit</code>属性</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>object-fit</code>中的几个属性值：</p>
<table>
<thead>
<tr>
<th>值</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>fill</td>
<td>不保持纵横比缩放图片，使图片完全适应</td>
</tr>
<tr>
<td>contain</td>
<td>保持纵横比缩放图片，使图片的长边能完全显示出来</td>
</tr>
<tr>
<td>none</td>
<td>保持图片宽高不变</td>
</tr>
<tr>
<td>scale-down</td>
<td>当图片实际宽高小于所设置的图片宽高时，显示效果与none一致；否则，显示效果与contain一致</td>
</tr>
</tbody></table>
<h2 id="5、前端表单校验"><a href="#5、前端表单校验" class="headerlink" title="5、前端表单校验"></a>5、前端表单校验</h2><ul>
<li>首字母只能为a-z或者A-Z的一个字母</li>
<li>排序必须是大于等于0的一个整数</li>
</ul>
<p>el-form中<code>rules</code>表示校验规则</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--排序加上.number表示要接受一个数字        --&gt;</span><br><span class="line">&lt;el-input v-model.number=&quot;dataForm.sort&quot; placeholder=&quot;排序&quot;&gt;&lt;/el-input&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6、JSR303数字校验"><a href="#6、JSR303数字校验" class="headerlink" title="6、JSR303数字校验"></a>6、JSR303数字校验</h2><p><strong>JSR303： Java数据校验规范提案。</strong></p>
<p><em>jsr</em>，是Java Specification Requests的缩写，意思是Java规范提案，是指向JCP(Java Community Process)提出新增一个标准化技术规范的正式请求。</p>
<p>303号规定了数据校验的标准。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">`@NotNull:` CharSequence, Collection, Map 和 Array 对象不能是 null, 但可以是空集（size = 0）。  </span><br><span class="line"></span><br><span class="line">`@NotEmpty:` CharSequence, Collection, Map 和 Array 对象不能是 null 并且相关对象的 size 大于 0。  </span><br><span class="line"></span><br><span class="line">`@NotBlank:`  String 不是 null 且去除两端空白字符后的长度（trimmed length）大于 0。</span><br></pre></td></tr></table></figure>

<p><strong>@NotEmpty和@NotBlank区别：</strong></p>
<p>@NotEmpty非空，不能是null和””</p>
<p>@NotBlank 非空白，不能是null和””和” “</p>
<p>@NotEmpty 用在集合类上面<br>@NotBlank 用在String上面<br>@NotNull 用在基本类型上</p>
<h3 id="1、基本校验实现，-Valid"><a href="#1、基本校验实现，-Valid" class="headerlink" title="1、基本校验实现，@Valid"></a>1、<strong>基本校验实现，@Valid</strong></h3><ul>
<li>springboot2.3.0以上需要手动<strong>引入依赖</strong>,引入到common模块中</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-validation --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>给实体类添加校验注解，并自定义提示message</strong></li>
</ul>
<p>product模块 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@TableId</span></span><br><span class="line"><span class="comment">//	@NotNull(message = &quot;修改必须有id&quot;,groups = &#123;UpdateGroup.class&#125;)	//分组校验</span></span><br><span class="line"><span class="comment">//	@Null(message = &quot;新增id必须为null&quot;,groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Long brandId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank(message = &quot;品牌名必须提交&quot;)</span>    <span class="comment">//不能是null和&quot;&quot;和&quot;  &quot;</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌logo地址。非空并且是url</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotEmpty</span>    <span class="comment">//不能是null和&quot;&quot;</span></span><br><span class="line">	<span class="meta">@URL(message = &quot;logo必须是一个合法的url地址&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String logo;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 介绍</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String descript;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer showStatus;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检索首字母</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotEmpty</span></span><br><span class="line">	<span class="meta">@Pattern(regexp = &quot;/^[a-zA-Z]$/&quot;, message = &quot;检索首字母必须是一个字母&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String firstLetter;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 排序</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="meta">@Min(value = 0, message = &quot;排序必须大于等于0&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer sort;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在<strong>需要校验的controller参数添加<code>@Valid</code>注解</strong>，并返回提示信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 保存</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> BrandEntity brand)</span>&#123;</span><br><span class="line">brandService.save(brand);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>规范校验错误时返回结果，BindingResult 参数</strong></li>
</ul>
<p><strong>了解即可</strong>，后面用异常类抛出异常，返回R.error()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;product:brand:save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand, BindingResult result)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (result.hasErrors())&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//1、获取校验的结果</span></span><br><span class="line">        result.getFieldErrors().forEach((item)-&gt;&#123;</span><br><span class="line">            <span class="comment">//获取到错误提示</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">            <span class="comment">//获取到错误属性的名字</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">            map.put(field, message);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> R.error().put(<span class="string">&quot;data&quot;</span>, map);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        brandService.save(brand);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>启动product和网关，测试：</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST http://localhost:88/api/product/brand/save</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"> </span><br><span class="line">&#123;&quot;name&quot;: &quot;aa&quot;, &quot;logo&quot;: &quot;avc&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511220203495.png" alt="image-20230511220203495"></p>
<h3 id="2、统一封装错误状态码"><a href="#2、统一封装错误状态码" class="headerlink" title="2、统一封装错误状态码"></a><strong>2、统一封装错误状态码</strong></h3><ul>
<li>正规开发过程中，错误状态码有着严格的定义规则</li>
</ul>
<p><strong>错误码和错误信息定义类：</strong></p>
<ol>
<li>错误码定义规则为<strong>五位数字</strong></li>
<li><strong>前两位表示业务场景，最后三位表示错误码。</strong>例如：100001。10:通用 001:系统未知异常</li>
<li>维护错误码后需要维护错误描述，将他们定义为<strong>枚举形式</strong></li>
</ol>
<p><strong>错误码列表（前两位业务场景）：</strong><br> 10: 通用<br>   如10001：参数格式校验失败<br> 11: 商品<br> 12: 订单<br> 13: 购物车<br> 14: 物流</p>
<p>为了定义这些错误状态码，我们可以单独定义一个常量类，用来存储这些错误状态码。</p>
<p><strong>在common模块的exception包中新建<code>BizCodeEnum枚举</code>用来存储状态码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.adan.common.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: adan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-05-11 22:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//错误码和错误信息定义类：</span></span><br><span class="line"><span class="comment">//        1. 错误码定义规则为五位数字</span></span><br><span class="line"><span class="comment">//        2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用 001:系统未知异常</span></span><br><span class="line"><span class="comment">//        3. 维护错误码后需要维护错误描述，将他们定义为枚举形式</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        错误码列表（前两位业务场景）：</span></span><br><span class="line"><span class="comment">//         10: 通用</span></span><br><span class="line"><span class="comment">//             如10001：参数格式校验失败</span></span><br><span class="line"><span class="comment">//         11: 商品</span></span><br><span class="line"><span class="comment">//         12: 订单</span></span><br><span class="line"><span class="comment">//         13: 购物车</span></span><br><span class="line"><span class="comment">//         14: 物流</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">BizCodeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    UNKNOWN_EXCEPTION(<span class="number">10000</span>,<span class="string">&quot;系统未知异常&quot;</span>),</span><br><span class="line"></span><br><span class="line">    VALID_EXCEPTION(<span class="number">10001</span>,<span class="string">&quot;参数格式校验失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    BizCodeEnum(<span class="type">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3、商品模块统一封装异常处理类，品牌参数校验异常"><a href="#3、商品模块统一封装异常处理类，品牌参数校验异常" class="headerlink" title="3、商品模块统一封装异常处理类，品牌参数校验异常"></a>3、商品模块统一封装异常处理类，品牌参数校验异常</h3><ul>
<li>在<strong>product</strong>模块exception包下新建类**<code>GulimallExceptionControllerAdvice</code><strong>，用来</strong>集中处理此模块所有异常**</li>
</ul>
<p><strong>为什么不放进common模块？</strong></p>
<p>因为<strong>品牌参数校验异常具有个性化</strong>，例如状态字段只能是1和0，所以只处理product模块异常，而不是放进common模块检测全局异常。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.adan.glmproduct.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlmExceptionAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理数据校验异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleValidException</span><span class="params">(MethodArgumentNotValidException e)</span>&#123;</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        bindingResult.getFieldErrors().forEach(item -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">            <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">            map.put(field, message);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.VALID_EXCEPTION.getCode(), BizCodeEnum.VALID_EXCEPTION.getMsg())</span><br><span class="line">                .put(<span class="string">&quot;data&quot;</span>, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理全局异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleException</span><span class="params">(Throwable e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.UNKNOWN_EXCEPTION.getCode(), BizCodeEnum.UNKNOWN_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>BrandController改回来，以后都用捕获异常</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span> &#123;</span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511222621434.png" alt="image-20230511222621434"></p>
<h3 id="4、分组校验，增改校验分开，-Validated"><a href="#4、分组校验，增改校验分开，-Validated" class="headerlink" title="4、分组校验，增改校验分开，@Validated"></a><strong>4、分组校验，增改校验分开，@Validated</strong></h3><p><strong>场景：新增时id必须为空，修改时id必须非空</strong>，这样实体类注解就凌乱了，这时就必须用到分组校验。</p>
<p><strong>注意：</strong></p>
<ul>
<li><p>实体类变量注解分组，代表此变量支持这些分组的校验。</p>
</li>
<li><p>controller参数对象注解分组，代表这个对象只校验有配置这个分组的成员变量</p>
</li>
<li><p>在common模块中valid包里**新建空接口<code>AddGroup</code>,<code>UpdateGroup</code>**用来分组</p>
</li>
<li><p><strong>实体类的id进行分组校验</strong></p>
<p>Brand实体类：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.adan.glmproduct.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.adan.common.valid.AddGroup;</span><br><span class="line"><span class="keyword">import</span> com.adan.common.valid.UpdateGroup;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> adan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 2028038953@qq.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023-05-06 18:12:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull(groups = &#123;UpdateGroup.class&#125;, message = &quot;修改必须指定品牌id&quot;)</span></span><br><span class="line">	<span class="meta">@Null(groups = &#123;AddGroup.class&#125;, message = &quot;新增不能指定id&quot;)</span></span><br><span class="line">	<span class="meta">@TableId</span></span><br><span class="line">	<span class="keyword">private</span> Long brandId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;品牌名必须提交&quot;)</span>    <span class="comment">//不能是null和&quot;&quot;和&quot;  &quot;</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌logo地址</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// @NotEmpty    //不能是null和&quot;&quot;</span></span><br><span class="line">	<span class="meta">@NotBlank(groups = &#123;AddGroup.class&#125;, message = &quot;品牌logo地址为空&quot;)</span></span><br><span class="line">	<span class="meta">@URL(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;logo必须是一个合法的url地址&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String logo;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 介绍</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String descript;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;显示状态为空&quot;)</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer showStatus;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检索首字母</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;首字母为空&quot;)</span></span><br><span class="line">	<span class="meta">@Pattern(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, regexp = &quot;^[a-zA-Z]$&quot;, message = &quot;检索首字母必须是一个字母&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String firstLetter;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 排序</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateGroup.class&#125;)</span></span><br><span class="line">	<span class="meta">@Min(value = 0, message = &quot;排序必须大于等于0&quot;, groups = &#123;AddGroup.class, UpdateGroup.class&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在这种情况下，没有指定分组的校验注解，默认是不起作用的。想要起作用就必须要加groups。</p>
<p><strong>注意：没有指定分组的校验，</strong>默认是不起作用的，所以要给所有属性都指定分组。</p>
<p><strong>@Valid改为@Validated注解，值为group接口数组，标记当前校验是哪个组</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Validated(&#123;AddGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span> &#123;  <span class="comment">// BindingResult result</span></span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated(&#123;UpdateGroup.class&#125;)</span> BrandEntity brand)</span> &#123;</span><br><span class="line">    brandService.updateById(brand);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试：</li>
</ul>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">### 测试jsr303校验数据</span><br><span class="line">POST http://localhost:88/api/glmproduct/brand/save</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;brandId&quot;:32,</span><br><span class="line">  &quot;name&quot;: &quot;阿大撒&quot;,</span><br><span class="line">  &quot;logo&quot;: &quot;da&quot;,</span><br><span class="line">  &quot;firstLetter&quot;: &quot;b&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511224140708.png" alt="image-20230511224140708"></p>
<h3 id="5、编写自定义校验，必须提交指定数值"><a href="#5、编写自定义校验，必须提交指定数值" class="headerlink" title="5、编写自定义校验，必须提交指定数值"></a><strong>5、编写自定义校验，必须提交指定数值</strong></h3><p>此步骤其实是画蛇添足的，因为前端状态字段是状态栏，值只能是0和1 </p>
<p><strong>步骤：</strong></p>
<ul>
<li>编写一个自定义校验注解<strong>ListValue</strong></li>
<li>新建配置文件<strong>ValidationMessages.properties</strong>保存注解信息</li>
<li>编写一个自定义校验器<strong>ListValueConstraintValidator</strong></li>
<li>关联自定义的校验器和自定义的校验注解（可以指定多个不同的校验器，适配不同类型的校验）</li>
</ul>
<p>common模块引入依赖（已完成） ：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>自定义校验注解@ListValue：</strong></p>
<blockquote>
<p>这里可以ctrl+b参考其他@NotNull等注解编写。</p>
</blockquote>
<p>common模块的valid包下：</p>
<p><strong>配置校验注解提示信息：</strong> </p>
<p>common模块创建配置文件<strong>ValidationMessages.properties</strong>：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">com.adan.common.valid.ListValue.message</span>=<span class="string">必须提交指定的值</span></span><br></pre></td></tr></table></figure>

<p><strong>编写自定义校验器，</strong> <strong>数值必须包含在vals范围内</strong></p>
<p>校验器实现ConstraintValidator接口。common模块的valid包下： </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第一个泛型是校验注解，第二个泛型是校验数据类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;ListValue,Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//    初始化方法,ListValue是自定义的注解.</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ListValue constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] value = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : value) &#123;</span><br><span class="line">            set.add(i);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否校验成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 需要校验的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>关联校验器和校验注解：</strong></p>
<p>在校验注解的@Constraint的validateBy属性中加入校验器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Constraint(validatedBy = &#123;ListValueConstraintValidator.class&#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="6、使用自定义校验，showStatus只能是0或1"><a href="#6、使用自定义校验，showStatus只能是0或1" class="headerlink" title="6、使用自定义校验，showStatus只能是0或1"></a><strong>6、使用自定义校验，showStatus只能是0或1</strong></h3><p> common模块的valid包下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UpdateStatusGroup</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateGroup.class, UpdateStatusGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@ListValue(vals=&#123;0,1&#125;,groups = &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></table></figure>

<p>BrandController </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/update/status&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated(&#123;UpdateStatusGroup.class&#125;)</span> BrandEntity brand)</span> &#123;</span><br><span class="line">    brandService.updateById(brand);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改前端修改<strong>状态</strong>路径：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511230752735.png" alt="image-20230511230752735"></p>
<h3 id="7、测试数据"><a href="#7、测试数据" class="headerlink" title="7、测试数据"></a>7、测试数据</h3><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">### 测试jsr303校验数据</span><br><span class="line">POST http://localhost:88/api/glmproduct/brand/save</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;brandId&quot;:32,</span><br><span class="line">  &quot;name&quot;: &quot;阿大撒&quot;,</span><br><span class="line">  &quot;logo&quot;: &quot;da&quot;,</span><br><span class="line">  &quot;firstLetter&quot;: &quot;b&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511230837346.png" alt="image-20230511230837346"></p>
<p>测试2：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">### 测试jsr303校验数据2</span><br><span class="line">POST http://localhost:88/api/glmproduct/brand/save</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;name&quot;: &quot;aaa&quot;, &quot;logo&quot;: &quot;m&quot;,&quot;brandId&quot;:32&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511231306917.png" alt="image-20230511231306917"></p>
<p><strong>测试3</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511231712578.png" alt="image-20230511231712578"></p>
<p><strong>前端测试：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230511230915876.png" alt="image-20230511230915876"></p>
<h3 id="8、最终校验的实体类和controller代码"><a href="#8、最终校验的实体类和controller代码" class="headerlink" title="8、最终校验的实体类和controller代码"></a>8、最终校验的实体类和controller代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.adan.glmproduct.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.adan.common.valid.AddGroup;</span><br><span class="line"><span class="keyword">import</span> com.adan.common.valid.ListValue;</span><br><span class="line"><span class="keyword">import</span> com.adan.common.valid.UpdateGroup;</span><br><span class="line"><span class="keyword">import</span> com.adan.common.valid.UpdateStatusGroup;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> adan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 2028038953@qq.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023-05-06 18:12:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull(groups = &#123;UpdateGroup.class&#125;, message = &quot;修改必须指定品牌id&quot;)</span></span><br><span class="line">	<span class="meta">@Null(groups = &#123;AddGroup.class&#125;, message = &quot;新增不能指定id&quot;)</span></span><br><span class="line">	<span class="meta">@TableId</span></span><br><span class="line">	<span class="keyword">private</span> Long brandId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;品牌名必须提交&quot;)</span>    <span class="comment">//不能是null和&quot;&quot;和&quot;  &quot;</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 品牌logo地址</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// @NotEmpty    //不能是null和&quot;&quot;</span></span><br><span class="line">	<span class="meta">@NotBlank(groups = &#123;AddGroup.class&#125;, message = &quot;品牌logo地址为空&quot;)</span></span><br><span class="line">	<span class="meta">@URL(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;logo必须是一个合法的url地址&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String logo;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 介绍</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String descript;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateGroup.class,UpdateStatusGroup.class&#125;, message = &quot;显示状态为空&quot;)</span></span><br><span class="line">	<span class="meta">@ListValue(vals = &#123;0,1&#125;, groups = &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer showStatus;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检索首字母</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotBlank(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, message = &quot;首字母为空&quot;)</span></span><br><span class="line">	<span class="meta">@Pattern(groups = &#123;AddGroup.class, UpdateGroup.class&#125;, regexp = &quot;^[a-zA-Z]$&quot;, message = &quot;检索首字母必须是一个字母&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String firstLetter;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 排序</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateGroup.class&#125;)</span></span><br><span class="line">	<span class="meta">@Min(value = 0, message = &quot;排序必须大于等于0&quot;, groups = &#123;AddGroup.class, UpdateGroup.class&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>controller：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;glmproduct:brand:save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Validated(&#123;AddGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">        <span class="comment">// BindingResult 接收校验异常返回结果</span></span><br><span class="line">        <span class="comment">/* if (result.hasErrors())&#123;</span></span><br><span class="line"><span class="comment">            Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">            //1.获取校验结果</span></span><br><span class="line"><span class="comment">            result.getFieldErrors().forEach((error) -&gt; &#123;</span></span><br><span class="line"><span class="comment">                //2.获取到错误提示</span></span><br><span class="line"><span class="comment">                String message = error.getDefaultMessage();</span></span><br><span class="line"><span class="comment">                //3. 获取错误字段</span></span><br><span class="line"><span class="comment">                String field = error.getField();</span></span><br><span class="line"><span class="comment">                //4.定义map集合接收错误信息</span></span><br><span class="line"><span class="comment">                map.put(field, message);</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">            return R.error().put(&quot;data&quot;, map);</span></span><br><span class="line"><span class="comment">        &#125;else &#123;</span></span><br><span class="line"><span class="comment">            brandService.save(brand);</span></span><br><span class="line"><span class="comment">        &#125; */</span></span><br><span class="line">        brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;glmproduct:brand:update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@Validated(&#123;UpdateGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">		brandService.updateById(brand);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/update/status&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;glmproduct:brand:update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@Validated(&#123;UpdateStatusGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">        brandService.updateById(brand);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="商品服务-属性分组"><a href="#商品服务-属性分组" class="headerlink" title="商品服务-属性分组"></a>商品服务-属性分组</h1><h2 id="1、-SPU和SKU"><a href="#1、-SPU和SKU" class="headerlink" title="1、 SPU和SKU"></a>1、 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=SPU&spm=1001.2101.3001.7020">SPU</a>和SKU</h2><h3 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h3><ul>
<li><p>SPU(Standard Product Unit)：标准化产品单元。是商品信息聚合的最小单位，是一组可复用、易检索的标准化信息的集合，该集合描述了一个产品的特性。通俗点讲，属性值、特性相同的商品集合就可以称为一个SPU。</p>
</li>
<li><p>SKU（Stock Keeping Unit）：SKU一般指最小存货单位、最小售卖单元。 最小存货单位（SKU），即库存进出计量的基本单元，可以是以件，盒，托盘等为单位。</p>
</li>
</ul>
<p><strong>SKU：</strong>最小存货单位是对于大型连锁超市DC配送中心物流管理的一个必要的方法。现在已经被<strong>引申为<code>产品统一编号</code>的简称</strong>，<strong>每种产品对应有唯一的SKU号</strong>。如iphone13ProMax 1T 蓝色 是SKU，包子店中肉包子是SKU，素包子是SKU，水煎包是SKU… </p>
<h3 id="2、举例"><a href="#2、举例" class="headerlink" title="2、举例"></a>2、<strong>举例</strong></h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/c0b03fa7f15e4431a754975dabe41a2f.png" alt="img"></p>
<p><strong>spu：</strong>这个苹果13是一个spu，标准化产品单位，它包括128g、256g、红色、绿色等。</p>
<p><strong>sku：</strong>苹果13-绿色-128g-快充套餐-是一个sku。这些sku属于同一个spu，分辨率、发布日期等公用规格参数都是一样的。</p>
<p><strong>一个spu包括了多个sku，sku决定最终价格：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/fa609558f2a240fd995f98d0c2b742dd.png" alt="img"></p>
<h3 id="3、销售属性、基本属性（规格参数）、属性分组、平台属性"><a href="#3、销售属性、基本属性（规格参数）、属性分组、平台属性" class="headerlink" title="3、销售属性、基本属性（规格参数）、属性分组、平台属性"></a>3、销售属性、基本属性（规格参数）、属性分组、平台属性</h3><p><strong>销售属性：</strong>购物时下面这些可选择的框就是销售属性，会影响最终价格。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/e1e3119e90e44b43863192a45582a06f.png" alt="img"></p>
<p>颜色、内存是手机的销售属性：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/42497b6d2d364820b41513b25d686942.png" alt="img"></p>
<p><strong>规格参数：</strong>商品详情页展示商品信息的属性为规格参数，同个spu里各sku规格参数相同。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/6b19583115cb4814aaca6b21fa8e5d0f.png" alt="img"></p>
<p>例如“入网型号” 和“上市年份”是苹果14的规格参数。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/952c021a867943248e8eca11e2e2f8c8.png" alt="img"></p>
<p><strong>属性分组和规格参数：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/ef178987bb0648bdbeb05fab62838b33.png" alt="img"></p>
<p><strong>“平台属性”后台最终效果：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/b1e66551119c48eda40dde3e193e740e.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/ccf5e848492b47d1b6b0589643b92075.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/d1b595422c0e4db383e331ffbfd52539.png" alt="img"></p>
<h3 id="3、分类表、属性表、属性分组表表关系详解"><a href="#3、分类表、属性表、属性分组表表关系详解" class="headerlink" title="3、分类表、属性表、属性分组表表关系详解"></a>3、分类表、属性表、属性分组表表关系详解</h3><p><strong>（1）属性关系-规格参数-销售属性-三级分类 关联关系</strong></p>
<p><strong>每个三级分类下有各自的属性分组表</strong>通过<code>id和catelogid关联</code>，能查出每个<strong>分类下的属性分组</strong></p>
<p>属性分组表和属性表通过一个<code>属性&amp;属性关联表</code>进行关联，能查出每个<strong>属性分组下的属性</strong></p>
<p>最终这样的关系我们可以查出每个分类的<code>属性分组</code>和每个<code>属性分组对应的属性</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/62eb29cc8e5f1ed305151ff08537e15d.png" alt="image-20220806110205216"></p>
<p><strong>（2）通过思维导图来理解</strong></p>
<blockquote>
<p><strong>手机是一级分类</strong>，它下面又有<strong>属性组</strong>，每个属性组又有各自的<strong>属性</strong></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/fcdd39e93e38806c5d93688c520eea3c.png" alt="image-20220807230244792"></p>
<p><strong>（3）SPU-SKU-属性表</strong></p>
<p>商品属性表和属性表通过<code>attrid</code>和<code>id</code>进行关联，能查出每个<strong>spu的属性</strong></p>
<p>sku销售属性表是为了表示<code>spu下不同sku</code>，比如<strong>1号spu在此表有两个sku</strong>，这两个<strong>sku有不同的销售属性</strong>，是通过<code>和属性表关联获取</code>的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/c65a05a543049dbd5945a8a0b11bfdfc.png" alt="image-20220806110506836"></p>
<p><strong>（4）通过思维导图来理解</strong></p>
<blockquote>
<p>像网络、像素一般是固定不可选的所以是SPU属性</p>
<p>而内存、容量、颜色等可选的就为SKU销售属性</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/2c35e6266c522d832bdaf69ba9932f56.png" alt="image-20220807231607457"></p>
<h2 id="1、环境准备"><a href="#1、环境准备" class="headerlink" title="1、环境准备"></a>1、环境准备</h2><h3 id="1、后台页面导入全部菜单"><a href="#1、后台页面导入全部菜单" class="headerlink" title="1、后台页面导入全部菜单"></a>1、后台页面导入全部菜单</h3><p><strong>运行<code>sys_menus.sql</code>创建全部菜单，建议复制粘贴到Navicat运行，直接拖进去可能会乱码。</strong>也可以在后台页面‘“系统管理-菜单管理”一个个创建。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/4bfe0306ef564ddeb880c1f171106818.png" alt="img"></p>
<h3 id="2、接口文档地址"><a href="#2、接口文档地址" class="headerlink" title="2、接口文档地址"></a>2、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3&spm=1001.2101.3001.7020">接口文档</a>地址</h3><p>以后<strong>前端代码</strong>不自己编写了，复制&#x2F;代码&#x2F;前端&#x2F;modules&#x2F;文件夹里面的内容复制到vs中</p>
<p><strong>接口文档地址：</strong><a target="_blank" rel="noopener" href="https://easydoc.xyz/s/78237135">https://easydoc.xyz/s/78237135</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/bf892b5685384621b18076a36f9c8ba1.png" alt="img"></p>
<h2 id="2、导入前端代码"><a href="#2、导入前端代码" class="headerlink" title="2、导入前端代码"></a>2、导入前端代码</h2><h3 id="1、属性分组功能的前端组件"><a href="#1、属性分组功能的前端组件" class="headerlink" title="1、属性分组功能的前端组件"></a>1、属性分组功能的前端组件</h3><p><strong>需求：</strong>在属性分组菜单中展示分类树，实现点击菜单的左边的分类树，能够实现在右边展示数据并且修改。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/f6a3a66254d04a6eba17ccbe6e5dfec9.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/db191d4900c71d03b02ffa3c88b94c64.png" alt="image-20210927180739781"></p>
<p><strong>具体实现</strong></p>
<ul>
<li><p>在前端src-views-modeules下<strong>新建<code>common/categroy.vue</code>，公共组件</strong>。抽出去左侧菜单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tree</span> <span class="attr">:data</span>=<span class="string">&quot;menus&quot;</span> <span class="attr">:props</span>=<span class="string">&quot;defaultProps&quot;</span> <span class="attr">node-key</span>=<span class="string">&quot;catId&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;menuTree&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-tree</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;</span></span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//import引入的组件需要注入到对象中才能使用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//这里存放数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">menus</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">expandedKey</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">defaultProps</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>, <span class="comment">//子节点</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">label</span>: <span class="string">&quot;name&quot;</span>, <span class="comment">//name属性作为标签的值，展示出来</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//监听属性 类似于data概念</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//监控data中的数据变化</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">watch</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//方法集合</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getMenus</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$http(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/list/tree&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成功了获取到菜单数据....&quot;</span>, data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">menus</span> = data.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//生命周期 - 创建完成（可以访问当前this实例）</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//生命周期 - 挂载完成（可以访问DOM元素）</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//生命周期 - 创建之前</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//生命周期 - 挂载之前</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//生命周期 - 更新之前</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">updated</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//生命周期 - 更新之后</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//生命周期 - 销毁之前</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">destroyed</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//生命周期 - 销毁完成</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">activated</span>(<span class="params"></span>) &#123;&#125;, <span class="comment">//如果页面有keep-alive缓存功能，这个函数会触发</span></span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把前端生成的<code>attrgroup-add-or-update.vue</code>复制到modules&#x2F;product下</p>
</li>
<li><p>在modules&#x2F;product&#x2F;下创建<code>attrgroup.vue</code></p>
<ul>
<li>布局：左侧6用来显示菜单，右侧18用来显示表格</li>
<li>引入公共组件<code>Category, AddOrUpdate</code></li>
<li>剩下的复制生成的<code>attrgroup.vue</code></li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">category</span>&gt;</span><span class="tag">&lt;/<span class="name">category</span>&gt;</span><span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;18&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mod-config&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:inline</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:model</span>=<span class="string">&quot;dataForm&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">keyup.enter.native</span>=<span class="string">&quot;getDataList()&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-model</span>=<span class="string">&quot;dataForm.key&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">placeholder</span>=<span class="string">&quot;参数名&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;getDataList()&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-if</span>=<span class="string">&quot;isAuth(&#x27;product:attrgroup:save&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">              @<span class="attr">click</span>=<span class="string">&quot;addOrUpdateHandle()&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>新增&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-if</span>=<span class="string">&quot;isAuth(&#x27;product:attrgroup:delete&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">              @<span class="attr">click</span>=<span class="string">&quot;deleteHandle()&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:disabled</span>=<span class="string">&quot;dataListSelections.length &lt;= 0&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>批量删除&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:data</span>=<span class="string">&quot;dataList&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">border</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-loading</span>=<span class="string">&quot;dataListLoading&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">selection-change</span>=<span class="string">&quot;selectionChangeHandle&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;selection&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">width</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;attrGroupId&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;分组id&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;attrGroupName&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;组名&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;sort&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;排序&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;descript&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;描述&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;组图标&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;catelogId&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;所属分类id&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fixed</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">width</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">click</span>=<span class="string">&quot;addOrUpdateHandle(scope.row.attrGroupId)&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>修改&lt;/el-button</span><br><span class="line">              &gt;</span><br><span class="line">              <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">click</span>=<span class="string">&quot;deleteHandle(scope.row.attrGroupId)&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>删除&lt;/el-button</span><br><span class="line">              &gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">size-change</span>=<span class="string">&quot;sizeChangeHandle&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">current-change</span>=<span class="string">&quot;currentChangeHandle&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:current-page</span>=<span class="string">&quot;pageIndex&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:page-sizes</span>=<span class="string">&quot;[10, 20, 50, 100]&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:page-size</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:total</span>=<span class="string">&quot;totalPage&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 弹窗, 新增 / 修改 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">add-or-update</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-if</span>=<span class="string">&quot;addOrUpdateVisible&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">ref</span>=<span class="string">&quot;addOrUpdate&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">refreshDataList</span>=<span class="string">&quot;getDataList&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">add-or-update</span>&gt;</span>&lt;/div</span><br><span class="line">    &gt;<span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Category</span> <span class="keyword">from</span> <span class="string">&quot;../common/category.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">AddOrUpdate</span> <span class="keyword">from</span> <span class="string">&quot;./attrgroup-add-or-update.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//import引入的组件需要注入到对象中才能使用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123; <span class="title class_">Category</span>, <span class="title class_">AddOrUpdate</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dataForm</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">key</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dataList</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">pageIndex</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">pageSize</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">totalPage</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dataListLoading</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dataListSelections</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">addOrUpdateVisible</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">activated</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">getDataList</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取数据列表</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getDataList</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">dataListLoading</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$http(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/attrgroup/list&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">params</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornParams</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">page</span>: <span class="variable language_">this</span>.<span class="property">pageIndex</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">limit</span>: <span class="variable language_">this</span>.<span class="property">pageSize</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">key</span>: <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">key</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;),</span></span><br><span class="line"><span class="language-javascript">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">code</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">dataList</span> = data.<span class="property">page</span>.<span class="property">list</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">totalPage</span> = data.<span class="property">page</span>.<span class="property">totalCount</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">dataList</span> = [];</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">totalPage</span> = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">dataListLoading</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 每页数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">sizeChangeHandle</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">pageSize</span> = val;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">pageIndex</span> = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">getDataList</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 当前页</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">currentChangeHandle</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">pageIndex</span> = val;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">getDataList</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 多选</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">selectionChangeHandle</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">dataListSelections</span> = val;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 新增 / 修改</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">addOrUpdateHandle</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">addOrUpdateVisible</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">addOrUpdate</span>.<span class="title function_">init</span>(id);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 删除</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">deleteHandle</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> ids = id</span></span><br><span class="line"><span class="language-javascript">        ? [id]</span></span><br><span class="line"><span class="language-javascript">        : <span class="variable language_">this</span>.<span class="property">dataListSelections</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> item.<span class="property">attrGroupId</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$confirm(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">`确定对[id=<span class="subst">$&#123;ids.join(<span class="string">&quot;,&quot;</span>)&#125;</span>]进行[<span class="subst">$&#123;id ? <span class="string">&quot;删除&quot;</span> : <span class="string">&quot;批量删除&quot;</span>&#125;</span>]操作?`</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;提示&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      ).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$http(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/attrgroup/delete&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(ids, <span class="literal">false</span>),</span></span><br><span class="line"><span class="language-javascript">        &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">code</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">message</span>: <span class="string">&quot;操作成功&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">duration</span>: <span class="number">1500</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">onClose</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="title function_">getDataList</span>();</span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(data.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2、父子组件传递数据"><a href="#2、父子组件传递数据" class="headerlink" title="2、父子组件传递数据"></a>2、父子组件传递数据</h3><p>要实现功能：点击左侧，右侧表格对应内容显示。</p>
<p>父子组件传递数据：<code>category.vue</code>点击时，引用它的<code>attgroup.vue</code>能感知到， 然后通知到add-or-update</p>
<p>1、子组件发送事件</p>
<ul>
<li>在<code>category.vue</code>中的树形控件绑定点击事件<code>@node-click=&quot;nodeclick&quot;</code></li>
<li>node-click方法中有三个参数(data, node, component),data表示当前数据，node为elementui封装的数据</li>
<li>点击之后向父组件发送事件：<code>this.$emit(&quot;tree-node-click&quot;,...)</code> …为参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//组件绑定事件</span><br><span class="line"><span class="tag">&lt;<span class="name">el-tree</span> <span class="attr">:data</span>=<span class="string">&quot;menus&quot;</span> <span class="attr">:props</span>=<span class="string">&quot;defaultProps&quot;</span> <span class="attr">node-key</span>=<span class="string">&quot;catId&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;menuTree&quot;</span> @<span class="attr">node-click</span>=<span class="string">&quot;nodeclick&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">//methods中新增方法</span><br><span class="line">	nodeclick(data, node, component)&#123;</span><br><span class="line">      console.log(&quot;子组件categroy的节点被点击:&quot;, data,node,component);</span><br><span class="line">      this.$emit(&quot;tree-node-click&quot;, data,node,component); //向父组件发送tree-node-click事件</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2、父组件接收事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//引用的组件，可能会发散tree-node-click事件，当接收到时，触发父组件的treenodeclick方法</span><br><span class="line"><span class="tag">&lt;<span class="name">category</span> @<span class="attr">tree-node-click</span>=<span class="string">&quot;treenodeclick&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//methods中新增treenodeclick方法，验证父组件是否接收到</span><br><span class="line">      treenodeclick(data, node, component)&#123;</span><br><span class="line">          console.log(&quot;attrgroup感知到category的节点被点击：&quot;,data, node, component);</span><br><span class="line">          console.log(&quot;刚才被点击的菜单名字&quot;, data.name);</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="3、查询“属性分组”列表，按参数"><a href="#3、查询“属性分组”列表，按参数" class="headerlink" title="3、查询“属性分组”列表，按参数"></a>3、查询“属性分组”列表，按参数</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/97f92c989a29179873f7bcaa8d2b0ad3.png" alt="image-20220811091620116"></p>
<p><strong>0、需求：</strong>分页查询指定分类id下的“属性分组”列表</p>
<p><strong>1、接口url：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/product/attrgroup/list/&#123;catelogId&#125;</span><br></pre></td></tr></table></figure>

<p>attr是attribute缩写，译为属性。 </p>
<p><strong>2、修改controller的list方法</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/48d10a7475f6548312ae56b90d5f70e9.png" alt="image-20220810220705409"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params, <span class="meta">@PathVariable</span> Long catelogId)</span>&#123;</span><br><span class="line">    <span class="comment">//PageUtils page = attrGroupService.queryPage(params);</span></span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrGroupService.queryPage(params, catelogId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、service编写查询方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params, Long categoryId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        LambdaQueryWrapper&lt;AttrGroupEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//先根据检索查</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(key))&#123;</span><br><span class="line"><span class="comment">//wrapper.eq(AttrGroupEntity::getAttrGroupId,key).or().like(AttrGroupEntity::getAttrGroupName,key);//也可以，因为多条件查询默认是and，or要用.or()。</span></span><br><span class="line">            wrapper.and(</span><br><span class="line">                    obj-&gt;obj.eq(AttrGroupEntity::getAttrGroupId,key).or().like(AttrGroupEntity::getAttrGroupName,key)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(categoryId!=<span class="number">0</span>) &#123;</span><br><span class="line">            wrapper.eq(AttrGroupEntity::getCatelogId,categoryId);</span><br><span class="line">        &#125;</span><br><span class="line">        IPage&lt;AttrGroupEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">                wrapper</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、测试后端</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">### 测试查询分组数据</span><br><span class="line">GET http://localhost:88/api/product/attrgroup/list/1?page=1&amp;key=aa</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514194806052.png" alt="image-20230514194806052"></p>
<p><strong>5、修改前端代码</strong></p>
<ul>
<li>修改getDataList()中的请求路径</li>
<li>data中新增<code>catId</code></li>
<li>methods中修改点击方法</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/0fcc736ab9a64aa7b0566c2c961073de.png" alt="img"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">treenodeclick</span>(<span class="params">data, node, component</span>) &#123;</span><br><span class="line">  <span class="comment">//必须是三级分类，才显示属性</span></span><br><span class="line">  <span class="keyword">if</span> (data.<span class="property">catLevel</span> == <span class="number">3</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">catId</span> = data.<span class="property">catId</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getDataList</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>6、新增假数据，测试页面：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/7d1ee3071f7c4bc9810d748902559396.png" alt="img"></p>
<p>225分类id对应手机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514195125955.png" alt="image-20230514195125955"></p>
<h2 id="4、新增属性分组"><a href="#4、新增属性分组" class="headerlink" title="4、新增属性分组"></a>4、新增属性分组</h2><p>新增时，<strong>父id改换成选择框</strong> </p>
<h3 id="1、-新增选择框，elementUI级联选择器el-cascader"><a href="#1、-新增选择框，elementUI级联选择器el-cascader" class="headerlink" title="1、 新增选择框，elementUI级联选择器el-cascader"></a><strong>1、</strong> <strong>新增选择框，</strong>elementUI级联选择器el-cascader</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/9047c2b41de64aea91548fe3137c8e44.png" alt="img"></p>
<ul>
<li>发现可以选择但是并不显示名称，原因是显示的属性是<code>label</code>，通过<code>props</code>属性进行绑定</li>
</ul>
<p>elementUI级联选择器 </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--v-model 绑定要提交的数据，options绑定选择菜单, props绑定选择框的参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;所属分类id&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;catelogId&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-cascader</span> <span class="attr">v-model</span>=<span class="string">&quot;dataForm.catelogIds&quot;</span> <span class="attr">:options</span>=<span class="string">&quot;categroys&quot;</span> <span class="attr">:props</span>=<span class="string">&quot;props&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-cascader</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//data中新增属性，props用来绑定选择框的参数，categorys用来保存菜单</span></span><br><span class="line">	  <span class="attr">props</span>:&#123;</span><br><span class="line">        <span class="attr">value</span>:<span class="string">&quot;catId&quot;</span>,</span><br><span class="line">        <span class="attr">label</span>:<span class="string">&quot;name&quot;</span>,</span><br><span class="line">        <span class="attr">children</span>:<span class="string">&quot;children&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">categroys</span>:[],</span><br><span class="line">          </span><br><span class="line"><span class="comment">//方法中新增getCategorys(),用来获取选择菜单的值</span></span><br><span class="line"><span class="title function_">getCategorys</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/list/tree&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成功了获取到菜单数据....&quot;</span>, data.<span class="property">data</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categroys</span> = data.<span class="property">data</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">//组件创建的时候就要获取菜单的值</span></span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getCategorys</span>();</span><br><span class="line">  &#125;        </span><br></pre></td></tr></table></figure>

<h3 id="2、children字段注解-JsonInclude"><a href="#2、children字段注解-JsonInclude" class="headerlink" title="2、children字段注解@JsonInclude"></a>2、children字段注解@JsonInclude</h3><p><strong>当前问题：</strong> </p>
<p>发现返回的数据，<strong>无子分类</strong>下面也有<strong>children（为空）</strong>解决方法：设置后端，当children为空时，不返回children字段：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/2ec8ce4e96e1489ea01fcbbdd3ce4644.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/9604cb425d4f4b879cbb363ac0e1cf2a.png" alt="img"></p>
<p><strong>解决：</strong> </p>
<p>在分类实体类的children字段上添加注解：<strong>当值为空时，不返回当前字段</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span> <span class="comment">//表示数据库表中不存在</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;CategoryEntity&gt; children;</span><br></pre></td></tr></table></figure>

<p><strong>此时无子分类的children字段就为空：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/bbe40efc41eb41499b69a4f2c5bac91a.png" alt="img"></p>
<h3 id="3、前端报错解决，修改前端catelogId"><a href="#3、前端报错解决，修改前端catelogId" class="headerlink" title="3、前端报错解决，修改前端catelogId"></a>3、前端报错解决，修改前端<code>catelogId</code></h3><p><strong>选择“所属分类”之后报错：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/eebe035070f24efd9e83b57fc1b0b853.png" alt="img"></p>
<p>原因是：el-cascader绑定的<code>dataForm.catelogId</code>是一个数组，其中包含选择框的父节点id和自己的id。而<strong>我们要提交的只需要三级分类的id，不需要父分类的id。</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//修改data中的dataFrom</span></span><br><span class="line">      <span class="attr">dataForm</span>: &#123;</span><br><span class="line">        <span class="attr">attrGroupId</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">attrGroupName</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">sort</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">descript</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">catelogIds</span>: [], <span class="comment">//保存父节点和子节点的id</span></span><br><span class="line">        <span class="attr">catelogId</span>: <span class="number">0</span> <span class="comment">//保存要提交的子节点的id</span></span><br><span class="line">      &#125;,</span><br><span class="line">          </span><br><span class="line"><span class="comment">//修改表单提交方法，要传送的数据，只传最后一个子id</span></span><br><span class="line"><span class="attr">catelogId</span>: <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">catelogIds</span>[<span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">catelogIds</span>.<span class="property">length</span> - <span class="number">1</span>],</span><br></pre></td></tr></table></figure>

<h2 id="5、修改回显“所属分类”功能"><a href="#5、修改回显“所属分类”功能" class="headerlink" title="5、修改回显“所属分类”功能"></a>5、修改回显“所属分类”功能</h2><p>0、分类路径无法回显问题</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/d4d32dea0f7e449ebbee0f52a5a01a58.png" alt="img"></p>
<p><strong>只能查到当前属性所属分类的id</strong> </p>
<h3 id="1、前端回显时，查询分类路径请求"><a href="#1、前端回显时，查询分类路径请求" class="headerlink" title="1、前端回显时，查询分类路径请求"></a>1、前端回显时，查询分类路径请求</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">init</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">attrGroupId</span> = id || <span class="number">0</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">visible</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&quot;dataForm&quot;</span>].<span class="title function_">resetFields</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">attrGroupId</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(</span><br><span class="line">              <span class="string">`/product/attrgroup/info/<span class="subst">$&#123;<span class="variable language_">this</span>.dataForm.attrGroupId&#125;</span>`</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="attr">params</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornParams</span>(),</span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">attrGroupName</span> = data.<span class="property">attrGroup</span>.<span class="property">attrGroupName</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">sort</span> = data.<span class="property">attrGroup</span>.<span class="property">sort</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">descript</span> = data.<span class="property">attrGroup</span>.<span class="property">descript</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">icon</span> = data.<span class="property">attrGroup</span>.<span class="property">icon</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">catelogId</span> = data.<span class="property">attrGroup</span>.<span class="property">catelogId</span>;</span><br><span class="line">              <span class="comment">//查出catelogId的完整路径</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">dataForm</span>.<span class="property">catelogPath</span> = data.<span class="property">attrGroup</span>.<span class="property">catelogPath</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="2、AttrGroupEntity新增分类路径的成员变量"><a href="#2、AttrGroupEntity新增分类路径的成员变量" class="headerlink" title="2、AttrGroupEntity新增分类路径的成员变量"></a>2、<code>AttrGroupEntity</code>新增分类路径的成员变量</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Long[] catelogPath;</span><br></pre></td></tr></table></figure>

<h3 id="3、属性分组controller的info方法查询赋值分类路径"><a href="#3、属性分组controller的info方法查询赋值分类路径" class="headerlink" title="3、属性分组controller的info方法查询赋值分类路径"></a>3、属性分组controller的info方法查询赋值分类路径</h3><p><strong>AttrGroupController</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> CategoryService categoryService;    </span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/info/&#123;attrGroupId&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;attrGroupId&quot;)</span> Long attrGroupId)</span>&#123;</span><br><span class="line">	<span class="type">AttrGroupEntity</span> <span class="variable">attrGroup</span> <span class="operator">=</span> attrGroupService.getById(attrGroupId);</span><br><span class="line"></span><br><span class="line">	<span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrGroup.getCatelogId();</span><br><span class="line">	<span class="comment">//根据id查询完整路径。      查询结果要添加分类路径字段，样式[2,34,225]</span></span><br><span class="line">	Long[] path = categoryService.findCatelogPath(catelogId);</span><br><span class="line"></span><br><span class="line">	attrGroup.setCatelogPath(path);</span><br><span class="line">       <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attrGroup&quot;</span>, attrGroup);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、分类的service编写方法，查找分类路径"><a href="#4、分类的service编写方法，查找分类路径" class="headerlink" title="4、分类的service编写方法，查找分类路径"></a>4、分类的service编写方法，查找分类路径</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//categoryService接口</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *找到catelogId的完整路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Long[] findCatelogPath(Long catelogId);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//categoryServiceImpl实现方法</span></span><br><span class="line">	<span class="comment">//查找完整路径方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Long[] findCatelogPath(Long catelogId) &#123;</span><br><span class="line">        List&lt;Long&gt; paths = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Long&gt; parentPath = findParentPath(catelogId, paths);</span><br><span class="line">        <span class="keyword">return</span> parentPath.toArray(<span class="keyword">new</span> <span class="title class_">Long</span>[parentPath.size()]);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//递归查找父节点id</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Long&gt; <span class="title function_">findParentPath</span><span class="params">(Long catelogId,List&lt;Long&gt; paths)</span>&#123;</span><br><span class="line">        <span class="comment">//1、收集当前节点id</span></span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">byId</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(catelogId);</span><br><span class="line">        <span class="keyword">if</span> (byId.getParentCid() != <span class="number">0</span>)&#123;</span><br><span class="line">            findParentPath(byId.getParentCid(), paths);</span><br><span class="line">        &#125;</span><br><span class="line">        paths.add(catelogId);</span><br><span class="line">        <span class="keyword">return</span> paths;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、测试查询分类路径业务"><a href="#5、测试查询分类路径业务" class="headerlink" title="5、测试查询分类路径业务"></a>5、测试查询分类路径业务</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">CategoryService categoryService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPathCatelog</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(categoryService.findCatelogPath(<span class="number">225L</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、测试查询分类路径业务-1"><a href="#5、测试查询分类路径业务-1" class="headerlink" title="5、测试查询分类路径业务"></a>5、测试查询分类路径业务</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">CategoryService categoryService;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPathCatelog</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(categoryService.findCatelogPath(<span class="number">225L</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514201749921.png" alt="image-20230514201749921"></p>
<p>前端也正常回显：	</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514202036545.png" alt="image-20230514202036545"></p>
<h3 id="6、前端，对话框关闭时清空数据，防止不合理回显"><a href="#6、前端，对话框关闭时清空数据，防止不合理回显" class="headerlink" title="6、前端，对话框关闭时清空数据，防止不合理回显"></a>6、前端，对话框关闭时清空数据，防止不合理回显</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:title</span>=<span class="string">&quot;!dataForm.attrGroupId ? &#x27;新增&#x27; : &#x27;修改&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:close-on-click-modal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:visible.sync</span>=<span class="string">&quot;visible&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">closed</span>=<span class="string">&quot;dialogClose&quot;</span> //<span class="attr">关闭时</span>，<span class="attr">绑定方法dialogClose</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">      </span><br><span class="line">//新增方法</span><br><span class="line">  dialogClose()&#123;</span><br><span class="line">    this.dataForm.catelogPath = [];</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="6、前端“所属分类”可搜索，显示提示信息"><a href="#6、前端“所属分类”可搜索，显示提示信息" class="headerlink" title="6、前端“所属分类”可搜索，显示提示信息"></a>6、前端“所属分类”可搜索，显示提示信息</h3><p>选择框加上搜索功能：<code>filterable</code>， 显示提示信息<code>placeholder=&quot;试试搜索：手机&quot;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-cascader</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">&quot;试试搜索：手机&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">filterable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;dataForm.catelogPath&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:options</span>=<span class="string">&quot;categroys&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:props</span>=<span class="string">&quot;props&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">el-cascader</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514202137921.png" alt="image-20230514202137921"></p>
<h2 id="6、分页-mybatisplus分页拦截器"><a href="#6、分页-mybatisplus分页拦截器" class="headerlink" title="6、分页-mybatisplus分页拦截器"></a>6、分页-mybatisplus分页拦截器</h2><p>发现自动生成的分页条不好使，原因是没有<strong>引入mybatis-plus的分页插件</strong>。</p>
<p>product模块新建config包，新建配置类，引入如下配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>();</span><br><span class="line"><span class="comment">//        溢出总页数后是否进行处理(默认不处理)</span></span><br><span class="line">        paginationInnerInterceptor.setOverflow(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//        单页分页条数限制(默认无限制)</span></span><br><span class="line">        paginationInnerInterceptor.setMaxLimit(<span class="number">1000L</span>);</span><br><span class="line">        interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启后分页展示正常。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514202559828.png" alt="image-20230514202559828"></p>
<h1 id="优化品牌管理"><a href="#优化品牌管理" class="headerlink" title="优化品牌管理"></a>优化品牌管理</h1><h2 id="1、按搜索文字，分页查询"><a href="#1、按搜索文字，分页查询" class="headerlink" title="1、按搜索文字，分页查询"></a>1、按搜索文字，分页查询</h2><p>修改BrandServiceImpl的queryPage方法：</p>
<p><strong>这里仅检索id和name：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;brandService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BrandDao, BrandEntity&gt; <span class="keyword">implements</span> <span class="title class_">BrandService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        LambdaQueryWrapper&lt;BrandEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(key))&#123;</span><br><span class="line">            wrapper.eq(BrandEntity::getBrandId,key).or().like(BrandEntity::getName,key);</span><br><span class="line">        &#125;</span><br><span class="line">        IPage&lt;BrandEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Query</span>&lt;BrandEntity&gt;().getPage(params),</span><br><span class="line">                wrapper</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试成功：</strong></p>
<h2 id="2、获取当前品牌关联的所有分类"><a href="#2、获取当前品牌关联的所有分类" class="headerlink" title="2、获取当前品牌关联的所有分类"></a>2、获取当前品牌关联的所有分类</h2><h3 id="1、前端"><a href="#1、前端" class="headerlink" title="1、前端"></a>1、<strong>前端</strong></h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/95139b8140fb4f0caa7e5afc1d62eb06.png" alt="img"></p>
<p>复制粘贴前端代码。把课件modues下的common和product文件复制到对应目录</p>
<p>小米品牌下面可能包括手机、电器等分类，同样手机分类可能包括小米、华为等多个品牌。所以品牌与分类是多对多的关系。表pms_category_brand_relation保存品牌与分类的多对多关系</p>
<p>查看文档，<code>获取品牌关联的分类: </code><a target="_blank" rel="noopener" href="https://easydoc.net/s/78237135/ZUqEdvA4/SxysgcEF">15、获取品牌关联的分类 - 谷粒商城</a></p>
<h3 id="2、controller编写方法，获取当前品牌关联的所有分类"><a href="#2、controller编写方法，获取当前品牌关联的所有分类" class="headerlink" title="2、controller编写方法，获取当前品牌关联的所有分类"></a>2、controller编写方法，获取当前品牌关联的所有分类</h3><p><strong>请求：</strong>get </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/product/categorybrandrelation/catelog/list</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/60af9d7681bd40429b7b65424bdd7d49.png" alt="img"></p>
<p><strong>数据库：</strong>brandName和categoryName其实是冗余字段，目的<strong>减少数据库压力</strong>，仅在新增时根据id查name赋值，之后查关系时就不用再根据id查name。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/7ce4e548d0a445eba3431b2f0bdc89b7.png" alt="img"></p>
<p>修改CategoryBrandRelationServiceImpl</p>
<p>根据传过来的brandId，查找当前品牌关联所有的分类信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前品牌关联的所有分类列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/catelog/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">catelogList</span><span class="params">(<span class="meta">@RequestParam(&quot;brandId&quot;)</span> Long brandId)</span>&#123;</span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; data = categoryBrandRelationService.list(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>, brandId)</span><br><span class="line">    );</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、新增关联的controller、service"><a href="#3、新增关联的controller、service" class="headerlink" title="3、新增关联的controller、service"></a>3、新增关联的controller、service</h3><p>新增品牌与分类关联关系，主要需要改动是在保存时，查询并赋值冗余字段brandName和categoryName</p>
<p><strong>请求：</strong>post</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">product/categorybrandrelation/save</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/43938df2cb8147f8a6c7173d15993b6f.png" alt="img"></p>
<p>修改controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 保存</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">  <span class="comment">//@RequiresPermissions(&quot;product:categorybrandrelation:save&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> CategoryBrandRelationEntity categoryBrandRelation)</span>&#123;</span><br><span class="line">categoryBrandRelationService.saveDetail(categoryBrandRelation);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>service</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   CategoryDao categoryDao;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   BrandDao brandDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveDetail</span><span class="params">(CategoryBrandRelationEntity categoryBrandRelation)</span> &#123;</span><br><span class="line">       <span class="type">Long</span> <span class="variable">brandId</span> <span class="operator">=</span> categoryBrandRelation.getBrandId();</span><br><span class="line">       <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> categoryBrandRelation.getCatelogId();</span><br><span class="line">       <span class="comment">//查询详细名字和分类名字</span></span><br><span class="line">       <span class="type">BrandEntity</span> <span class="variable">brandEntity</span> <span class="operator">=</span> brandDao.selectById(brandId);</span><br><span class="line">       <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(catelogId);</span><br><span class="line">       categoryBrandRelation.setBrandName(brandEntity.getName());</span><br><span class="line">       categoryBrandRelation.setCatelogName(categoryEntity.getName());</span><br><span class="line">       <span class="built_in">this</span>.save(categoryBrandRelation);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、测试新增和查询“关联关系”"><a href="#4、测试新增和查询“关联关系”" class="headerlink" title="4、测试新增和查询“关联关系”"></a>4、测试新增和查询“关联关系”</h3><p>新增华为和手机的关联分类：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514210426114.png" alt="image-20230514210426114"></p>
<h3 id="5、修改品牌名时，同步修改关联表的品牌名"><a href="#5、修改品牌名时，同步修改关联表的品牌名" class="headerlink" title="5、修改品牌名时，同步修改关联表的品牌名"></a>5、修改品牌名时，同步修改关联表的品牌名</h3><p>要对品牌（分类）名字进行修改时，品牌分类关系表之中的名字也要进行修改</p>
<ul>
<li>品牌名字修改同时修改表数据</li>
</ul>
<p>BrandController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">  <span class="comment">//@RequiresPermissions(&quot;product:brand:update&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@Validated(value = &#123;UpdateGroup.class&#125;)</span><span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">brandService.updateByIdDetail(brand);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>brandServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   CategoryBrandRelationService categoryBrandRelationService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateByIdDetail</span><span class="params">(BrandEntity brand)</span> &#123;</span><br><span class="line">       <span class="comment">//保证冗余字段的数据一致</span></span><br><span class="line">       <span class="built_in">this</span>.updateById(brand);</span><br><span class="line">       <span class="keyword">if</span> (!StringUtils.isEmpty(brand.getName()))&#123;</span><br><span class="line">           <span class="comment">//如果修改了名字，则品牌分类关系表之中的名字也要修改</span></span><br><span class="line">           categoryBrandRelationService.updateBrand(brand.getBrandId(), brand.getName());</span><br><span class="line">           <span class="comment">//TODO 更新其他关联</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBrand</span><span class="params">(Long brandId, String name)</span> &#123;</span><br><span class="line">    <span class="type">CategoryBrandRelationEntity</span> <span class="variable">categoryBrandRelationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CategoryBrandRelationEntity</span>();</span><br><span class="line">    categoryBrandRelationEntity.setBrandName(name);</span><br><span class="line">    categoryBrandRelationEntity.setBrandId(brandId);</span><br><span class="line">    <span class="built_in">this</span>.update(categoryBrandRelationEntity, <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>, brandId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试，修改品牌名时，关联表里的品牌名也改了：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514211939442.png" alt="image-20230514211939442"></p>
<h3 id="6、修改分类名时，同步修改关联表的分类名。映射配置文件xml方法"><a href="#6、修改分类名时，同步修改关联表的分类名。映射配置文件xml方法" class="headerlink" title="6、修改分类名时，同步修改关联表的分类名。映射配置文件xml方法"></a>6、修改分类名时，同步修改关联表的分类名。映射配置文件xml方法</h3><p>CategoryController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 修改</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">  <span class="comment">//@RequiresPermissions(&quot;product:category:update&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> CategoryEntity category)</span>&#123;</span><br><span class="line">categoryService.updateCascade(category);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>CategroyServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">//别忘了加业务注解，引导类开启了业务@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCascade</span><span class="params">(CategoryEntity category)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.updateById(category);</span><br><span class="line">       categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationServiceImpl</p>
<p>用上一节品牌修改的方法也行。<strong>这次使用映射配置文件xml方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCategory</span><span class="params">(Long catId, String name)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.baseMapper.updateCategroy(catId, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationDao</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">updateCategroy</span><span class="params">(<span class="meta">@Param(&quot;catId&quot;)</span> Long catId,<span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br></pre></td></tr></table></figure>

<p>CateBrandRelationDao.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateCategroy&quot;</span>&gt;</span></span><br><span class="line">    UPDATE `pms_category_brand_relation` SET catelog_name=#&#123;name&#125; WHERE catelog_id=#&#123;catId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>测试：</strong></p>
<p>修改分类中手机为“手机1”，发现关联表中分类名也改了：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514213859415.png" alt="image-20230514213859415"></p>
<h1 id="商品服务-属性（规格参数和销售属性）"><a href="#商品服务-属性（规格参数和销售属性）" class="headerlink" title="商品服务-属性（规格参数和销售属性）"></a>商品服务-属性（规格参数和销售属性）</h1><h2 id="1、新增属性时，新增属性和属性分组的关联关系"><a href="#1、新增属性时，新增属性和属性分组的关联关系" class="headerlink" title="1、新增属性时，新增属性和属性分组的关联关系"></a>1、新增属性时，新增属性和属性分组的关联关系</h2><h3 id="1、规格参数表单介绍"><a href="#1、规格参数表单介绍" class="headerlink" title="1、规格参数表单介绍"></a>1、规格参数表单介绍</h3><p><strong>规格参数最终效果：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/d9926b2b53084ef18d59658620ce96bf.png" alt="img"></p>
<p><strong>新增表单</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/e788111bf9c84cff9dfb81ebefab5dc1.png" alt="img"></p>
<p><strong>“快速展示”</strong>是在介绍页面快速展示此规格：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/211daa2a0d244e2792aa569bb9105530.png" alt="img"></p>
<h3 id="2、Object划分（po、vo、dto等）"><a href="#2、Object划分（po、vo、dto等）" class="headerlink" title="2、Object划分（po、vo、dto等）"></a>2、Object划分（po、vo、dto等）</h3><ol>
<li><p>PO(persistant object) 持久对象<br>PO 就是对应数据库中某个表中的一条记录， 多个记录可以用 PO 的集合。 PO 中应该不包<br>含任何对数据库的操作。</p>
</li>
<li><p>DO（Domain Object） 领域对象<br>就是从现实世界中抽象出来的有形或无形的业务实体。</p>
</li>
<li><p>TO(Transfer Object) ， 数据传输对象<br>不同的应用程序之间传输的对象</p>
</li>
<li><p>DTO（Data Transfer Object） 数据传输对象<br>这个概念来源于 J2EE 的设计模式， 原来的目的是为了 EJB 的分布式应用提供粗粒度的数据实体， 以减少分布式调用的次数， 从而提高分布式调用的性能和降低网络负载， 但在这里， 泛指用于展示层与服务层之间的数据传输对象。</p>
</li>
<li><p>VO(value object) 值对象<br>通常用于业务层之间的数据传递， 和 PO 一样也是仅仅包含数据而已。 但应是抽象出的业务对象 , 可以和表对应 , 也可以不 , 这根据业务的需要 。 用 new 关键字创建， 由GC 回收的。</p>
</li>
</ol>
<p>View object： 视图对象；接受页面传递来的数据， 封装对象将业务处理完成的对象， 封装成页面要用的数据</p>
<ol start="6">
<li><p>BO(business object) 业务对象<br>从业务模型的角度看 , 见 UML 元件领域模型中的领域对象。 封装业务逻辑的 java 对<br>象 , 通过调用 DAO 方法 , 结合 PO,VO 进行业务操作。 business object: 业务对象 主要作<br>用是把业务逻辑封装为一个对象。 这个对象可以包括一个或多个其它的对象。 比如一个简<br>历， 有教育经历、 工作经历、 社会关系等等。 我们可以把教育经历对应一个 PO ， 工作经<br>历对应一个 PO ， 社会关系对应一个 PO 。 建立一个对应简历的 BO 对象处理简历， 每<br>个 BO 包含这些 PO 。 这样处理业务逻辑时， 我们就可以针对 BO 去处理。</p>
</li>
<li><p>POJO(plain ordinary java object) 简单无规则 java 对象<br>传统意义的 java 对象。 就是说在一些 Object&#x2F;Relation Mapping 工具中， 能够做到维护数据库表记录的 persisent object 完全是一个符合 Java Bean 规范的纯 Java 对象， 没有增加别的属性和方法。 我的理解就是最基本的 java Bean ， 只有属性字段及 setter 和 getter方法！POJO 是 DO&#x2F;DTO&#x2F;BO&#x2F;VO 的统称。</p>
</li>
<li><p>DAO(data access object) 数据访问对象<br>是一个 sun 的一个标准 j2ee 设计模式， 这个模式中有个接口就是 DAO ， 它负持久层的操作。 为业务层提供接口。 此对象用于访问数据库。 通常和 PO 结合使用， DAO 中包含了各种数据库的操作方法。 通过它的方法 , 结合 PO 对数据库进行相关的操作。 夹在业务逻辑与数据库资源中间。 配合 VO, 提供数据库的 CRUD 操作.</p>
</li>
</ol>
<h3 id="3、代码实现，使用vo对象"><a href="#3、代码实现，使用vo对象" class="headerlink" title="3、代码实现，使用vo对象"></a>3、代码实现，使用vo对象</h3><ul>
<li><strong>请求：</strong>Request URL:<code>/product/attr/save</code></li>
<li>请求参数：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;attrGroupId&quot;</span>: <span class="number">0</span>, <span class="comment">//属性分组id</span></span><br><span class="line">  <span class="string">&quot;attrName&quot;</span>: <span class="string">&quot;string&quot;</span>,<span class="comment">//属性名</span></span><br><span class="line">  <span class="string">&quot;attrType&quot;</span>: <span class="number">0</span>, <span class="comment">//属性类型</span></span><br><span class="line">  <span class="string">&quot;catelogId&quot;</span>: <span class="number">0</span>, <span class="comment">//分类id</span></span><br><span class="line">  <span class="string">&quot;enable&quot;</span>: <span class="number">0</span>, <span class="comment">//是否可用 </span></span><br><span class="line">  <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="comment">//图标</span></span><br><span class="line">  <span class="string">&quot;searchType&quot;</span>: <span class="number">0</span>, <span class="comment">//是否检索</span></span><br><span class="line">  <span class="string">&quot;showDesc&quot;</span>: <span class="number">0</span>, <span class="comment">//快速展示</span></span><br><span class="line">  <span class="string">&quot;valueSelect&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="comment">//可选值列表</span></span><br><span class="line">  <span class="string">&quot;valueType&quot;</span>: <span class="number">0</span> <span class="comment">//可选值模式</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>vo：</strong>当有新增字段时，我们往往会在entity实体类中新建一个字段，并标注数据库中不存在该字段，然而这种方式并不规范。比较规范的做法是，新建一个vo文件夹，将每种不同的对象，按照它的功能进行了划分。</li>
</ul>
<p><strong>1）创建Vo</strong></p>
<blockquote>
<p><strong>使用vo的原因是：</strong>接收表单的attrGroupId，即属性分组id，进行关联。</p>
</blockquote>
<p>在product模块的product.vo包下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrVo</span> <span class="keyword">extends</span> <span class="title class_">AttrEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2）AttrController修改保存方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AttrVo attr)</span>&#123;</span><br><span class="line">attrService.saveAttr(attr);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>3）AttrServiceImpl</strong></p>
<blockquote>
<p>pms_attr_attrgroup_relation表：记录属性和属性分组的关联关系</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/da67325cc05a4a18ad23c8de48eadce2.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">    <span class="comment">//AttrEntity attrEntity = new AttrEntity();</span></span><br><span class="line">    <span class="comment">//保存attrEntity</span></span><br><span class="line">    <span class="comment">//利用attr的属性给attrEntity的属性赋值，前提是他们俩的属性名一直</span></span><br><span class="line">    <span class="comment">//BeanUtils.copyProperties(attr, attrEntity);</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">//1、保存基本数据</span></span><br><span class="line">    <span class="built_in">this</span>.save(attr);</span><br><span class="line">    <span class="comment">//2、保存关联关系</span></span><br><span class="line">    <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">    relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">    relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line">    attrAttrgroupRelationDao.insert(relationEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h3><h2 id="2、分页查询属性（规格参数），AttrRespVo封装响应数据"><a href="#2、分页查询属性（规格参数），AttrRespVo封装响应数据" class="headerlink" title="2、分页查询属性（规格参数），AttrRespVo封装响应数据"></a>2、分页查询属性（规格参数），AttrRespVo封装响应数据</h2><h3 id="0、需求分析"><a href="#0、需求分析" class="headerlink" title="0、需求分析"></a>0、需求分析</h3><p><strong>请求：</strong><code>/product/attr/base/list/&#123;catelogId&#125;</code> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/21a97dbd45af4652a3790e6d5e123fe7.png" alt="img"></p>
<p><strong>分析：</strong>修改请求路径后直接查询，我们可以发现，响应参数<strong>“所属分类”和“所属分组”</strong>是空白，所以还要一个<strong>新的vo类</strong>，加入这两个属性。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/e914bc3b293c45cebeb13632102897d6.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">catelogId为0时是查询所有。</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>响应参数比AttrVo多了“所属分类”和“所属分组”，所以还要一个新的vo类</p>
<h3 id="1、修改前端单多选bug"><a href="#1、修改前端单多选bug" class="headerlink" title="1、修改前端单多选bug"></a>1、修改前端单多选bug</h3><p>这是一个坑点，课程视频里和源码里都没有解决。</p>
<p><strong>解决：</strong>将baseattr.vue和attr-add-or-update.vue里的全部<strong>valueType</strong>改成<strong>searchType</strong>，此时值类型正常显示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/588a98bdbbdb4a4aa97b9af5f2a3defa.png" alt="img"></p>
<h3 id="2、代码实现"><a href="#2、代码实现" class="headerlink" title="2、代码实现"></a>2、代码实现</h3><p><strong>1、请求：</strong><code>/product/attr/base/list/&#123;catelogId&#125;</code> </p>
<p>2、新建AttrRespVo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrRespVo</span> <span class="keyword">extends</span> <span class="title class_">AttrVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、AttrController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/base/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">baseList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params, <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.queryBaseAttrPage(params, catelogId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、AttrServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageUtils <span class="title function_">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> &#123;</span><br><span class="line">        <span class="comment">// 查询规格参数</span></span><br><span class="line">        LambdaQueryWrapper&lt;AttrEntity&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">            lqw.eq(AttrEntity::getCatelogId, catelogId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(key)) &#123;</span><br><span class="line">            <span class="comment">// attr_id  attr_name</span></span><br><span class="line">            lqw.and(item -&gt; item.eq(AttrEntity::getAttrId, key)</span><br><span class="line">                    .or()</span><br><span class="line">                    .like(AttrEntity::getAttrName, key));</span><br><span class="line">        &#125;</span><br><span class="line">        IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">                lqw</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 封装分页数据</span></span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">        <span class="comment">// 分页数据中加入当前属性的“所属分类”和“所属分组”</span></span><br><span class="line">        List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">        List&lt;AttrRespVo&gt; attrRespVos = records.stream().map(attrEntity -&gt; &#123;</span><br><span class="line">            <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line">            <span class="comment">// 获取分类信息</span></span><br><span class="line">            <span class="type">CategoryEntity</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getOne(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;CategoryEntity&gt;()</span><br><span class="line">                            .eq(CategoryEntity::getCatId, attrEntity.getCatelogId())</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                attrRespVo.setCatelogName(category.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取属性分组信息、从属性与属性分组关联表查</span></span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrgroupRelation</span> <span class="operator">=</span> attrAttrgroupRelationService.getOne(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">                            .eq(AttrAttrgroupRelationEntity::getAttrId, attrEntity.getAttrId())</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (attrgroupRelation != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 从属性分组表获取分组名称</span></span><br><span class="line">                <span class="type">AttrGroupEntity</span> <span class="variable">attrGroup</span> <span class="operator">=</span> attrGroupService.getOne(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrGroupEntity&gt;()</span><br><span class="line">                                .eq(AttrGroupEntity::getAttrGroupId, attrgroupRelation.getAttrGroupId())</span><br><span class="line">                );</span><br><span class="line">                attrRespVo.setGroupName(attrGroup.getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> attrRespVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        pageUtils.setList(attrRespVos);</span><br><span class="line">        <span class="keyword">return</span> pageUtils;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h3><p>各信息正常显示，点击分类、查询参数名都有效：</p>
<h2 id="3、查询属性详情（修改时回显所属分类路径和分组id）"><a href="#3、查询属性详情（修改时回显所属分类路径和分组id）" class="headerlink" title="3、查询属性详情（修改时回显所属分类路径和分组id）"></a>3、查询属性详情（修改时回显所属分类路径和分组id）</h2><p>1、url地址：<code>/product/attr/info/&#123;attrId&#125;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/4e6dae39841643038e68b29dbd28d539.png" alt="img"></p>
<p>2、修改AttrRespVo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrRespVo</span> <span class="keyword">extends</span> <span class="title class_">AttrVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="keyword">private</span> Long[] catelogPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、AttrController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span>&#123;</span><br><span class="line"><span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> attrService.getAttrInfo(attrId);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, attrRespVo);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>4、AttrServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> AttrRespVo <span class="title function_">getAttrInfo</span><span class="params">(Long attrId)</span> &#123;</span><br><span class="line">       <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">       <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(attrId);</span><br><span class="line">       BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//设置所属分组</span></span><br><span class="line">       <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrAttrgroupRelation</span> <span class="operator">=</span> attrAttrgroupRelationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrId));</span><br><span class="line">       <span class="keyword">if</span> (attrAttrgroupRelation != <span class="literal">null</span>)&#123;</span><br><span class="line">           attrRespVo.setAttrGroupId(attrAttrgroupRelation.getAttrGroupId());</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//设置所属分类路径</span></span><br><span class="line">       Long[] catelogPath = categoryService.findCatelogPath(attrEntity.getCatelogId());</span><br><span class="line">       attrRespVo.setCatelogPath(catelogPath);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> attrRespVo;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514231644796.png" alt="image-20230514231644796"></p>
<h2 id="4、修改属性名时，同步修改属性和属性分组的关联关系"><a href="#4、修改属性名时，同步修改属性和属性分组的关联关系" class="headerlink" title="4、修改属性名时，同步修改属性和属性分组的关联关系"></a>4、修改属性名时，同步修改属性和属性分组的关联关系</h2><p>1、url:<code>/product/attr/update</code></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST	/product/attr/update</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230514234053231.png" alt="image-20230514234053231"></p>
<p>2、AttrController</p>
<p>使用AttrVo，需要attrId（已有）和attrGroupId修改关联关系	</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> AttrVo attr)</span>&#123;</span><br><span class="line">attrService.updateAttr(attr);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>3、AttrServiceImpl</p>
<p><strong>坑点：</strong></p>
<p><strong>1.一些属性在新增时没有设置所属分组。</strong></p>
<p>因此，同步修改属性和属性分组的关联关系时，要判断此属性是否已关联，<strong>未关联时新增关联表数据，已关联时修改关联表数据。</strong></p>
<p><strong>2.修改时如果用QueryWrapper要加条件，防止全部修改。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//保存时，要修改两张表，要加业务注解，引导类也开启了业务</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">       <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line">       BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">       <span class="built_in">this</span>.updateById(attrEntity);</span><br><span class="line"></span><br><span class="line">       <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">       relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">       relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//判断是新增还是删除。属性分组和属性是一对多，也可以用selectOne查</span></span><br><span class="line">       <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> attrAttrgroupRelationDao.selectCount(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">       <span class="keyword">if</span> (count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">           attrAttrgroupRelationDao.update(relationEntity, <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           attrAttrgroupRelationDao.insert(relationEntity);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>测试后成功。 </p>
<h2 id="5、用路径参数区分销售属性和规格参数"><a href="#5、用路径参数区分销售属性和规格参数" class="headerlink" title="5、用路径参数区分销售属性和规格参数"></a>5、用路径参数区分销售属性和规格参数</h2><h3 id="0、“销售属性、规格参数、属性分组”效果展示"><a href="#0、“销售属性、规格参数、属性分组”效果展示" class="headerlink" title="0、“销售属性、规格参数、属性分组”效果展示"></a>0、“销售属性、规格参数、属性分组”效果展示</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516235404996.png" alt="image-20230516235404996"></p>
<p><strong>开启快速展示的规格参数：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/6b19583115cb4814aaca6b21fa8e5d0f-1684252383227-13.png" alt="img"></p>
<p><strong>属性分组和规格参数：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/ef178987bb0648bdbeb05fab62838b33-1684252389648-16.png" alt="img"></p>
<p><strong>“平台属性”后台最终效果：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/b1e66551119c48eda40dde3e193e740e-1684252406321-19.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/ccf5e848492b47d1b6b0589643b92075-1684252406321-21.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/d1b595422c0e4db383e331ffbfd52539-1684252406321-23.png" alt="img"></p>
<h3 id="1、修改分页查询属性的controller和service"><a href="#1、修改分页查询属性的controller和service" class="headerlink" title=".1、修改分页查询属性的controller和service"></a>.1、修改分页查询属性的controller和service</h3><p><strong>1、请求：</strong><code>/product/attr/sale/list/&#123;catelogId&#125;</code></p>
<p><strong>2、实现：</strong></p>
<blockquote>
<p><strong>思路：</strong></p>
<p>可以通过添加<strong>路径变量<code>&#123;attrType&#125;</code><strong>同时用一个方法查询销售属性和规格参数。并且attr表的</strong>attr_type字段</strong>是属性类型**[0-销售属性，1-基本属性]，新增时只能选择0和1**。</p>
</blockquote>
<p>修改AttrController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/&#123;attrType&#125;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//路径参数和形参名同名时，@PathVariable的值可以省略。</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">baseList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params, <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId,</span></span><br><span class="line"><span class="params">                      <span class="meta">@PathVariable(&quot;attrType&quot;)</span> String attrType)</span>&#123;</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.queryBaseAttrPage(params, catelogId, attrType);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrServiceImpl</p>
<blockquote>
<p><strong>注意：</strong> 仅查询规格参数时设置分组名，销售属性无分组。在设置分组id时，要判断查到分组是不是null，防止空指针异常。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params,Long catelogId,String attrType)</span> &#123;</span><br><span class="line">    <span class="comment">//模糊查询</span></span><br><span class="line"> </span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    LambdaQueryWrapper&lt;AttrEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//值添加这一行。判断是规格参数还是销售属性,[0-销售属性，1-基本属性，2-既是销售属性又是基本属性]</span></span><br><span class="line">    wrapper.eq(AttrEntity::getAttrType,<span class="string">&quot;base&quot;</span>.equalsIgnoreCase(attrType)?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotEmpty(key))&#123;</span><br><span class="line">        wrapper.and(obj-&gt;obj.eq(AttrEntity::getAttrId,key).or().like(AttrEntity::getAttrName,key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//catelogId查询</span></span><br><span class="line">    <span class="keyword">if</span>(catelogId!=<span class="number">0</span>) wrapper.eq(AttrEntity::getCatelogId,catelogId);</span><br><span class="line">        <span class="comment">//查询</span></span><br><span class="line">    IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    <span class="comment">//分页数据中加入当前属性的“所属分类”和“所属分组”</span></span><br><span class="line">    List&lt;AttrEntity&gt; attrEntities = page.getRecords();</span><br><span class="line">    List&lt;AttrRespVo&gt; attrRespVos = attrEntities.stream().map(item-&gt;&#123;</span><br><span class="line">        <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(item,attrRespVo);</span><br><span class="line">        <span class="comment">//查询“所属分类”和“所属分组”的name</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">catelogId2</span> <span class="operator">=</span> attrRespVo.getCatelogId();</span><br><span class="line">        Long attrGroupId=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrAttrgroupRelationEntity</span> <span class="operator">=</span> attrAttrgroupRelationDao.selectOne(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(AttrAttrgroupRelationEntity::getAttrId,attrRespVo.getAttrId())</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(attrAttrgroupRelationEntity!=<span class="literal">null</span>) attrGroupId = attrAttrgroupRelationEntity.getAttrGroupId();</span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(catelogId2);</span><br><span class="line">        <span class="comment">//没查到的对象就不能getName了，必须防止空指针异常，习惯习惯，坑点</span></span><br><span class="line">        <span class="keyword">if</span>(categoryEntity!=<span class="literal">null</span>) attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrGroupId);</span><br><span class="line">        <span class="keyword">if</span>(attrGroupEntity!=<span class="literal">null</span>) attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">        <span class="keyword">return</span> attrRespVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    pageUtils.setList(attrRespVos);</span><br><span class="line">    <span class="comment">//返回分页工具对象</span></span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、-新增测试"><a href="#2、-新增测试" class="headerlink" title="2、 新增测试"></a>2、 新增测试</h3><p>新增销售属性，销售属性不设置属性分组 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/09161b06c59f4b8cb47243d2bdfe2060.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/84d8c60182c946f08c6a11fd1eb77bae.png" alt="img"></p>
<h3 id="3、创建商品常量类"><a href="#3、创建商品常量类" class="headerlink" title="3、创建商品常量类"></a>3、创建商品常量类</h3><p><strong>1. 新建商品服务常量类</strong></p>
<p>在Common模块中<strong>新建商品服务常量类</strong>common.constant.ProductConstant</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductConstant</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AttrEnum</span>&#123;</span><br><span class="line">        ATTR_TYPE_BASE(<span class="number">1</span>,<span class="string">&quot;基本属性&quot;</span>), ATTR_TYPE_SALE(<span class="number">0</span>,<span class="string">&quot;销售属性&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line"> </span><br><span class="line">        AttrEnum(<span class="type">int</span> code, String msg)&#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.修改数字成枚举</strong> </p>
<p>把前面对attr_type字段的判断，由0和1改成枚举。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">wrapper.eq(AttrEntity::getAttrType,<span class="string">&quot;base&quot;</span>.equalsIgnoreCase(attrType)? ProductConstant.AttrEnum.ATTR_TYPE_BASE :ProductConstant.AttrEnum.ATTR_TYPE_SALE);</span><br></pre></td></tr></table></figure>

<h3 id="4、更改新增修改属性的业务，仅操作规格属性时添加关联关系"><a href="#4、更改新增修改属性的业务，仅操作规格属性时添加关联关系" class="headerlink" title="4、更改新增修改属性的业务，仅操作规格属性时添加关联关系"></a>4、更改新增修改属性的业务，仅操作规格属性时添加关联关系</h3><blockquote>
<p><strong>问题分析：</strong></p>
<p>因为新增修改时没有判断销售属性，关联表中多了销售属性的没用数据：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/3a32afbea0c0435a817937add00bba69.png" alt="img"></p>
</blockquote>
<p>当新增&#x2F;修改规格参数时，会在attrAttrGroupRelation表之中新增数据，但是销售属性没有分组信息。所以在新增&#x2F;修改时，进行判断</p>
<p>在<code>saveAttr,getAttrInfo,updateAttr</code>中，设计分组信息之前做判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (attrEntity.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode())<span class="comment">//如果是规格参数，再操作分组信息</span></span><br></pre></td></tr></table></figure>

<p>整体代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存基本规格参数和关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAttr</span><span class="params">(AttrVo attrVo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.save(attrVo);</span><br><span class="line">        <span class="comment">//仅在规格属性的分组有值时，保存属性和属性分组关联关系</span></span><br><span class="line">        <span class="keyword">if</span>(attrVo.getAttrType()==ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode()&amp;&amp;attrVo.getAttrGroupId()!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrAttrgroupRelationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">            attrAttrgroupRelationEntity.setAttrId(attrVo.getAttrId());</span><br><span class="line">            attrAttrgroupRelationEntity.setAttrGroupId(attrVo.getAttrGroupId());</span><br><span class="line">            attrAttrgroupRelationDao.insert(attrAttrgroupRelationEntity);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改属性时，同步修改与属性分组关联关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAttr</span><span class="params">(AttrVo attrVo)</span> &#123;</span><br><span class="line">        <span class="comment">//先修改属性</span></span><br><span class="line">        <span class="built_in">this</span>.updateById(attrVo);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">attrGroupId</span> <span class="operator">=</span> attrVo.getAttrGroupId();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">attrId</span> <span class="operator">=</span> attrVo.getAttrId();</span><br><span class="line">        <span class="comment">//再判断修改关联关系。如果是销售属性或者分组id是空时，不用修改</span></span><br><span class="line">        <span class="keyword">if</span>(attrVo.getAttrType()==ProductConstant.AttrEnum.ATTR_TYPE_SALE.getCode()||attrGroupId==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//todo。待优化，如果是将规格属性改为销售属性，查询删除原关联关系</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查询关联表中是否已有此属性</span></span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrAttrgroupRelationEntity</span> <span class="operator">=</span> attrAttrgroupRelationDao.selectOne(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(AttrAttrgroupRelationEntity::getAttrId, attrId)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(attrAttrgroupRelationEntity!=<span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            已存在，修改</span></span><br><span class="line">            attrAttrgroupRelationEntity.setAttrGroupId(attrGroupId);</span><br><span class="line">            attrAttrgroupRelationDao.updateById(attrAttrgroupRelationEntity);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//不存在，新增关联关系</span></span><br><span class="line">            attrAttrgroupRelationEntity=<span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">            attrAttrgroupRelationEntity.setAttrGroupId(attrGroupId);</span><br><span class="line">            attrAttrgroupRelationEntity.setAttrId(attrId);</span><br><span class="line">            attrAttrgroupRelationDao.insert(attrAttrgroupRelationEntity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="6、注意空指针异常"><a href="#6、注意空指针异常" class="headerlink" title="6、注意空指针异常"></a>6、注意空指针异常</h2><p>一定要养成习惯，一个null值是不能用set和get方法的。</p>
<p>查询单条数据时，不能直接用查到实体类对象的get方法，要先判断此实体类对象是否为空。</p>
<p>空指针异常报错是：null。</p>
<h1 id="商品服务-属性分组的关联功能"><a href="#商品服务-属性分组的关联功能" class="headerlink" title="商品服务-属性分组的关联功能"></a>商品服务-属性分组的关联功能</h1><h2 id="1、最终效果展示"><a href="#1、最终效果展示" class="headerlink" title="1、最终效果展示"></a>1、最终效果展示</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/fdc0821996d94f1b957abc6c66f97e81.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/aa2b43ad741e44c3b7b31010405ac884.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/e03d1a3937c0499696deb61627f52e76.png" alt="img"></p>
<h2 id="2、查询属性分组关联的所有属性"><a href="#2、查询属性分组关联的所有属性" class="headerlink" title="2、查询属性分组关联的所有属性"></a>2、查询属性分组关联的所有属性</h2><p>1、URL：<code>/product/attrgroup/&#123;attrgroupId&#125;/attr/relation</code></p>
<p>attrgroupController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/attr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrRelation</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> Long attrgroupId)</span>&#123;</span><br><span class="line">    List&lt;AttrEntity&gt; data = attrService.getRelationAttr(attrgroupId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <a href="C:\Users\adan\IdeaProjects\glm\glm-product\src\main\java\com\adan\glmproduct\controller\AttrGroupController.java">AttrGroupController.java</a> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询属性分组关联的所有属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;AttrEntity&gt; <span class="title function_">getRelationAttr</span><span class="params">(Long attrgroupId)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据属性分组关联表中获取所有分组信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;AttrAttrgroupRelationEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(AttrAttrgroupRelationEntity::getAttrGroupId, attrgroupId);</span><br><span class="line">        List&lt;AttrAttrgroupRelationEntity&gt; list = attrAttrgroupRelationService.list(wrapper);</span><br><span class="line">        <span class="comment">// 从分组信息关联的属性id</span></span><br><span class="line">        List&lt;Long&gt; attrIds = list.stream().map(AttrAttrgroupRelationEntity::getAttrId).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//根据id查询属性</span></span><br><span class="line">        List&lt;AttrEntity&gt; attrEntities = attrService.listByIds(attrIds);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> attrEntities;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/80227eb4017342e2b62abb043d3f10c1.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/9c03c86fe7dc4d8b951e86fbfeed668d.png" alt="img"></p>
<h2 id="3、批量删除属性与分组的关联关系"><a href="#3、批量删除属性与分组的关联关系" class="headerlink" title="3、批量删除属性与分组的关联关系"></a>3、批量删除属性与分组的关联关系</h2><p><strong>1、请求：</strong><code>/product/attrgroup/attr/relation/delete</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/b2294bd2a67b47f18d7e3ce10df3af77.png" alt="img"></p>
<blockquote>
<p><strong>注意</strong></p>
<ul>
<li>请求方式是post，不是delete</li>
</ul>
</blockquote>
<p>2、在product.vo包下新建AttrGroupRelationVo，接收请求参数</p>
<p>也可以不用vo，用AttrAttrgroupRelationEntites接收参数：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/0482b01f8b724b7491a6821b9c0d3328.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrGroupRelationVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation/delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrRelationDelete</span><span class="params">(<span class="meta">@RequestBody</span> AttrGroupRelationVo[] vos)</span>&#123;</span><br><span class="line">    attrService.deleteRelation(vos);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">attrRelationDelete</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrAttrgroupRelationEntity&gt; vos)</span>&#123;</span><br><span class="line">        attrGroupService.deleteRelation(vos);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>4、AttrServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRelation</span><span class="params">(AttrGroupRelationVo[] vos)</span> &#123;</span><br><span class="line">      List&lt;AttrGroupRelationVo&gt; relationVos = Arrays.asList(vos);</span><br><span class="line">      List&lt;AttrAttrgroupRelationEntity&gt; entities = relationVos.stream().map((relationVo) -&gt; &#123;</span><br><span class="line">          <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">          BeanUtils.copyProperties(relationVo, relationEntity);</span><br><span class="line">          <span class="keyword">return</span> relationEntity;</span><br><span class="line">      &#125;).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//根据attrId，attrGroupId批量删除关联关系</span></span><br><span class="line">      attrAttrgroupRelationDao.deleteBatchRelation(entities);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<p>AttrGroupServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRelation</span><span class="params">(List&lt;AttrAttrgroupRelationEntity&gt; attrAttrgroupRelationEntities)</span> &#123;</span><br><span class="line">        attrAttrgroupRelationEntities.forEach(item -&gt;&#123;</span><br><span class="line">            LambdaQueryWrapper&lt;AttrAttrgroupRelationEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.eq(AttrAttrgroupRelationEntity::getAttrId, item.getAttrId())</span><br><span class="line">                    .eq(AttrAttrgroupRelationEntity::getAttrGroupId, item.getAttrGroupId());</span><br><span class="line">            attrAttrgroupRelationService.remove(wrapper);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>5、AttrAttrgroupRelationDao.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchRelation&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM `pms_attr_attrgroup_relation` WHERE</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;entities&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot; OR &quot;</span>&gt;</span></span><br><span class="line">        (attr_id=#&#123;item.attrId&#125; AND attr_group_id=#&#123;item.attrGroupId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也可以不用xml，用wrapper删除，但时间复杂度和编写复杂度会比动态sql低一些：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRelation</span><span class="params">(List&lt;AttrAttrgroupRelationEntity&gt; attrAttrgroupRelationEntities)</span> &#123;</span><br><span class="line">    <span class="comment">//遍历查删</span></span><br><span class="line">    attrAttrgroupRelationEntities.stream().forEach(item-&gt;&#123;</span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrAttrgroupRelationEntity</span> <span class="operator">=</span> attrAttrgroupRelationDao.selectOne(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(AttrAttrgroupRelationEntity::getAttrId, item.getAttrId()).eq(AttrAttrgroupRelationEntity::getAttrGroupId, item.getAttrGroupId())</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(attrAttrgroupRelationEntity!=<span class="literal">null</span>) attrAttrgroupRelationDao.deleteById(attrAttrgroupRelationEntity.getId());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>回顾：</strong></p>
<p>记不清动态sql和foreach，请参考下文的动态sql和批量删除：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40991313/article/details/125818307">【黑马Java笔记+踩坑】JavaWeb基础3——Maven&amp;MyBatis_vincewm的博客-CSDN博客</a></p>
<p><strong>foreach 标签</strong></p>
<p>用来迭代任何可迭代的对象（如数组，集合）。</p>
<p><strong>collection 属性：</strong>指定遍历的数组</p>
<p>mybatis会将数组参数，封装为一个Map集合。</p>
<p>默认：array &#x3D; 数组，key是array而不是数组名，如collection&#x3D;”array”和void deleteByIds(int[] ids);</p>
<p>可以使用@Param注解改变map集合的默认key的名称为数组名，如collection&#x3D;”ids”和void deleteByIds(@Param(“ids”) int[] ids);</p>
<p>item 属性：本次迭代获取到的元素，如item&#x3D;”id”。</p>
<p>separator 属性：集合项迭代之间的分隔符。foreach 标签不会错误地添加多余的分隔符。也就是最后一次迭代不会加分隔符。如separator&#x3D;”,”</p>
<p>open 属性：该属性值是在拼接SQL语句之前拼接的语句，只会拼接一次。如open&#x3D;”(“</p>
<p>close 属性：该属性值是在拼接SQL语句拼接后拼接的语句，只会拼接一次。如close&#x3D;”)”</p>
<p><strong>测试成功。</strong> </p>
<h2 id="4、新建关联时，查询当前属性分组未关联的属性"><a href="#4、新建关联时，查询当前属性分组未关联的属性" class="headerlink" title="4、新建关联时，查询当前属性分组未关联的属性"></a>4、新建关联时，查询当前属性分组未关联的属性</h2><p>获取属性分组里面还没有关联的<strong>本分类里</strong>面的其他基本属性，方便添加新的关联。 </p>
<p><strong>1、url13：</strong><code>/product/attrgroup/&#123;attrgroupId&#125;/noattr/relation</code></p>
<p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/noattr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrNoRelation</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> Long attrgroupId, <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.getNoRelationAttr(params, attrgroupId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>当前分组展示的未关联属性要求：</strong></p>
<ul>
<li><strong>1.查询当前分组所在分类。</strong>当前分组只能关联自己所属分类里面的所有属性<strong>。</strong>例如“基本属性”分组里展示未关联的“入网型号”等手机分类里的属性。</li>
<li>2.查询此分类下的<strong>。当前分组只能关联同分类下，别的分组没有引用的属性。</strong><ul>
<li>2.1.查询当前分类下的其他属性分组ids</li>
<li>2.2.查询这些分组中已关联的属性ids</li>
<li>2.3.从当前分类的所有属性中排除查询这些分组中已关联的属性list</li>
</ul>
</li>
</ul>
</blockquote>
<p>​		<strong>每个属性和分组都属于某个分类。</strong></p>
<p>AttrGroupServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> PageUtils <span class="title function_">getNoRelationAttr</span><span class="params">(Map&lt;String, Object&gt; params, Long attrgroupId)</span> &#123;</span><br><span class="line">       <span class="comment">//1、当前分组只能关联自己所属分类里面的所有属性</span></span><br><span class="line">       <span class="comment">//先查询出当前分组所属的分类</span></span><br><span class="line">       <span class="type">AttrGroupEntity</span> <span class="variable">attrGroup</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(attrgroupId);</span><br><span class="line">       <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrGroup.getCatelogId();</span><br><span class="line">       <span class="comment">//2、当前分组只能关联别的分组没有引用的属性</span></span><br><span class="line">       <span class="comment">//2.1获取当前分类下的所有分组</span></span><br><span class="line">       List&lt;AttrGroupEntity&gt; attrGroupEntities = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrGroupEntity&gt;()</span><br><span class="line">               .eq(AttrGroupEntity::getCatelogId, catelogId));</span><br><span class="line">       List&lt;Long&gt; groupIds = attrGroupEntities.stream().map(AttrGroupEntity::getAttrGroupId).collect(Collectors.toList());</span><br><span class="line">       <span class="comment">//2.2获取这些分组关联的属性</span></span><br><span class="line">       List&lt;AttrAttrgroupRelationEntity&gt; attrAttrgroupRelationEntities = attrAttrgroupRelationService.list(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">               .in(AttrAttrgroupRelationEntity::getAttrGroupId, groupIds));</span><br><span class="line">       List&lt;Long&gt; attrIds = attrAttrgroupRelationEntities.stream().map(AttrAttrgroupRelationEntity::getAttrId).collect(Collectors.toList());</span><br><span class="line">       <span class="comment">// 2.3从当前分类的所有属性中移除这些属性</span></span><br><span class="line">       LambdaQueryWrapper&lt;AttrEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrEntity&gt;()</span><br><span class="line">               .eq(AttrEntity::getCatelogId, catelogId)</span><br><span class="line">               .eq(AttrEntity::getAttrType, ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode());</span><br><span class="line">       <span class="keyword">if</span> (!CollectionUtils.isEmpty(attrIds))&#123;</span><br><span class="line">           wrapper.notIn(AttrEntity::getAttrId, attrIds);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//模糊查询</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isNotEmpty(key))&#123;</span><br><span class="line">           wrapper.eq(AttrEntity::getAttrId, key).or().like(AttrEntity::getAttrName, key);</span><br><span class="line">       &#125;</span><br><span class="line">       IPage&lt;AttrEntity&gt; page = attrService.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params), wrapper);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>坑点：</strong></p>
<p>2.3从当前分类的所有属性中移除这些属性时，wrapper的notIn里的list不能是空，要判断一下，防止空指针异常。</p>
<p><strong>测试：</strong></p>
<p>点击“属性分组”菜单 -“关联”-“新建关联”：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/2a9d6973247c4c0a9740f56c48f02e0b.png" alt="img"></p>
<h2 id="5、保存新增的关联"><a href="#5、保存新增的关联" class="headerlink" title="5、保存新增的关联"></a>5、保存新增的关联</h2><p>1、url11：<code>/product/attrgroup/attr/relation</code></p>
<p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrRelation</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrGroupRelationVo&gt; vos)</span>&#123;</span><br><span class="line">    relationService.saveBatch(vos);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrAttrgroupRelationServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveBatch</span><span class="params">(List&lt;AttrGroupRelationVo&gt; vos)</span> &#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; entities = vos.stream().map((vo) -&gt; &#123;</span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">        BeanUtils.copyProperties(vo, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="built_in">this</span>.saveBatch(entities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>或者用我的方法</strong>，用List<AttrAttrgroupRelationEntity>接收参数，不用vo和重写service方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrRelation</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrAttrgroupRelationEntity&gt; attrAttrgroupRelationEntities)</span>&#123;</span><br><span class="line">    attrAttrgroupRelationService.saveBatch(attrAttrgroupRelationEntities);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试成功。 </p>
<h1 id="商品服务-新增商品"><a href="#商品服务-新增商品" class="headerlink" title="商品服务-新增商品"></a>商品服务-新增商品</h1><h2 id="1、配置、启动会员模块"><a href="#1、配置、启动会员模块" class="headerlink" title="1、配置、启动会员模块"></a>1、配置、启动会员模块</h2><p>进入“发布商品”页面会发获取会员等级的请求，所以第一步要先配置、启动会员模块。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/09d1609993a345569b9905a3d7ad5ec0.png" alt="img"></p>
<h3 id="1、用户模块添加到nacos注册中心"><a href="#1、用户模块添加到nacos注册中心" class="headerlink" title="1、用户模块添加到nacos注册中心"></a><strong>1、用户模块添加到nacos注册中心</strong></h3><p>修改gulimall-member配置文件，将用户模块添加到服务[注册中心]，然后启动gulimall-member服务 </p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">application</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">glm-member</span></span><br><span class="line">  <span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">nacos</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">server-addr</span>: <span class="string">127.0.0.1:8848</span></span><br><span class="line">      <span class="attr">discovery</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">namespace</span>: <span class="string">7037a071-581e-4c47-9319-9daccf89571d</span></span><br><span class="line">        <span class="attr">group</span>: <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">      <span class="attr">config</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">file-extension</span>: <span class="string">yaml</span></span><br><span class="line">        <span class="attr">namespace</span>: <span class="string">7161923d-ca04-4d41-a1bf-30d8ef49a9cd</span></span><br><span class="line">        <span class="attr">group</span>: <span class="string">$&#123;spring.profiles.active&#125;</span></span><br><span class="line">        <span class="attr">refresh-enabled</span>: <span class="string">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">profiles</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">active</span>: <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>nacos配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230515124239110.png" alt="image-20230515124239110"></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/gulimall_ums?userUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#数据库下划线和实体类驼峰统一</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 控制台输出sql语句</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">    <span class="attr">banner:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment">#告诉mp，sql映射文件的位置，默认值classpath*:/mapper/**/*.xml。</span></span><br><span class="line">  <span class="comment">#  classpath表示只引用现在模块的类路径。lasspath*表示不止引用现在模块的类路径，还包括依赖jar包的类路径</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure>

<p>启动成功： </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230515124438180.png" alt="image-20230515124438180"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230515124508933.png" alt="image-20230515124508933"></p>
<p>“获取所有会员等级”功能，在逆向工程时已经自动生成了。url:<code>/member/memberlevel/list</code></p>
<h3 id="2、配置网关路由"><a href="#2、配置网关路由" class="headerlink" title="2、配置网关路由"></a>2、配置网关路由</h3><p>网关模块修改yml，用户路由（&#x2F;api&#x2F;member&#x2F;**）要放到人人管理后台路由（&#x2F;api&#x2F;**）前面，因为路由路径更具体。</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#用户模块路由</span></span><br><span class="line">       <span class="attr">-</span> <span class="string">id: member_route</span></span><br><span class="line">         <span class="attr">uri</span>: <span class="string">lb://glm-member</span></span><br><span class="line">         <span class="attr">predicates</span>: <span class="string"></span></span><br><span class="line">           <span class="attr">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">         <span class="attr">filters</span>:<span class="string"></span></span><br><span class="line"><span class="comment">         #  /api/member/**重写成/glmmenber/**</span></span><br><span class="line">           <span class="attr">-</span> <span class="string">RewritePath=/api/member/(?&lt;segment&gt;/?.*),/glmmember/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<p>当前网关模块的yml： </p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">port</span>: <span class="string">88</span></span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">gateway</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">routes</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: baidu-route              # 每一个路由的名字，唯一即可</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">https://www.baidu.com   # 匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Query=url,baidu         #如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: qq_route                  # 每一个路由的名字，唯一即可</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">https://www.qq.com   # 匹配后提供服务的路由地址</span></span><br><span class="line">          <span class="attr">predicates</span>: <span class="string"># 断言规则</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Query=url,qq         #如果url参数等于baidu 符合断言，转到uri</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        # 精确的路由要放在/api的admin_route上面</span></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: product-route</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">lb://glm-product</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">          <span class="attr">filters</span>:  <span class="string">#局部过滤器</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;  #重写路径，/api/xx过滤成/xx</span></span><br><span class="line">            </span><br><span class="line">        <span class="attr">-</span> <span class="string">id: third_party_route</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">lb://glm-third-party</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Path=/api/thirdparty/**</span></span><br><span class="line">          <span class="attr">filters</span>:<span class="string"></span></span><br><span class="line"><span class="comment">          #  http://localhost:88/api/thirdparty/oss/policy---&gt;http://localhost:30000/oss/policy</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">RewritePath=/api/thirdparty/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;  </span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        #用户模块路由</span></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: member_route</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">lb://glm-member</span></span><br><span class="line">          <span class="attr">predicates</span>: <span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">          <span class="attr">filters</span>:<span class="string"></span></span><br><span class="line"><span class="comment">          #  /api/member/**重写成/glmmenber/**</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">RewritePath=/api/member/(?&lt;segment&gt;/?.*),/glmmember/$\&#123;segment&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">-</span> <span class="string">id: admin-route</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="string">lb://renren-fast    # uri路由的目标地址。lb就是负载均衡，后面跟服务名称。</span></span><br><span class="line"><span class="comment">          #断言工厂的Path，请求路径必须符合指定规则</span></span><br><span class="line">          <span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">-</span> <span class="string">Path=/api/**    # 把所有api开头的请求都转发给renren-fast</span></span><br><span class="line">          <span class="attr">filters</span>:  <span class="string">#局部过滤器。回顾默认过滤器default-filters是与routes同级</span></span><br><span class="line">            <span class="attr">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*), /renren-fast/$\&#123;segment&#125;</span></span><br><span class="line"><span class="comment">            #路径重写。逗号左边是原路径，右边是重写后的路径</span></span><br><span class="line"><span class="comment">          # 默认规则， 请求过来：http://localhost:88/api/captcha.jpg   转发--&gt;  http://renren-fast:8080/renren-fast/captcha.jpg</span></span><br><span class="line"><span class="comment">        # oss等第三方模块路由</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重启网关模块，发现“会员列表”和“会员等级”请求已经不报错404： </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230515125257887.png" alt="image-20230515125257887"></p>
<h3 id="3、添加“会员等级”数据"><a href="#3、添加“会员等级”数据" class="headerlink" title="3、添加“会员等级”数据"></a>3、添加“会员等级”数据</h3><p>点击 用户系统-会员等级 </p>
<p>添加一些数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230515125542277.png" alt="image-20230515125542277"></p>
<p>然后进入“发布商品”页面，就不用请求会员等级报错：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/4ad46827e113466db4711b523f730c26.png" alt="img"></p>
<h2 id="2、获取当前分类关联的品牌（不用分页）"><a href="#2、获取当前分类关联的品牌（不用分页）" class="headerlink" title="2、获取当前分类关联的品牌（不用分页）"></a>2、获取当前分类关联的品牌（不用分页）</h2><h3 id="1、分析"><a href="#1、分析" class="headerlink" title="1、分析"></a>1、分析</h3><p><strong>需求：</strong>发布商品时，选择分类后，会发请求获取当前分类关联的品牌，所以需要编写这个业务，下面是完成后的效果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/4f5bd453e8db40cdb9ece8a724761e94.png" alt="img"></p>
<p><strong>请求14：</strong><code>/product/categorybrandrelation/brands/list</code></p>
<ul>
<li>新增商品时，点击商品的分类，要获取与该分类关联的所有品牌id和name</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/5180246009114d32b7fa72184ac379b3.png" alt="img"></p>
<h3 id="2、新建BrandVo"><a href="#2、新建BrandVo" class="headerlink" title="2、新建BrandVo"></a><strong>2、新建BrandVo</strong></h3><p><strong>因为只需要品牌id和name，也可以不新建vo</strong>，使用CategoryBrandRelationEntity响应数据：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/06ca525335924d8a866c4d3f4830748c.png" alt="img"></p>
<p>CategoryBrandRelationController中一步到位：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前分类关联的所有品牌id和name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/brands/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">relationBrandsList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;catId&quot;,required = true)</span> Long catId)</span>&#123;</span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; categoryBrandRelationEntities = categoryBrandRelationService.list(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(CategoryBrandRelationEntity::getCatelogId, catId)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,categoryBrandRelationEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandVo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、代码实现"><a href="#3、代码实现" class="headerlink" title="3、代码实现"></a>3、代码实现</h3><p>CategoryBrandRelationController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取当前分类关联的所有品牌</span></span><br><span class="line"><span class="comment">     * 1、 Controller: 处理请求，接受和校验数据</span></span><br><span class="line"><span class="comment">     * 2、Service接受controller传来的数据，进行业务处理</span></span><br><span class="line"><span class="comment">     * 3、Controller接受Service处理完的数据，封装成页面指定的vo</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/brands/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">relationBrandsList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;catId&quot;, required = true)</span> Long catId)</span>&#123;</span><br><span class="line">        List&lt;BrandEntity&gt; vos = categoryBrandRelationService.getBrandsByCatId(catId);</span><br><span class="line"><span class="comment">//遍历拷贝vos到brandVo</span></span><br><span class="line">        List&lt;BrandVo&gt; collect = vos.stream().map(item -&gt; &#123;</span><br><span class="line">            <span class="type">BrandVo</span> <span class="variable">brandVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandVo</span>();</span><br><span class="line">            brandVo.setBrandId(item.getBrandId());</span><br><span class="line">            brandVo.setBrandName(item.getName());</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> brandVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, collect);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">BrandService brandService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;BrandEntity&gt; <span class="title function_">getBrandsByCatId</span><span class="params">(Long catId)</span> &#123;</span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; catelogId = <span class="built_in">this</span>.baseMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catId));</span><br><span class="line">    List&lt;BrandEntity&gt; collect = catelogId.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">brandId</span> <span class="operator">=</span> item.getBrandId();</span><br><span class="line">        <span class="type">BrandEntity</span> <span class="variable">byId</span> <span class="operator">=</span> brandService.getById(brandId);</span><br><span class="line">        <span class="keyword">return</span> byId;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果报错：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/2e7020220ebe45c9851aa82109075b12.png" alt="img"></p>
<p>就把brandService.getById改成brandDao.selectById </p>
<p> <strong>也可以不新建vo</strong>，使用CategoryBrandRelationEntity响应数据：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/06ca525335924d8a866c4d3f4830748c-1684128573835-13.png" alt="img"></p>
<p>CategoryBrandRelationController中一步到位：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前分类关联的所有品牌id和name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/brands/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">relationBrandsList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;catId&quot;,required = true)</span> Long catId)</span>&#123;</span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; categoryBrandRelationEntities = categoryBrandRelationService.list(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(CategoryBrandRelationEntity::getCatelogId, catId)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,categoryBrandRelationEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="bug"><a href="#bug" class="headerlink" title="bug"></a><strong>bug</strong></h3><p>控制台报错：</p>
<p><strong>PubSub is not defined</strong>   </p>
<p>解决方式：</p>
<p>安装依赖</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cnpm install --save pubsub-js</span><br></pre></td></tr></table></figure>

<p>在所需要的组件import引入依赖或者在main.js全局引入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">PubSub</span> <span class="keyword">from</span> <span class="string">&quot;pubsub-js&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>报TypeError: Cannot read property ‘publish’ of undefined”错误的可以去对应的文件里面删除PubSub前面删除this</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516153414211.png" alt="image-20230516153414211"></p>
<p>报TypeError: Cannot read property ‘publish’ of undefined”错误的可以去对应的文件里面删除PubSub前面删除this</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516153828991.png" alt="image-20230516153828991"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516154042770.png" alt="image-20230516154042770"></p>
<h3 id="4、测试-1"><a href="#4、测试-1" class="headerlink" title="4、测试"></a>4、测试</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516154113841.png" alt="image-20230516154113841"></p>
<h2 id="3、获取当前分类下的分组及其关联的属性"><a href="#3、获取当前分类下的分组及其关联的属性" class="headerlink" title="3、获取当前分类下的分组及其关联的属性"></a>3、获取当前分类下的分组及其关联的属性</h2><h3 id="1、分析-1"><a href="#1、分析-1" class="headerlink" title="1、分析"></a>1、分析</h3><p><strong>需求：</strong>录入规格参数时要获取当前分类下所有分组和关联属性，进行选择分组、规格参数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516154615684.png" alt="image-20230516154615684"></p>
<p><strong>无法上传图片问题</strong></p>
<p>如果在填写基本信息时候无法上传图片，开启第三方模块。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/0e0536059c4c40278d01ccdc517a47b4.png" alt="img"></p>
<p>检测bucket域名，参考下文7.3.10修改前端，替换成自己的<strong>Bucket域名</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516154747196.png" alt="image-20230516154747196"></p>
<p><strong>请求17：</strong><code>/product/attrgroup/&#123;catelogId&#125;/withattr</code></p>
<p><strong>响应数据：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/e18fe5fa00d4455f8baf945a2beee4bc.png" alt="img"></p>
<h3 id="2、代码实现-1"><a href="#2、代码实现-1" class="headerlink" title="2、代码实现"></a>2、代码实现</h3><p>新建AttrGroupWithAttrsVo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrGroupWithAttrsVo</span> <span class="keyword">extends</span> <span class="title class_">AttrGroupEntity</span> &#123;</span><br><span class="line">     <span class="keyword">private</span> List&lt;AttrVo&gt; attrs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;catelogId&#125;/withattr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getAttrGroupWithAttrs</span><span class="params">(<span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span> &#123;</span><br><span class="line">    <span class="comment">//1、查出当前分类下的所有属性分组</span></span><br><span class="line">    <span class="comment">//2、查出每个属性分组的所有属性</span></span><br><span class="line">    List&lt;AttrGroupWithAttrsVo&gt; vos = attrGroupService.getAttrGroupAndAttrsByCatelogId(catelogId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, vos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupServiceImpl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;AttrGroupWithAttrsVo&gt; <span class="title function_">getAttrGroupAndAttrsByCatelogId</span><span class="params">(Long catelogId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询此分类下所有分组</span></span><br><span class="line">        LambdaQueryWrapper&lt;AttrGroupEntity&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(AttrGroupEntity::getCatelogId, catelogId);</span><br><span class="line">        List&lt;AttrGroupEntity&gt; attrGroupEntities = <span class="built_in">this</span>.list(lqw);</span><br><span class="line">        <span class="comment">//每个分组查询规格属性</span></span><br><span class="line">        List&lt;AttrGroupWithAttrsVo&gt; list = attrGroupEntities.stream().map(item -&gt; &#123;</span><br><span class="line">            <span class="type">AttrGroupWithAttrsVo</span> <span class="variable">attrsVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrGroupWithAttrsVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(item, attrsVo);</span><br><span class="line">            <span class="comment">//在关联表里查询此分组的规格属性</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">groupId</span> <span class="operator">=</span> item.getAttrGroupId();</span><br><span class="line">            <span class="comment">//获取分组关联的属性list</span></span><br><span class="line">            attrsVo.setAttrs(attrService.getAttrWithGroupId(groupId));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> attrsVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> <a href="C:\Users\adan\IdeaProjects\glm\glm-product\src\main\java\com\adan\glmproduct\service\impl\AttrServiceImpl.java">AttrServiceImpl.java</a> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Override</span><br><span class="line">    <span class="keyword">public</span> List&lt;AttrVo&gt; <span class="title function_">getAttrWithGroupId</span><span class="params">(Long groupId)</span> &#123;</span><br><span class="line">        <span class="comment">//从属性和属性组关系表中获取属性id</span></span><br><span class="line">        LambdaQueryWrapper&lt;AttrAttrgroupRelationEntity&gt; eq = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">                .eq(AttrAttrgroupRelationEntity::getAttrGroupId, groupId);</span><br><span class="line">        List&lt;AttrAttrgroupRelationEntity&gt; attrgroupRelation = attrAttrgroupRelationService.list(eq);</span><br><span class="line">        List&lt;AttrVo&gt; attrVos = attrgroupRelation.stream().map(item -&gt; &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">attrId</span> <span class="operator">=</span> item.getAttrId();</span><br><span class="line">            <span class="comment">//根据属性id查询属性表</span></span><br><span class="line">            <span class="type">AttrEntity</span> <span class="variable">attr</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(attrId);</span><br><span class="line">            <span class="comment">//封装返回结果</span></span><br><span class="line">            <span class="type">AttrVo</span> <span class="variable">attrVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(attr, attrVo);</span><br><span class="line">            attrVo.setAttrGroupId(groupId);</span><br><span class="line">            <span class="keyword">return</span> attrVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> attrVos;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>启动测试：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516171002701.png" alt="image-20230516171002701"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/image-20230516171202300.png" alt="image-20230516171202300"></p>
<h2 id="4、新增商品"><a href="#4、新增商品" class="headerlink" title="4、新增商品"></a>4、新增商品</h2><h3 id="1、分析-2"><a href="#1、分析-2" class="headerlink" title="1、分析"></a>1、分析</h3><p>url：<code>/product/spuinfo/save</code></p>
<h3 id="2、填写表单"><a href="#2、填写表单" class="headerlink" title="2、填写表单"></a>2、填写表单</h3><p>参考商品：<a target="_blank" rel="noopener" href="https://item.jd.com/100038004389.html">【AppleiPhone 14 Pro】Apple iPhone 14 Pro (A2892) 256GB 暗紫色 支持移动联通电信5G 双卡双待手机【行情 报价 价格 评测】-京东</a></p>
<p>图片地址：D:\download\尚硅谷<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E&spm=1001.2101.3001.7020">谷粒商城</a>电商项目等1个文件\尚硅谷谷粒商城电商项目\资料源码\docs\pics</p>
<p> <strong>基本信息</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/fadb476b84df4885b2cdba7e7893dced.png" alt="img"></p>
<p><strong>规格参数</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/f3d8efe002ef403484c8b614ff72605c.png" alt="img"> <strong>销售属性</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/c53f46e0494d44a6878da2a5761fb1b7.png" alt="img"></p>
<blockquote>
<p>销售属性展示的是“可选值”。这里自定义“+” 号，可以新加销售属性的可选值，仅针对于这个商品，不会改动销售属性的数据库。</p>
</blockquote>
<p>sku信息 </p>
<blockquote>
<p>根据笛卡尔积计算销售属性，得出相应数量的sku信息。一个sku决定了一个价格。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/256a5e142a1e4351b0f250cdfc27d1c7.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/ccaec4ac49e740648f186ecabaac6ae9.png" alt="img"></p>
<h3 id="3、vo类封装表单json数据"><a href="#3、vo类封装表单json数据" class="headerlink" title="3、vo类封装表单json数据"></a>3、vo类封装表单json数据</h3><p>点击下一步“保存商品信息” ，然后点击取消，复制控制台的json数据。</p>
<p><strong>json格式化工具：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//www.bejson.com/</span></span><br></pre></td></tr></table></figure>

<p><strong>json生成java类：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//www.bejson.com/json2javapojo/new/</span></span><br></pre></td></tr></table></figure>

<p><strong>1.生成vo类并下载，复制到自己项目的vo包下</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../pic/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/155d57095466446c8c7bbf9a0d129cb5.png" alt="img"></p>
<p><strong>2.把所有id字段改成Long类型，把所有金额相关字段的类型由String或Double改成BigDecimal类型，把get和set方法改成@Data</strong></p>
<ol>
<li>SpuSaveVo的brandId和catelogId改成Long，weight改成BigDecimal。</li>
<li>Bounds都改成BigDecimal</li>
<li>BaseAttrs的attrId改成Long；price,discount,fullPrice,reducePrice改成BigDecimal ;</li>
<li>Attr的attrId改成Long</li>
<li>MemberPrice的id改成Long，price改成BigDecimal；</li>
</ol>
<p><strong>BigDecimal</strong></p>
<p>Java在java.math包中提供的API类BigDecimal，用来对超过16位有效位的数进行精确的运算。双精度浮点型变量double可以处理16位有效数。在实际应用中，需要对更大或者更小的数进行运算和处理。float和double只能用来做科学计算或者是工程计算，在商业计算中要用java.math.BigDecimal。BigDecimal所创建的是对象，我们不能使用传统的+、-、*、&#x2F;等算术运算符直接对其对象进行数学运算，而必须调用其相对应的方法。方法中的参数也必须是BigDecimal的对象。构造器是类的特殊方法，专门用来创建对象，特别是带有参数的对象。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://adanpro.gitee.io/adanblog">ADAN</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/">https://adanpro.gitee.io/adanblog/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://www.adan.com" target="_blank">ADAN</a> 许可协议。转载请注明来自 <a href="https://adanpro.gitee.io/adanblog" target="_blank">光明</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/" title="商品服务（四）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">商品服务（四）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/king.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ADAN</div><div class="author-info__description">如有一味绝境，非历十方生死</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://weixin.com/" target="_blank" title="weixin"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://qq.com/" target="_blank" title="2028038953"><i class="iconfont icon-QQ"></i></a><a class="social-icon" href="mailto:2028038953@qq.com" target="_blank" title="2028038953@qq.com"><i class="iconfont icon-youxiang"></i></a><a class="social-icon" href="https://gitee.com/" target="_blank" title="gitee"><i class="iconfont icon-gitee"></i></a><a class="social-icon" href="https://bilibili.com/" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">商品服务-品牌管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%B7%BB%E5%8A%A0%E2%80%9C%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E2%80%9D%E5%88%B0%E4%BA%BA%E4%BA%BA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.</span> <span class="toc-text">1、添加“品牌管理”到人人后台管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9C%A8%E4%BA%BA%E4%BA%BA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%96%B0%E5%A2%9E%E2%80%9C%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E2%80%9D%E8%8F%9C%E5%8D%95"><span class="toc-number">1.1.1.</span> <span class="toc-text">1、在人人后台管理系统中新增“品牌管理”菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BA%BA%E4%BA%BA%E7%94%9F%E6%88%90%E7%9A%84%E5%89%8D%E7%AB%AFvue%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%E5%88%B0%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">2、人人生成的前端vue文件复制到前端工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90"><span class="toc-number">1.1.3.</span> <span class="toc-text">3、修改权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.4.</span> <span class="toc-text">4、测试增删改查基础功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%96%B0%E5%A2%9E%E6%97%B6%E6%98%BE%E7%A4%BA%E7%8A%B6%E6%80%81%E5%BC%80%E5%85%B3%EF%BC%88%E4%BB%85%E5%89%8D%E7%AB%AF%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">2、新增时显示状态开关（仅前端）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD%EF%BC%8C%E9%98%BF%E9%87%8C%E4%BA%91%E4%BA%91%E5%AD%98%E5%82%A8"><span class="toc-number">1.3.</span> <span class="toc-text">3、文件上传功能，阿里云云存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、分布式系统上传文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%BC%80%E9%80%9A%E9%98%BF%E9%87%8C%E4%BA%91OSS%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84Bucket"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、开通阿里云OSS对象存储服务，创建新的Bucket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%AD%90%E8%B4%A6%E6%88%B7%E5%88%9B%E5%BB%BA%E5%92%8C%E6%8E%88%E6%9D%83"><span class="toc-number">1.3.3.</span> <span class="toc-text">3、子账户创建和授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95%E6%99%AE%E9%80%9A%E4%B8%8A%E4%BC%A0%E6%96%B9%E5%BC%8F%EF%BC%88%E4%B8%8D%E5%BB%BA%E8%AE%AE%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">4、测试普通上传方式（不建议）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#product%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.5.</span> <span class="toc-text">product模块导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%BB%BA%E7%AB%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%AD%BE%E5%90%8D%E5%90%8E%E7%9B%B4%E4%BC%A0"><span class="toc-number">1.3.6.</span> <span class="toc-text">5、建立第三方服务模块，实现服务端签名后直传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%B5%8B%E8%AF%95%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.7.</span> <span class="toc-text">6、测试上传文件功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%AD%BE%E5%90%8D%E5%90%8E%E7%9B%B4%E4%BC%A0%E6%96%87%E4%BB%B6%EF%BC%8C%E6%96%B0%E5%BB%BAOssController"><span class="toc-number">1.3.8.</span> <span class="toc-text">7、实现服务端签名后直传文件，新建OssController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E9%85%8D%E7%BD%AE%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1"><span class="toc-number">1.3.9.</span> <span class="toc-text">8、配置网关路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%90%AF%E5%8A%A8%E7%BD%91%E5%85%B3%E3%80%81%E6%B5%8B%E8%AF%95%E8%8E%B7%E5%8F%96oss%E7%AD%BE%E5%90%8D%E8%AF%B7%E6%B1%82"><span class="toc-number">1.3.10.</span> <span class="toc-text">9、启动网关、测试获取oss签名请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E5%89%8D%E7%AB%AF%E8%81%94%E8%B0%83%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.11.</span> <span class="toc-text">10、前端联调，实现文件上传功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E5%9C%A8%E9%98%BF%E9%87%8C%E4%BA%91%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F%E8%A7%84%E5%88%99"><span class="toc-number">1.3.12.</span> <span class="toc-text">11、在阿里云配置跨域规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.13.</span> <span class="toc-text">12、启动测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%95%88%E6%9E%9C%E4%BC%98%E5%8C%96-%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87%EF%BC%88%E4%BB%85%E5%89%8D%E7%AB%AF%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">4、效果优化-显示图片（仅前端）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AE%A9img%E9%87%8C%E7%9A%84%E5%9B%BE%E7%89%87%E8%87%AA%E9%80%82%E5%BA%94div%EF%BC%8C%E4%B8%94%E4%B8%8D%E5%8F%98%E5%BD%A2"><span class="toc-number">1.5.</span> <span class="toc-text">如何让img里的图片自适应div，且不变形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%89%8D%E7%AB%AF%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.6.</span> <span class="toc-text">5、前端表单校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81JSR303%E6%95%B0%E5%AD%97%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.7.</span> <span class="toc-text">6、JSR303数字校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E6%A0%A1%E9%AA%8C%E5%AE%9E%E7%8E%B0%EF%BC%8C-Valid"><span class="toc-number">1.7.1.</span> <span class="toc-text">1、基本校验实现，@Valid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BB%9F%E4%B8%80%E5%B0%81%E8%A3%85%E9%94%99%E8%AF%AF%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.7.2.</span> <span class="toc-text">2、统一封装错误状态码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%95%86%E5%93%81%E6%A8%A1%E5%9D%97%E7%BB%9F%E4%B8%80%E5%B0%81%E8%A3%85%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%B1%BB%EF%BC%8C%E5%93%81%E7%89%8C%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E5%BC%82%E5%B8%B8"><span class="toc-number">1.7.3.</span> <span class="toc-text">3、商品模块统一封装异常处理类，品牌参数校验异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C%EF%BC%8C%E5%A2%9E%E6%94%B9%E6%A0%A1%E9%AA%8C%E5%88%86%E5%BC%80%EF%BC%8C-Validated"><span class="toc-number">1.7.4.</span> <span class="toc-text">4、分组校验，增改校验分开，@Validated</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%8F%90%E4%BA%A4%E6%8C%87%E5%AE%9A%E6%95%B0%E5%80%BC"><span class="toc-number">1.7.5.</span> <span class="toc-text">5、编写自定义校验，必须提交指定数值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%EF%BC%8CshowStatus%E5%8F%AA%E8%83%BD%E6%98%AF0%E6%88%961"><span class="toc-number">1.7.6.</span> <span class="toc-text">6、使用自定义校验，showStatus只能是0或1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.7.</span> <span class="toc-text">7、测试数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E6%9C%80%E7%BB%88%E6%A0%A1%E9%AA%8C%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%92%8Ccontroller%E4%BB%A3%E7%A0%81"><span class="toc-number">1.7.8.</span> <span class="toc-text">8、最终校验的实体类和controller代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84"><span class="toc-number">2.</span> <span class="toc-text">商品服务-属性分组</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81-SPU%E5%92%8CSKU"><span class="toc-number">2.1.</span> <span class="toc-text">1、 SPU和SKU</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.1.</span> <span class="toc-text">1、概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">2、举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%E3%80%81%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7%EF%BC%88%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%EF%BC%89%E3%80%81%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E3%80%81%E5%B9%B3%E5%8F%B0%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.3.</span> <span class="toc-text">3、销售属性、基本属性（规格参数）、属性分组、平台属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%86%E7%B1%BB%E8%A1%A8%E3%80%81%E5%B1%9E%E6%80%A7%E8%A1%A8%E3%80%81%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E8%A1%A8%E8%A1%A8%E5%85%B3%E7%B3%BB%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.1.4.</span> <span class="toc-text">3、分类表、属性表、属性分组表表关系详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">1、环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2%E5%AF%BC%E5%85%A5%E5%85%A8%E9%83%A8%E8%8F%9C%E5%8D%95"><span class="toc-number">2.2.1.</span> <span class="toc-text">1、后台页面导入全部菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80"><span class="toc-number">2.2.2.</span> <span class="toc-text">2、接口文档地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AF%BC%E5%85%A5%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">2.3.</span> <span class="toc-text">2、导入前端代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E5%8A%9F%E8%83%BD%E7%9A%84%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6"><span class="toc-number">2.3.1.</span> <span class="toc-text">1、属性分组功能的前端组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">2、父子组件传递数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%9F%A5%E8%AF%A2%E2%80%9C%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E2%80%9D%E5%88%97%E8%A1%A8%EF%BC%8C%E6%8C%89%E5%8F%82%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">3、查询“属性分组”列表，按参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%96%B0%E5%A2%9E%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84"><span class="toc-number">2.5.</span> <span class="toc-text">4、新增属性分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81-%E6%96%B0%E5%A2%9E%E9%80%89%E6%8B%A9%E6%A1%86%EF%BC%8CelementUI%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8el-cascader"><span class="toc-number">2.5.1.</span> <span class="toc-text">1、 新增选择框，elementUI级联选择器el-cascader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81children%E5%AD%97%E6%AE%B5%E6%B3%A8%E8%A7%A3-JsonInclude"><span class="toc-number">2.5.2.</span> <span class="toc-text">2、children字段注解@JsonInclude</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%89%8D%E7%AB%AF%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AFcatelogId"><span class="toc-number">2.5.3.</span> <span class="toc-text">3、前端报错解决，修改前端catelogId</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%BF%AE%E6%94%B9%E5%9B%9E%E6%98%BE%E2%80%9C%E6%89%80%E5%B1%9E%E5%88%86%E7%B1%BB%E2%80%9D%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.</span> <span class="toc-text">5、修改回显“所属分类”功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E7%AB%AF%E5%9B%9E%E6%98%BE%E6%97%B6%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84%E8%AF%B7%E6%B1%82"><span class="toc-number">2.6.1.</span> <span class="toc-text">1、前端回显时，查询分类路径请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81AttrGroupEntity%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84%E7%9A%84%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="toc-number">2.6.2.</span> <span class="toc-text">2、AttrGroupEntity新增分类路径的成员变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84controller%E7%9A%84info%E6%96%B9%E6%B3%95%E6%9F%A5%E8%AF%A2%E8%B5%8B%E5%80%BC%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84"><span class="toc-number">2.6.3.</span> <span class="toc-text">3、属性分组controller的info方法查询赋值分类路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%86%E7%B1%BB%E7%9A%84service%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95%EF%BC%8C%E6%9F%A5%E6%89%BE%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84"><span class="toc-number">2.6.4.</span> <span class="toc-text">4、分类的service编写方法，查找分类路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%B5%8B%E8%AF%95%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84%E4%B8%9A%E5%8A%A1"><span class="toc-number">2.6.5.</span> <span class="toc-text">5、测试查询分类路径业务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%B5%8B%E8%AF%95%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84%E4%B8%9A%E5%8A%A1-1"><span class="toc-number">2.6.6.</span> <span class="toc-text">5、测试查询分类路径业务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%89%8D%E7%AB%AF%EF%BC%8C%E5%AF%B9%E8%AF%9D%E6%A1%86%E5%85%B3%E9%97%AD%E6%97%B6%E6%B8%85%E7%A9%BA%E6%95%B0%E6%8D%AE%EF%BC%8C%E9%98%B2%E6%AD%A2%E4%B8%8D%E5%90%88%E7%90%86%E5%9B%9E%E6%98%BE"><span class="toc-number">2.6.7.</span> <span class="toc-text">6、前端，对话框关闭时清空数据，防止不合理回显</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%89%8D%E7%AB%AF%E2%80%9C%E6%89%80%E5%B1%9E%E5%88%86%E7%B1%BB%E2%80%9D%E5%8F%AF%E6%90%9C%E7%B4%A2%EF%BC%8C%E6%98%BE%E7%A4%BA%E6%8F%90%E7%A4%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">2.6.8.</span> <span class="toc-text">6、前端“所属分类”可搜索，显示提示信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%88%86%E9%A1%B5-mybatisplus%E5%88%86%E9%A1%B5%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">2.7.</span> <span class="toc-text">6、分页-mybatisplus分页拦截器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">优化品牌管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%8C%89%E6%90%9C%E7%B4%A2%E6%96%87%E5%AD%97%EF%BC%8C%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.</span> <span class="toc-text">1、按搜索文字，分页查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%93%81%E7%89%8C%E5%85%B3%E8%81%94%E7%9A%84%E6%89%80%E6%9C%89%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">2、获取当前品牌关联的所有分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E7%AB%AF"><span class="toc-number">3.2.1.</span> <span class="toc-text">1、前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81controller%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%93%81%E7%89%8C%E5%85%B3%E8%81%94%E7%9A%84%E6%89%80%E6%9C%89%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.2.</span> <span class="toc-text">2、controller编写方法，获取当前品牌关联的所有分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%96%B0%E5%A2%9E%E5%85%B3%E8%81%94%E7%9A%84controller%E3%80%81service"><span class="toc-number">3.2.3.</span> <span class="toc-text">3、新增关联的controller、service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95%E6%96%B0%E5%A2%9E%E5%92%8C%E6%9F%A5%E8%AF%A2%E2%80%9C%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E2%80%9D"><span class="toc-number">3.2.4.</span> <span class="toc-text">4、测试新增和查询“关联关系”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E4%BF%AE%E6%94%B9%E5%93%81%E7%89%8C%E5%90%8D%E6%97%B6%EF%BC%8C%E5%90%8C%E6%AD%A5%E4%BF%AE%E6%94%B9%E5%85%B3%E8%81%94%E8%A1%A8%E7%9A%84%E5%93%81%E7%89%8C%E5%90%8D"><span class="toc-number">3.2.5.</span> <span class="toc-text">5、修改品牌名时，同步修改关联表的品牌名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB%E5%90%8D%E6%97%B6%EF%BC%8C%E5%90%8C%E6%AD%A5%E4%BF%AE%E6%94%B9%E5%85%B3%E8%81%94%E8%A1%A8%E7%9A%84%E5%88%86%E7%B1%BB%E5%90%8D%E3%80%82%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6xml%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.6.</span> <span class="toc-text">6、修改分类名时，同步修改关联表的分类名。映射配置文件xml方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-%E5%B1%9E%E6%80%A7%EF%BC%88%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%92%8C%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">商品服务-属性（规格参数和销售属性）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%96%B0%E5%A2%9E%E5%B1%9E%E6%80%A7%E6%97%B6%EF%BC%8C%E6%96%B0%E5%A2%9E%E5%B1%9E%E6%80%A7%E5%92%8C%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">4.1.</span> <span class="toc-text">1、新增属性时，新增属性和属性分组的关联关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E8%A1%A8%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.1.</span> <span class="toc-text">1、规格参数表单介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Object%E5%88%92%E5%88%86%EF%BC%88po%E3%80%81vo%E3%80%81dto%E7%AD%89%EF%BC%89"><span class="toc-number">4.1.2.</span> <span class="toc-text">2、Object划分（po、vo、dto等）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%EF%BC%8C%E4%BD%BF%E7%94%A8vo%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.1.3.</span> <span class="toc-text">3、代码实现，使用vo对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.4.</span> <span class="toc-text">4、测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B1%9E%E6%80%A7%EF%BC%88%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%EF%BC%89%EF%BC%8CAttrRespVo%E5%B0%81%E8%A3%85%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="toc-number">4.2.</span> <span class="toc-text">2、分页查询属性（规格参数），AttrRespVo封装响应数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0%E3%80%81%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">0、需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E5%8D%95%E5%A4%9A%E9%80%89bug"><span class="toc-number">4.2.2.</span> <span class="toc-text">1、修改前端单多选bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.3.</span> <span class="toc-text">2、代码实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">4.2.4.</span> <span class="toc-text">3、测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%9F%A5%E8%AF%A2%E5%B1%9E%E6%80%A7%E8%AF%A6%E6%83%85%EF%BC%88%E4%BF%AE%E6%94%B9%E6%97%B6%E5%9B%9E%E6%98%BE%E6%89%80%E5%B1%9E%E5%88%86%E7%B1%BB%E8%B7%AF%E5%BE%84%E5%92%8C%E5%88%86%E7%BB%84id%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">3、查询属性详情（修改时回显所属分类路径和分组id）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7%E5%90%8D%E6%97%B6%EF%BC%8C%E5%90%8C%E6%AD%A5%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7%E5%92%8C%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">4.4.</span> <span class="toc-text">4、修改属性名时，同步修改属性和属性分组的关联关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E7%94%A8%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0%E5%8C%BA%E5%88%86%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%E5%92%8C%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="toc-number">4.5.</span> <span class="toc-text">5、用路径参数区分销售属性和规格参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0%E3%80%81%E2%80%9C%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%E3%80%81%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E3%80%81%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E2%80%9D%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">4.5.1.</span> <span class="toc-text">0、“销售属性、规格参数、属性分组”效果展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BF%AE%E6%94%B9%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%B1%9E%E6%80%A7%E7%9A%84controller%E5%92%8Cservice"><span class="toc-number">4.5.2.</span> <span class="toc-text">.1、修改分页查询属性的controller和service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81-%E6%96%B0%E5%A2%9E%E6%B5%8B%E8%AF%95"><span class="toc-number">4.5.3.</span> <span class="toc-text">2、 新增测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E5%B8%B8%E9%87%8F%E7%B1%BB"><span class="toc-number">4.5.4.</span> <span class="toc-text">3、创建商品常量类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%9B%B4%E6%94%B9%E6%96%B0%E5%A2%9E%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7%E7%9A%84%E4%B8%9A%E5%8A%A1%EF%BC%8C%E4%BB%85%E6%93%8D%E4%BD%9C%E8%A7%84%E6%A0%BC%E5%B1%9E%E6%80%A7%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">4.5.5.</span> <span class="toc-text">4、更改新增修改属性的业务，仅操作规格属性时添加关联关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%B3%A8%E6%84%8F%E7%A9%BA%E6%8C%87%E9%92%88%E5%BC%82%E5%B8%B8"><span class="toc-number">4.6.</span> <span class="toc-text">6、注意空指针异常</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%8A%9F%E8%83%BD"><span class="toc-number">5.</span> <span class="toc-text">商品服务-属性分组的关联功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">5.1.</span> <span class="toc-text">1、最终效果展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%9F%A5%E8%AF%A2%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E5%85%B3%E8%81%94%E7%9A%84%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="toc-number">5.2.</span> <span class="toc-text">2、查询属性分组关联的所有属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">5.3.</span> <span class="toc-text">3、批量删除属性与分组的关联关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%96%B0%E5%BB%BA%E5%85%B3%E8%81%94%E6%97%B6%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E6%9C%AA%E5%85%B3%E8%81%94%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">5.4.</span> <span class="toc-text">4、新建关联时，查询当前属性分组未关联的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%BF%9D%E5%AD%98%E6%96%B0%E5%A2%9E%E7%9A%84%E5%85%B3%E8%81%94"><span class="toc-number">5.5.</span> <span class="toc-text">5、保存新增的关联</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-%E6%96%B0%E5%A2%9E%E5%95%86%E5%93%81"><span class="toc-number">6.</span> <span class="toc-text">商品服务-新增商品</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E3%80%81%E5%90%AF%E5%8A%A8%E4%BC%9A%E5%91%98%E6%A8%A1%E5%9D%97"><span class="toc-number">6.1.</span> <span class="toc-text">1、配置、启动会员模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-number">6.1.1.</span> <span class="toc-text">1、用户模块添加到nacos注册中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1"><span class="toc-number">6.1.2.</span> <span class="toc-text">2、配置网关路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B7%BB%E5%8A%A0%E2%80%9C%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E2%80%9D%E6%95%B0%E6%8D%AE"><span class="toc-number">6.1.3.</span> <span class="toc-text">3、添加“会员等级”数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E5%93%81%E7%89%8C%EF%BC%88%E4%B8%8D%E7%94%A8%E5%88%86%E9%A1%B5%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">2、获取当前分类关联的品牌（不用分页）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E6%9E%90"><span class="toc-number">6.2.1.</span> <span class="toc-text">1、分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%96%B0%E5%BB%BABrandVo"><span class="toc-number">6.2.2.</span> <span class="toc-text">2、新建BrandVo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.3.</span> <span class="toc-text">3、代码实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bug"><span class="toc-number">6.2.4.</span> <span class="toc-text">bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95-1"><span class="toc-number">6.2.5.</span> <span class="toc-text">4、测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%88%86%E7%B1%BB%E4%B8%8B%E7%9A%84%E5%88%86%E7%BB%84%E5%8F%8A%E5%85%B6%E5%85%B3%E8%81%94%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">6.3.</span> <span class="toc-text">3、获取当前分类下的分组及其关联的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E6%9E%90-1"><span class="toc-number">6.3.1.</span> <span class="toc-text">1、分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">6.3.2.</span> <span class="toc-text">2、代码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%96%B0%E5%A2%9E%E5%95%86%E5%93%81"><span class="toc-number">6.4.</span> <span class="toc-text">4、新增商品</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E6%9E%90-2"><span class="toc-number">6.4.1.</span> <span class="toc-text">1、分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%A1%AB%E5%86%99%E8%A1%A8%E5%8D%95"><span class="toc-number">6.4.2.</span> <span class="toc-text">2、填写表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81vo%E7%B1%BB%E5%B0%81%E8%A3%85%E8%A1%A8%E5%8D%95json%E6%95%B0%E6%8D%AE"><span class="toc-number">6.4.3.</span> <span class="toc-text">3、vo类封装表单json数据</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/" title="谷粒商城（五）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（五）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%94%EF%BC%89/" title="谷粒商城（五）">谷粒商城（五）</a><time datetime="2024-01-02T08:44:10.323Z" title="发表于 2024-01-02 16:44:10">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/" title="商品服务（四）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="商品服务（四）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E5%9B%9B%EF%BC%89/" title="商品服务（四）">商品服务（四）</a><time datetime="2024-01-02T08:42:41.356Z" title="发表于 2024-01-02 16:42:41">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%B8%89%EF%BC%89/" title="谷粒商城（三）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（三）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%B8%89%EF%BC%89/" title="谷粒商城（三）">谷粒商城（三）</a><time datetime="2024-01-02T08:41:46.521Z" title="发表于 2024-01-02 16:41:46">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%8C%EF%BC%89/" title="谷粒商城（二）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（二）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%EF%BC%88%E4%BA%8C%EF%BC%89/" title="谷粒商城（二）">谷粒商城（二）</a><time datetime="2024-01-02T08:40:37.031Z" title="发表于 2024-01-02 16:40:37">2024-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" title="谷粒商城（一）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/10.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒商城（一）"/></a><div class="content"><a class="title" href="/2024/01/02/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" title="谷粒商城（一）">谷粒商城（一）</a><time datetime="2024-01-02T08:39:21.869Z" title="发表于 2024-01-02 16:39:21">2024-01-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ADAN</div><div class="footer_custom_text">听天，不会由命</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>